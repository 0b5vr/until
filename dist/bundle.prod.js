!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=67)}([function(e,t,n){"use strict";n.d(t,"c",function(){return i}),n.d(t,"d",function(){return r}),n.d(t,"e",function(){return a}),n.d(t,"f",function(){return o}),n.d(t,"a",function(){return s}),n.d(t,"b",function(){return l});const i=[-1,-1,1,-1,-1,1,1,1],r=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],a=[0,0,1,0,0,1,0,0,1,0,0,1],o=[0,0,1,0,0,1,1,1],s=e=>{let t=[];for(let n=0;n<e;n++)t.push(n);return t},l=(e,t)=>{let n=[];for(let i=0;i<t;i++)for(let t=0;t<e;t++)n.push(t,i);return n}},function(e,t,n){"use strict";const i={vecAdd:(e,t)=>e.map((e,n)=>e+t[n]),vecSub:(e,t)=>e.map((e,n)=>e-t[n]),vecMul:(e,t)=>e.map((e,n)=>e-t[n]),vec3Cross:(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],vecScale:(e,t)=>t.map(t=>t*e),vecDot:(e,t)=>e.reduce((e,n,i)=>e+n*t[i],0),vecLength:e=>Math.sqrt(e.reduce((e,t)=>e+t*t,0)),vecNormalize:e=>i.vecScale(1/i.vecLength(e),e),quatMul:(e,t)=>[e[3]*t[0]+e[0]*t[3]+e[1]*t[2]-e[2]*t[1],e[3]*t[1]-e[0]*t[2]+e[1]*t[3]+e[2]*t[0],e[3]*t[2]+e[0]*t[1]-e[1]*t[0]+e[2]*t[3],e[3]*t[3]-e[0]*t[0]-e[1]*t[1]-e[2]*t[2]],quatInv:e=>[-e[0],-e[1],-e[2],e[3]],rotateVecByQuat:(e,t)=>{const n=[e[0],e[1],e[2],0],r=i.quatInv(t),a=i.quatMul(i.quatMul(t,n),r);return[a[0],a[1],a[2]]},quatToMat4:e=>{const t=i.rotateVecByQuat([1,0,0],e),n=i.rotateVecByQuat([0,1,0],e),r=i.rotateVecByQuat([0,0,1],e);return[t[0],n[0],r[0],0,t[1],n[1],r[1],0,t[2],n[2],r[2],0,0,0,0,1]},quatAngleAxis:(e,t)=>{const n=e/2,i=Math.sin(n);return[t[0]*i,t[1]*i,t[2]*i,Math.cos(n)]},mat4Apply:(...e)=>{const t=e[0],n=e[1];if(3<=e.length){const r=e.slice(2);return i.mat4Apply(i.mat4Apply(t,n),...r)}return[t[0]*n[0]+t[4]*n[1]+t[8]*n[2]+t[12]*n[3],t[1]*n[0]+t[5]*n[1]+t[9]*n[2]+t[13]*n[3],t[2]*n[0]+t[6]*n[1]+t[10]*n[2]+t[14]*n[3],t[3]*n[0]+t[7]*n[1]+t[11]*n[2]+t[15]*n[3],t[0]*n[4]+t[4]*n[5]+t[8]*n[6]+t[12]*n[7],t[1]*n[4]+t[5]*n[5]+t[9]*n[6]+t[13]*n[7],t[2]*n[4]+t[6]*n[5]+t[10]*n[6]+t[14]*n[7],t[3]*n[4]+t[7]*n[5]+t[11]*n[6]+t[15]*n[7],t[0]*n[8]+t[4]*n[9]+t[8]*n[10]+t[12]*n[11],t[1]*n[8]+t[5]*n[9]+t[9]*n[10]+t[13]*n[11],t[2]*n[8]+t[6]*n[9]+t[10]*n[10]+t[14]*n[11],t[3]*n[8]+t[7]*n[9]+t[11]*n[10]+t[15]*n[11],t[0]*n[12]+t[4]*n[13]+t[8]*n[14]+t[12]*n[15],t[1]*n[12]+t[5]*n[13]+t[9]*n[14]+t[13]*n[15],t[2]*n[12]+t[6]*n[13]+t[10]*n[14]+t[14]*n[15],t[3]*n[12]+t[7]*n[13]+t[11]*n[14]+t[15]*n[15]]},mat4Inverse:e=>{const t=e[0],n=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8],f=e[9],m=e[10],h=e[11],d=e[12],A=e[13],p=e[14],v=e[15],g=t*s-n*o,b=t*l-r*o,y=t*u-a*o,w=n*l-r*s,x=n*u-a*s,E=r*u-a*l,_=c*A-f*d,T=c*p-m*d,R=c*v-h*d,P=f*p-m*A,F=f*v-h*A,S=m*v-h*p;return i.vecScale(1/g*S-b*F+y*P+w*R-x*T+E*_,[s*S-l*F+u*P,r*F-n*S-a*P,A*E-p*x+v*w,m*x-f*E-h*w,l*R-o*S-u*T,t*S-r*R+a*T,p*y-d*E-v*b,c*E-m*y+h*b,o*F-s*R+u*_,n*R-t*F-a*_,d*x-A*y+v*g,f*y-c*x-h*g,s*T-o*P-l*_,t*P-n*T+r*_,A*b-d*w-p*g,c*w-f*b+m*g])},mat4ApplyToVec4:(e,t)=>[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3]],mat4Transpose:e=>[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],mat4Identity:()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],mat4Translate:e=>[1,0,0,0,0,1,0,0,0,0,1,0,e[0],e[1],e[2],1],mat4Scale:e=>[e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,1],mat4ScaleXYZ:e=>[e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1],mat4RotateX:e=>[1,0,0,0,0,Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1],mat4RotateY:e=>[Math.cos(e),0,Math.sin(e),0,0,1,0,0,-Math.sin(e),0,Math.cos(e),0,0,0,0,1],mat4RotateZ:e=>[Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1],mat4LookAt:(e,t,n,r)=>{const a=i.vecNormalize(i.vecSub(t,e));let o=i.vecNormalize(i.vec3Cross(a,n||[0,1,0])),s=i.vec3Cross(o,a);return o=i.vecAdd(i.vecScale(Math.cos(r||0),o),i.vecScale(Math.sin(r||0),s)),s=i.vec3Cross(o,a),[o[0],s[0],a[0],0,o[1],s[1],a[1],0,o[2],s[2],a[2],0,-o[0]*e[0]-o[1]*e[1]-o[2]*e[2],-s[0]*e[0]-s[1]*e[1]-s[2]*e[2],-a[0]*e[0]-a[1]*e[1]-a[2]*e[2],1]},mat4Perspective:(e,t,n)=>{const i=1/Math.tan(e*Math.PI/360),r=n-t;return[i,0,0,0,0,i,0,0,0,0,(n+t)/r,1,0,0,-2*n*t/r,0]},vec3PosFromViewMatrix:e=>{const t=i.mat4ApplyToVec4(i.mat4Transpose(e),[-e[12],-e[13],-e[14],0]);return[t[0],t[1],t[2]]},vec3DirFromViewMatrix:e=>[e[9],e[10],e[11]]};t.a=i},function(e){e.exports={resolution:[1920,1080],shadowReso:512,near:.01,far:20}},function(e,t){e.exports="attribute vec2 p;\nvarying vec2 uv;\n\nvoid main() {\n  uv = 0.5 + 0.5 * p;\n  gl_Position = vec4( p, 0.0, 1.0 );\n}"},function(e,t,n){"use strict";n.d(t,"a",function(){return i});const i=class{constructor(e){this.set(e)}gen(e){return e&&this.set(e),this.seed=this.seed^this.seed<<13,this.seed=this.seed^this.seed>>>17,this.seed=this.seed^this.seed<<5,this.seed/Math.pow(2,32)+.5}genFloat32Array(e){const t=new Float32Array(e);for(let n=0;n<e;n++)t[n]=this.gen();return t}set(e){this.seed=e||this.seed||1}}},function(e,t){e.exports="#extension GL_EXT_draw_buffers : require\nprecision highp float;\n\n// ------\n\nvoid main() {\n  gl_FragData[ 0 ] = vec4( bgColor, 1.0 );\n  gl_FragData[ 1 ] = vec4( far, 0.0, 0.0, 1.0 );\n}"},function(e,t,n){"use strict";(function(e){
/**
 * @license
 * webxr-polyfill
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * webvr-polyfill-dpdb 
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * wglu-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
/**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
const n=void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},i=Symbol("@@webxr-polyfill/EventTarget");class r{constructor(){this[i]={listeners:new Map}}addEventListener(e,t){if("string"!=typeof e)throw new Error("`type` must be a string");if("function"!=typeof t)throw new Error("`listener` must be a function");const n=this[i].listeners.get(e)||[];n.push(t),this[i].listeners.set(e,n)}removeEventListener(e,t){if("string"!=typeof e)throw new Error("`type` must be a string");if("function"!=typeof t)throw new Error("`listener` must be a function");const n=this[i].listeners.get(e)||[];for(let e=n.length;e>=0;e--)n[e]===t&&n.pop()}dispatchEvent(e,t){const n=this[i].listeners.get(e)||[],r=[];for(let e=0;e<n.length;e++)r[e]=n[e];for(let e of r)e(t);"function"==typeof this[`on${e}`]&&this[`on${e}`](t)}}const a=Symbol("@@webxr-polyfill/XR");class o extends r{constructor(e){super(),this[a]={device:e}}async requestDevice(){const e=await this[a].device;if(e)return e;throw new Error("NotFoundError")}}let s;if("performance"in n==!1){let e=Date.now();s=(()=>Date.now()-e)}else s=(()=>performance.now());var l=s;const u=Symbol("@@webxr-polyfill/XRPresentationContext");class c{constructor(e,t,n){this[u]={canvas:e,ctx:t,glAttribs:n},Object.assign(this,t)}get canvas(){return this[u].canvas}}const f=1e-6;let m="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function h(){let e=new m(16);return m!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function d(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function A(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function p(e,t){let n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],f=t[9],m=t[10],h=t[11],d=t[12],A=t[13],p=t[14],v=t[15],g=n*s-i*o,b=n*l-r*o,y=n*u-a*o,w=i*l-r*s,x=i*u-a*s,E=r*u-a*l,_=c*A-f*d,T=c*p-m*d,R=c*v-h*d,P=f*p-m*A,F=f*v-h*A,S=m*v-h*p,C=g*S-b*F+y*P+w*R-x*T+E*_;return C?(C=1/C,e[0]=(s*S-l*F+u*P)*C,e[1]=(r*F-i*S-a*P)*C,e[2]=(A*E-p*x+v*w)*C,e[3]=(m*x-f*E-h*w)*C,e[4]=(l*R-o*S-u*T)*C,e[5]=(n*S-r*R+a*T)*C,e[6]=(p*y-d*E-v*b)*C,e[7]=(c*E-m*y+h*b)*C,e[8]=(o*F-s*R+u*_)*C,e[9]=(i*R-n*F-a*_)*C,e[10]=(d*x-A*y+v*g)*C,e[11]=(f*y-c*x-h*g)*C,e[12]=(s*T-o*P-l*_)*C,e[13]=(n*P-i*T+r*_)*C,e[14]=(A*b-d*w-p*g)*C,e[15]=(c*w-f*b+m*g)*C,e):null}function v(e,t,n){let i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],f=t[8],m=t[9],h=t[10],d=t[11],A=t[12],p=t[13],v=t[14],g=t[15],b=n[0],y=n[1],w=n[2],x=n[3];return e[0]=b*i+y*s+w*f+x*A,e[1]=b*r+y*l+w*m+x*p,e[2]=b*a+y*u+w*h+x*v,e[3]=b*o+y*c+w*d+x*g,b=n[4],y=n[5],w=n[6],x=n[7],e[4]=b*i+y*s+w*f+x*A,e[5]=b*r+y*l+w*m+x*p,e[6]=b*a+y*u+w*h+x*v,e[7]=b*o+y*c+w*d+x*g,b=n[8],y=n[9],w=n[10],x=n[11],e[8]=b*i+y*s+w*f+x*A,e[9]=b*r+y*l+w*m+x*p,e[10]=b*a+y*u+w*h+x*v,e[11]=b*o+y*c+w*d+x*g,b=n[12],y=n[13],w=n[14],x=n[15],e[12]=b*i+y*s+w*f+x*A,e[13]=b*r+y*l+w*m+x*p,e[14]=b*a+y*u+w*h+x*v,e[15]=b*o+y*c+w*d+x*g,e}function g(e,t,n){let i=t[0],r=t[1],a=t[2],o=t[3],s=i+i,l=r+r,u=a+a,c=i*s,f=i*l,m=i*u,h=r*l,d=r*u,A=a*u,p=o*s,v=o*l,g=o*u;return e[0]=1-(h+A),e[1]=f+g,e[2]=m-v,e[3]=0,e[4]=f-g,e[5]=1-(c+A),e[6]=d+p,e[7]=0,e[8]=m+v,e[9]=d-p,e[10]=1-(c+h),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}const b=Symbol("@@webxr-polyfill/XRDevicePose");class y{constructor(e){this[b]={polyfill:e,leftViewMatrix:A(new Float32Array(16)),rightViewMatrix:A(new Float32Array(16)),poseModelMatrix:A(new Float32Array(16))}}get poseModelMatrix(){return this[b].poseModelMatrix}getViewMatrix(e){switch(e.eye){case"left":return this[b].leftViewMatrix;case"right":return this[b].rightViewMatrix}throw new Error("view is not a valid XREye")}updateFromFrameOfReference(e){const t=this[b].polyfill.getBasePoseMatrix(),n=this[b].polyfill.getBaseViewMatrix("left"),i=this[b].polyfill.getBaseViewMatrix("right");t&&e.transformBasePoseMatrix(this[b].poseModelMatrix,t),n&&i&&(e.transformBaseViewMatrix(this[b].leftViewMatrix,n,this[b].poseModelMatrix),e.transformBaseViewMatrix(this[b].rightViewMatrix,i,this[b].poseModelMatrix))}}const w=Symbol("@@webxr-polyfill/XRViewport");class x{constructor(e){this[w]={target:e}}get x(){return this[w].target.x}get y(){return this[w].target.y}get width(){return this[w].target.width}get height(){return this[w].target.height}}const E=["left","right"],_=Symbol("@@webxr-polyfill/XRView");class T{constructor(e,t,n){if(!E.includes(t))throw new Error(`XREye must be one of: ${E}`);const i=Object.create(null),r=new x(i);this[_]={polyfill:e,eye:t,viewport:r,temp:i,sessionId:n}}get eye(){return this[_].eye}get projectionMatrix(){return this[_].polyfill.getProjectionMatrix(this.eye)}_getViewport(e){this[_].viewport;if(this[_].polyfill.getViewport(this[_].sessionId,this.eye,e,this[_].temp))return this[_].viewport}}const R=Symbol("@@webxr-polyfill/XRFrame");class P{constructor(e,t,n){const i=new y(e),r=[new T(e,"left",n)];t.immersive&&r.push(new T(e,"right",n)),this[R]={polyfill:e,devicePose:i,views:r,session:t}}get session(){return this[R].session}get views(){return this[R].views}getDevicePose(e){return this[R].devicePose.updateFromFrameOfReference(e),this[R].devicePose}getInputPose(e,t){return this[R].polyfill.getInputPose(e,t)}}const F=Symbol("@@webxr-polyfill/XRStageBoundsPoint");class S{constructor(e,t){this[F]={x:e,z:t}}get x(){return this[F].x}get z(){return this[F].z}}const C=Symbol("@@webxr-polyfill/XRStageBounds");class D{constructor(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(new S(e[n],e[n+1]));this[C]={geometry:t}}get geometry(){return this[C].geometry}}class M{constructor(){}getTransformTo(e){throw new Error("Not yet supported")}}const I=1.6,L=Symbol("@@webxr-polyfill/XRFrameOfReference"),N=["head-model","eye-level","stage"],B=Object.freeze({disableStageEmulation:!1,stageEmulationHeight:0});class O extends M{constructor(e,t,n,i,r){if(n=Object.assign({},B,n),!N.includes(t))throw new Error(`XRFrameOfReferenceType must be one of ${N}`);if(super(),"stage"===t&&n.disableStageEmulation&&!i)throw new Error("XRFrameOfReference cannot use 'stage' type, if disabling emulation and platform does not provide");const{disableStageEmulation:a,stageEmulationHeight:o}=n;let s=0;"stage"!==t||i||(s=0!==o?o:I),"stage"!==t||i||((i=A(new Float32Array(16)))[13]=s),this[L]={disableStageEmulation:a,stageEmulationHeight:o,emulatedHeight:s,type:t,transform:i,polyfill:e,bounds:r},this.onboundschange=void 0}get bounds(){return this[L].bounds}get emulatedHeight(){return this[L].emulatedHeight}get type(){return this[L].type}transformBasePoseMatrix(e,t){if(this[L].transform)v(e,this[L].transform,t);else switch(this.type){case"head-model":return e!==t&&d(e,t),void(e[12]=e[13]=e[14]=0);case"eye-level":return void(e!==t&&d(e,t))}}transformBaseViewMatrix(e,t){let n=this[L].transform;if(n)p(e,n),v(e,t,e);else{if("head-model"===this.type)return p(e,t),e[12]=0,e[13]=0,e[14]=0,p(e,e),e;d(e,t)}return e}}const z=Symbol("@@webxr-polyfill/XRSession"),G=Object.freeze({immersive:!1,outputContext:void 0}),U=e=>{const{immersive:t,outputContext:n}=e;return!(!t&&!n)&&(void 0===n||n instanceof c)};class k extends r{constructor(e,t,n,i){n=Object.assign({},G,n),super();const{immersive:r,outputContext:a}=n;this[z]={polyfill:e,device:t,immersive:r,outputContext:a,ended:!1,suspended:!1,suspendedCallback:null,id:i};const o=new P(e,this,this[z].id);this[z].frame=o,this[z].onPresentationEnd=(t=>{if(t!==this[z].id){this[z].suspended=!1,this.dispatchEvent("focus",{session:this});const e=this[z].suspendedCallback;return this[z].suspendedCallback=null,void(e&&this.requestAnimationFrame(e))}this[z].ended=!0,e.removeEventListener("@webvr-polyfill/vr-present-end",this[z].onPresentationEnd),e.removeEventListener("@webvr-polyfill/vr-present-start",this[z].onPresentationStart),e.removeEventListener("@@webvr-polyfill/input-select-start",this[z].onSelectStart),e.removeEventListener("@@webvr-polyfill/input-select-end",this[z].onSelectEnd),this.dispatchEvent("end",{session:this})}),e.addEventListener("@@webxr-polyfill/vr-present-end",this[z].onPresentationEnd),this[z].onPresentationStart=(e=>{e!==this[z].id&&(this[z].suspended=!0,this.dispatchEvent("blur",{session:this}))}),e.addEventListener("@@webxr-polyfill/vr-present-start",this[z].onPresentationStart),this[z].onSelectStart=(e=>{e.sessionId===this[z].id&&this.dispatchEvent("selectstart",{frame:this[z].frame,inputSource:e.inputSource})}),e.addEventListener("@@webxr-polyfill/input-select-start",this[z].onSelectStart),this[z].onSelectEnd=(e=>{e.sessionId===this[z].id&&(this.dispatchEvent("selectend",{frame:this[z].frame,inputSource:e.inputSource}),this.dispatchEvent("select",{frame:this[z].frame,inputSource:e.inputSource}))}),e.addEventListener("@@webxr-polyfill/input-select-end",this[z].onSelectEnd),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get device(){return this[z].device}get immersive(){return this[z].immersive}get outputContext(){return this[z].outputContext}get depthNear(){return this[z].polyfill.depthNear}set depthNear(e){this[z].polyfill.depthNear=e}get depthFar(){return this[z].polyfill.depthFar}set depthFar(e){this[z].polyfill.depthFar=e}get environmentBlendMode(){return this[z].polyfill.environmentBlendMode||"opaque"}get baseLayer(){return this[z].baseLayer}set baseLayer(e){this[z].ended||(this[z].baseLayer=e,this[z].polyfill.onBaseLayerSet(this[z].id,e))}async requestFrameOfReference(e,t={}){if(this[z].ended)return;if(t=Object.assign({},B,t),!N.includes(e))throw new TypeError(`XRFrameOfReferenceType must be one of ${N}`);let n=null,i=null;try{n=await this[z].polyfill.requestFrameOfReferenceTransform(e,t)}catch(n){if("stage"!==e||t.disableStageEmulation)throw n}return"stage"===e&&n&&(i=this[z].polyfill.requestStageBounds())&&(i=new D(i)),new O(this[z].polyfill,e,t,n,i)}requestAnimationFrame(e){if(!(this[z].ended||this[z].suspended&&this[z].suspendedCallback))return this[z].suspended&&!this[z].suspendedCallback&&(this[z].suspendedCallback=e),this[z].polyfill.requestAnimationFrame(()=>{this[z].polyfill.onFrameStart(this[z].id),e(l(),this[z].frame),this[z].polyfill.onFrameEnd(this[z].id)})}cancelAnimationFrame(e){this[z].ended||this[z].polyfill.cancelAnimationFrame(e)}getInputSources(){return this[z].polyfill.getInputSources()}async end(){if(!this[z].ended)return this.immersive||(this[z].ended=!0,this[z].polyfill.removeEventListener("@@webvr-polyfill/vr-present-start",this[z].onPresentationStart),this[z].polyfill.removeEventListener("@@webvr-polyfill/vr-present-end",this[z].onPresentationEnd),this[z].polyfill.removeEventListener("@@webvr-polyfill/input-select-start",this[z].onSelectStart),this[z].polyfill.removeEventListener("@@webvr-polyfill/input-select-end",this[z].onSelectEnd),this.dispatchEvent("end",{session:this})),this[z].polyfill.endSession(this[z].id)}}const V=Symbol("@@webxr-polyfill/XRDevice");class H extends r{constructor(e){if(!e)throw new Error("XRDevice must receive a PolyfilledXRDevice.");super(),this[V]={polyfill:e,immersiveSession:null,nonImmersiveSessions:new Set},this.ondeactive=void 0}async supportsSession(e={}){return e=Object.assign({},G,e),U(e)&&this[V].polyfill.supportsSession(e)?null:Promise.reject(null)}async requestSession(e){if(e=Object.assign({},G,e),!U(e))throw new Error("NotSupportedError");if(this[V].immersiveSession&&e.immersive)throw new Error("InvalidStateError");const t=await this[V].polyfill.requestSession(e),n=new k(this[V].polyfill,this,e,t);e.immersive?this[V].immersiveSession=n:this[V].nonImmersiveSessions.add(n);const i=()=>{n.immersive?this[V].immersiveSession=null:this[V].nonImmersiveSessions.delete(n),n.removeEventListener("end",i)};return n.addEventListener("end",i),n}}let X="DOMPointReadOnly"in n?DOMPointReadOnly:null;if(!X){const e=Symbol("@@webxr-polyfill/DOMPointReadOnly");X=class{constructor(t,n,i,r){if(1===arguments.length)this[e]={x:t.x,y:t.y,z:t.z,w:t.w};else{if(4!==arguments.length)throw new TypeError("Must supply either 1 or 4 arguments");this[e]={x:t,y:n,z:i,w:r}}}get x(){return this[e].x}get y(){return this[e].y}get z(){return this[e].z}get w(){return this[e].w}}}var Q=X;class W{constructor(e=new Q(0,0,0,1),t=new Q(0,0,-1,0),n=new Float32Array(16)){if(!(e instanceof Q))throw new Error("origin must be a DOMPointReadOnly");if(!(t instanceof Q))throw new Error("direction must be a DOMPointReadOnly");if(!(n instanceof Float32Array))throw new Error("transformMatrix must be a Float32Array");Object.defineProperties(this,{origin:{value:e,writable:!1},direction:{value:t,writable:!1},transformMatrix:{value:n,writable:!1}})}}const q=Symbol("@@webxr-polyfill/XRInputPose");class j{constructor(e,t){this[q]={inputSourceImpl:e,targetRay:new W,gripMatrix:t?h():null}}get targetRay(){return this[q].targetRay}set targetRay(e){this[q].targetRay=e}get emulatedPosition(){return this[q].inputSourceImpl.emulatedPosition}get gripMatrix(){return this[q].gripMatrix}}const Z=Symbol("@@webxr-polyfill/XRInputSource");class Y{constructor(e){this[Z]={impl:e}}get handedness(){return this[Z].impl.handedness}get targetRayMode(){return this[Z].impl.targetRayMode}}class J{constructor(){}getViewport(e){return e._getViewport(this)}}const K=Symbol("@@webxr-polyfill/polyfilled-compatible-xr-device"),$=Symbol("@@webxr-polyfill/compatible-xr-device"),ee=Symbol("@@webxr-polyfill/XRWebGLLayer"),te=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,framebufferScaleFactor:0});var ne={XR:o,XRDevice:H,XRSession:k,XRFrame:P,XRView:T,XRViewport:x,XRDevicePose:y,XRLayer:J,XRWebGLLayer:class extends J{constructor(e,t,n={}){const i=Object.assign({},te,n);if(!(e instanceof k))throw new Error("session must be a XRSession");if(e.ended)throw new Error("InvalidStateError");if(t[K]&&t[$]!==e.device)throw new Error("InvalidStateError");const r=t.getParameter(t.FRAMEBUFFER_BINDING);super(),this[ee]={context:t,config:i,framebuffer:r}}get context(){return this[ee].context}get antialias(){return this[ee].config.antialias}get depth(){return this[ee].config.depth}get stencil(){return this[ee].config.stencil}get alpha(){return this[ee].config.alpha}get multiview(){return!1}get framebuffer(){return this[ee].framebuffer}get framebufferWidth(){return this[ee].context.drawingBufferWidth}get framebufferHeight(){return this[ee].context.drawingBufferHeight}requestViewportScaling(e){console.warn("requestViewportScaling is not yet implemented")}},XRPresentationContext:c,XRCoordinateSystem:M,XRFrameOfReference:O,XRStageBounds:D,XRStageBoundsPoint:S,XRInputPose:j,XRInputSource:Y,XRRay:W};const ie=e=>"function"!=typeof e.prototype.setCompatibleXRDevice&&(e.prototype.setCompatibleXRDevice=function(e){return new Promise((t,n)=>{e&&"function"==typeof e.requestSession?t():n()}).then(()=>this[$]=e)},!0),re=(e,t)=>{const n=e.prototype.getContext;e.prototype.getContext=function(e,i){if(t&&"xrpresent"===e){let e=n.call(this,t,i);return new c(this,e,i)}const r=n.call(this,e,i);return r[K]=!0,i&&"compatibleXRDevice"in i&&(r[$]=i.compatibleXRDevice),r}};function ae(){let e=new m(3);return m!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function oe(e){var t=new m(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(e,t,n){let i=new m(3);return i[0]=e,i[1]=t,i[2]=n,i}function le(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ue(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function ce(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function fe(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function me(e,t){let n=t[0],i=t[1],r=t[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function he(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function de(e,t,n){let i=t[0],r=t[1],a=t[2],o=n[0],s=n[1],l=n[2];return e[0]=r*l-a*s,e[1]=a*o-i*l,e[2]=i*s-r*o,e}function Ae(e,t,n){let i=t[0],r=t[1],a=t[2],o=n[3]*i+n[7]*r+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/o,e[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/o,e[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/o,e}function pe(e,t,n){let i=n[0],r=n[1],a=n[2],o=n[3],s=t[0],l=t[1],u=t[2],c=r*u-a*l,f=a*s-i*u,m=i*l-r*s,h=r*m-a*f,d=a*c-i*m,A=i*f-r*c,p=2*o;return c*=p,f*=p,m*=p,h*=2,d*=2,A*=2,e[0]=s+c+h,e[1]=l+f+d,e[2]=u+m+A,e}const ve=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},ge=function(e){let t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)},be=(function(){let e=ae()}(),e=>!(!e.ImageBitmapRenderingContext||!e.createImageBitmap)),ye=e=>{const t=[],n=[];return ue(t,0,0,0),Ae(t,t,e),ue(n,0,0,-1),Ae(n,n,e),ve(n,n,t),me(n,n),new W(new Q(t[0],t[1],t[2],1),new Q(n[0],n[1],n[2],0),e)},we=e=>{var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(e.navigator.userAgent||e.navigator.vendor||e.opera),t},xe=e=>{e.style.display="block",e.style.position="absolute",e.style.width=e.style.height="1px",e.style.top=e.style.left="0px"};var Ee="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};var _e=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(e,t){e.exports=function(){var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(e,t,n){return e+(t-e)*n},r=function(){var e=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return e}}(),a=function(){var e=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome");return function(){return e}}(),o=(/^((?!chrome|android).)*safari/i.test(navigator.userAgent),function(){var e=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return e}}()),s=function(){var e=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),t=e?parseInt(e[1],10):null;return function(){return t}}(),l=function(){var e=!1;if(65===s()){var t=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(t){var i=t[1].split("."),r=n(i,4),a=(r[0],r[1],r[2]),o=r[3];e=3325===parseInt(a,10)&&parseInt(o,10)<148}}return function(){return e}}(),u=function(){var e=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return e}}(),c=function(){var e=90==window.orientation||-90==window.orientation;return u()?!e:e},f=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},m=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},h=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},d=function(e,t,n,i){var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,t),e.compileShader(r);var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,n),e.compileShader(a);var o=e.createProgram();for(var s in e.attachShader(o,r),e.attachShader(o,a),i)e.bindAttribLocation(o,i[s],s);return e.linkProgram(o),e.deleteShader(r),e.deleteShader(a),o},A=function(e,t){for(var n={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r="",a=0;a<i;a++){var o=e.getActiveUniform(t,a);r=o.name.replace("[0]",""),n[r]=e.getUniformLocation(t,r)}return n},p=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},v=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},g=function(e){if(r()){var t=e.style.width,n=e.style.height;e.style.width=parseInt(t)+1+"px",e.style.height=parseInt(n)+"px",setTimeout(function(){e.style.width=t,e.style.height=n},100)}window.canvas=e},b=function(){var e=Math.PI/180,t=.25*Math.PI,n=new Float32Array([0,0,0,1]),i=new Float32Array([0,0,0]);function r(r,a,o,s,l,u){!function(n,i,r,a){var o=Math.tan(i?i.upDegrees*e:t),s=Math.tan(i?i.downDegrees*e:t),l=Math.tan(i?i.leftDegrees*e:t),u=Math.tan(i?i.rightDegrees*e:t),c=2/(l+u),f=2/(o+s);n[0]=c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=-(l-u)*c*.5,n[9]=(o-s)*f*.5,n[10]=a/(r-a),n[11]=-1,n[12]=0,n[13]=0,n[14]=a*r/(r-a),n[15]=0}(r,s||null,u.depthNear,u.depthFar);var c=o.orientation||n,f=o.position||i;!function(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=i+i,l=r+r,u=a+a,c=i*s,f=i*l,m=i*u,h=r*l,d=r*u,A=a*u,p=o*s,v=o*l,g=o*u;e[0]=1-(h+A),e[1]=f+g,e[2]=m-v,e[3]=0,e[4]=f-g,e[5]=1-(c+A),e[6]=d+p,e[7]=0,e[8]=m+v,e[9]=d-p,e[10]=1-(c+h),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1}(a,c,f),l&&function(e,t,n){var i,r,a,o,s,l,u,c,f,m,h,d,A=n[0],p=n[1],v=n[2];t===e?(e[12]=t[0]*A+t[4]*p+t[8]*v+t[12],e[13]=t[1]*A+t[5]*p+t[9]*v+t[13],e[14]=t[2]*A+t[6]*p+t[10]*v+t[14],e[15]=t[3]*A+t[7]*p+t[11]*v+t[15]):(i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],f=t[8],m=t[9],h=t[10],d=t[11],e[0]=i,e[1]=r,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=f,e[9]=m,e[10]=h,e[11]=d,e[12]=i*A+s*p+f*v+t[12],e[13]=r*A+l*p+m*v+t[13],e[14]=a*A+u*p+h*v+t[14],e[15]=o*A+c*p+d*v+t[15])}(a,a,l),function(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],f=t[9],m=t[10],h=t[11],d=t[12],A=t[13],p=t[14],v=t[15],g=n*s-i*o,b=n*l-r*o,y=n*u-a*o,w=i*l-r*s,x=i*u-a*s,E=r*u-a*l,_=c*A-f*d,T=c*p-m*d,R=c*v-h*d,P=f*p-m*A,F=f*v-h*A,S=m*v-h*p,C=g*S-b*F+y*P+w*R-x*T+E*_;if(!C)return null;C=1/C,e[0]=(s*S-l*F+u*P)*C,e[1]=(r*F-i*S-a*P)*C,e[2]=(A*E-p*x+v*w)*C,e[3]=(m*x-f*E-h*w)*C,e[4]=(l*R-o*S-u*T)*C,e[5]=(n*S-r*R+a*T)*C,e[6]=(p*y-d*E-v*b)*C,e[7]=(c*E-m*y+h*b)*C,e[8]=(o*F-s*R+u*_)*C,e[9]=(i*R-n*F-a*_)*C,e[10]=(d*x-A*y+v*g)*C,e[11]=(f*y-c*x-h*g)*C,e[12]=(s*T-o*P-l*_)*C,e[13]=(n*P-i*T+r*_)*C,e[14]=(A*b-d*w-p*g)*C,e[15]=(c*w-f*b+m*g)*C}(a,a)}return function(e,t,n){return!(!e||!t||(e.pose=t,e.timestamp=t.timestamp,r(e.leftProjectionMatrix,e.leftViewMatrix,t,n._getFieldOfView("left"),n._getEyeOffset("left"),n),r(e.rightProjectionMatrix,e.rightViewMatrix,t,n._getFieldOfView("right"),n._getEyeOffset("right"),n),0))}}(),y=function(e){var t,n=e.indexOf("://");t=-1!==n?n+3:0;var i=e.indexOf("/",t);return-1===i&&(i=e.length),e.substring(0,i)},w=function(){var e={};return function(t,n){void 0===e[t]&&(console.warn("webvr-polyfill: "+n),e[t]=!0)}}(),x=function(e,t){var n=t?"Please use "+t+" instead.":"";w(e,e+" has been deprecated. This may not work on native WebVR displays. "+n)},E=function(e,t,n){if(t){for(var i=[],r=null,a=0;a<t.length;++a){var o=t[a];switch(o){case e.TEXTURE_BINDING_2D:case e.TEXTURE_BINDING_CUBE_MAP:var s=t[++a];if(s<e.TEXTURE0||s>e.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),i.push(null,null);break}r||(r=e.getParameter(e.ACTIVE_TEXTURE)),e.activeTexture(s),i.push(e.getParameter(o),null);break;case e.ACTIVE_TEXTURE:r=e.getParameter(e.ACTIVE_TEXTURE),i.push(null);break;default:i.push(e.getParameter(o))}}n(e);for(var a=0;a<t.length;++a){var o=t[a],l=i[a];switch(o){case e.ACTIVE_TEXTURE:break;case e.ARRAY_BUFFER_BINDING:e.bindBuffer(e.ARRAY_BUFFER,l);break;case e.COLOR_CLEAR_VALUE:e.clearColor(l[0],l[1],l[2],l[3]);break;case e.COLOR_WRITEMASK:e.colorMask(l[0],l[1],l[2],l[3]);break;case e.CURRENT_PROGRAM:e.useProgram(l);break;case e.ELEMENT_ARRAY_BUFFER_BINDING:e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,l);break;case e.FRAMEBUFFER_BINDING:e.bindFramebuffer(e.FRAMEBUFFER,l);break;case e.RENDERBUFFER_BINDING:e.bindRenderbuffer(e.RENDERBUFFER,l);break;case e.TEXTURE_BINDING_2D:var s=t[++a];if(s<e.TEXTURE0||s>e.TEXTURE31)break;e.activeTexture(s),e.bindTexture(e.TEXTURE_2D,l);break;case e.TEXTURE_BINDING_CUBE_MAP:var s=t[++a];if(s<e.TEXTURE0||s>e.TEXTURE31)break;e.activeTexture(s),e.bindTexture(e.TEXTURE_CUBE_MAP,l);break;case e.VIEWPORT:e.viewport(l[0],l[1],l[2],l[3]);break;case e.BLEND:case e.CULL_FACE:case e.DEPTH_TEST:case e.SCISSOR_TEST:case e.STENCIL_TEST:l?e.enable(o):e.disable(o);break;default:console.log("No GL restore behavior for 0x"+o.toString(16))}r&&e.activeTexture(r)}}else n(e)},_=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),T=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function R(e,t,n,i){this.gl=e,this.cardboardUI=t,this.bufferScale=n,this.dirtySubmitFrameBindings=i,this.ctxAttribs=e.getContextAttributes(),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=e.drawingBufferWidth,this.bufferHeight=e.drawingBufferHeight,this.realBindFramebuffer=e.bindFramebuffer,this.realEnable=e.enable,this.realDisable=e.disable,this.realColorMask=e.colorMask,this.realClearColor=e.clearColor,this.realViewport=e.viewport,r()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=d(e,_,T,this.attribs),this.uniforms=A(e,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.indexCount=0,this.renderTarget=e.createTexture(),this.framebuffer=e.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=e.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=e.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=e.createRenderbuffer()),this.patch(),this.onResize()}R.prototype.destroy=function(){var e=this.gl;this.unpatch(),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteTexture(this.renderTarget),e.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&e.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&e.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&e.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},R.prototype.onResize=function(){var e=this.gl,t=this,n=[e.RENDERBUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0];E(e,n,function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.framebuffer),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.texImage2D(e.TEXTURE_2D,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,t.bufferWidth,t.bufferHeight,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.renderTarget,0),t.ctxAttribs.depth&&t.ctxAttribs.stencil?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t.depthStencilBuffer)):t.ctxAttribs.depth?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.depthBuffer)):t.ctxAttribs.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,t.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,t.stencilBuffer)),!e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),t.realClearColor.apply(e,t.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},R.prototype.patch=function(){if(!this.isPatched){var e=this,t=this.gl.canvas,n=this.gl;r()||(t.width=f()*this.bufferScale,t.height=m()*this.bufferScale,Object.defineProperty(t,"width",{configurable:!0,enumerable:!0,get:function(){return e.bufferWidth},set:function(n){e.bufferWidth=n,e.realCanvasWidth.set.call(t,n),e.onResize()}}),Object.defineProperty(t,"height",{configurable:!0,enumerable:!0,get:function(){return e.bufferHeight},set:function(n){e.bufferHeight=n,e.realCanvasHeight.set.call(t,n),e.onResize()}})),this.lastBoundFramebuffer=n.getParameter(n.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(t,i){e.lastBoundFramebuffer=i||e.framebuffer,e.realBindFramebuffer.call(n,t,e.lastBoundFramebuffer)},this.cullFace=n.getParameter(n.CULL_FACE),this.depthTest=n.getParameter(n.DEPTH_TEST),this.blend=n.getParameter(n.BLEND),this.scissorTest=n.getParameter(n.SCISSOR_TEST),this.stencilTest=n.getParameter(n.STENCIL_TEST),n.enable=function(t){switch(t){case n.CULL_FACE:e.cullFace=!0;break;case n.DEPTH_TEST:e.depthTest=!0;break;case n.BLEND:e.blend=!0;break;case n.SCISSOR_TEST:e.scissorTest=!0;break;case n.STENCIL_TEST:e.stencilTest=!0}e.realEnable.call(n,t)},n.disable=function(t){switch(t){case n.CULL_FACE:e.cullFace=!1;break;case n.DEPTH_TEST:e.depthTest=!1;break;case n.BLEND:e.blend=!1;break;case n.SCISSOR_TEST:e.scissorTest=!1;break;case n.STENCIL_TEST:e.stencilTest=!1}e.realDisable.call(n,t)},this.colorMask=n.getParameter(n.COLOR_WRITEMASK),n.colorMask=function(t,i,r,a){e.colorMask[0]=t,e.colorMask[1]=i,e.colorMask[2]=r,e.colorMask[3]=a,e.realColorMask.call(n,t,i,r,a)},this.clearColor=n.getParameter(n.COLOR_CLEAR_VALUE),n.clearColor=function(t,i,r,a){e.clearColor[0]=t,e.clearColor[1]=i,e.clearColor[2]=r,e.clearColor[3]=a,e.realClearColor.call(n,t,i,r,a)},this.viewport=n.getParameter(n.VIEWPORT),n.viewport=function(t,i,r,a){e.viewport[0]=t,e.viewport[1]=i,e.viewport[2]=r,e.viewport[3]=a,e.realViewport.call(n,t,i,r,a)},this.isPatched=!0,g(t)}},R.prototype.unpatch=function(){if(this.isPatched){var e=this.gl,t=this.gl.canvas;r()||(Object.defineProperty(t,"width",this.realCanvasWidth),Object.defineProperty(t,"height",this.realCanvasHeight)),t.width=this.bufferWidth,t.height=this.bufferHeight,e.bindFramebuffer=this.realBindFramebuffer,e.enable=this.realEnable,e.disable=this.realDisable,e.colorMask=this.realColorMask,e.clearColor=this.realClearColor,e.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){g(t)},1)}},R.prototype.setTextureBounds=function(e,t){e||(e=[0,0,.5,1]),t||(t=[.5,0,.5,1]),this.viewportOffsetScale[0]=e[0],this.viewportOffsetScale[1]=e[1],this.viewportOffsetScale[2]=e[2],this.viewportOffsetScale[3]=e[3],this.viewportOffsetScale[4]=t[0],this.viewportOffsetScale[5]=t[1],this.viewportOffsetScale[6]=t[2],this.viewportOffsetScale[7]=t[3]},R.prototype.submitFrame=function(){var e=this.gl,t=this,n=[];if(this.dirtySubmitFrameBindings||n.push(e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING,e.ELEMENT_ARRAY_BUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0),E(e,n,function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.cullFace&&t.realDisable.call(e,e.CULL_FACE),t.depthTest&&t.realDisable.call(e,e.DEPTH_TEST),t.blend&&t.realDisable.call(e,e.BLEND),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realDisable.call(e,e.STENCIL_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),(t.ctxAttribs.alpha||r())&&(t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)),e.useProgram(t.program),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.enableVertexAttribArray(t.attribs.position),e.enableVertexAttribArray(t.attribs.texCoord),e.vertexAttribPointer(t.attribs.position,2,e.FLOAT,!1,20,0),e.vertexAttribPointer(t.attribs.texCoord,3,e.FLOAT,!1,20,8),e.activeTexture(e.TEXTURE0),e.uniform1i(t.uniforms.diffuse,0),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.uniform4fv(t.uniforms.viewportOffsetScale,t.viewportOffsetScale),e.drawElements(e.TRIANGLES,t.indexCount,e.UNSIGNED_SHORT,0),t.cardboardUI&&t.cardboardUI.renderNoState(),t.realBindFramebuffer.call(t.gl,e.FRAMEBUFFER,t.framebuffer),t.ctxAttribs.preserveDrawingBuffer||(t.realClearColor.call(e,0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)),t.dirtySubmitFrameBindings||t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.cullFace&&t.realEnable.call(e,e.CULL_FACE),t.depthTest&&t.realEnable.call(e,e.DEPTH_TEST),t.blend&&t.realEnable.call(e,e.BLEND),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realEnable.call(e,e.STENCIL_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),!t.ctxAttribs.alpha&&t.ctxAttribs.preserveDrawingBuffer||t.realClearColor.apply(e,t.clearColor)}),r()){var i=e.canvas;i.width==t.bufferWidth&&i.height==t.bufferHeight||(t.bufferWidth=i.width,t.bufferHeight=i.height,t.onResize())}},R.prototype.updateDeviceInfo=function(e){var t=this.gl,n=this,i=[t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING];E(t,i,function(t){var i=n.computeMeshVertices_(n.meshWidth,n.meshHeight,e);if(t.bindBuffer(t.ARRAY_BUFFER,n.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),!n.indexCount){var r=n.computeMeshIndices_(n.meshWidth,n.meshHeight);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),n.indexCount=r.length}})},R.prototype.computeMeshVertices_=function(e,t,n){for(var r=new Float32Array(2*e*t*5),a=n.getLeftEyeVisibleTanAngles(),o=n.getLeftEyeNoLensTanAngles(),s=n.getLeftEyeVisibleScreenRect(o),l=0,u=0;u<2;u++){for(var c=0;c<t;c++)for(var f=0;f<e;f++,l++){var m=f/(e-1),h=c/(t-1),d=m,A=h,p=i(a[0],a[2],m),v=i(a[3],a[1],h),g=Math.sqrt(p*p+v*v),b=n.distortion.distortInverse(g),y=p*b/g,w=v*b/g;m=(y-o[0])/(o[2]-o[0]),h=(w-o[3])/(o[1]-o[3]),m=2*(s.x+m*s.width-.5),h=2*(s.y+h*s.height-.5),r[5*l+0]=m,r[5*l+1]=h,r[5*l+2]=d,r[5*l+3]=A,r[5*l+4]=u}var x=a[2]-a[0];a[0]=-(x+a[0]),a[2]=x-a[2],x=o[2]-o[0],o[0]=-(x+o[0]),o[2]=x-o[2],s.x=1-(s.x+s.width)}return r},R.prototype.computeMeshIndices_=function(e,t){for(var n=new Uint16Array(2*(e-1)*(t-1)*6),i=e/2,r=t/2,a=0,o=0,s=0;s<2;s++)for(var l=0;l<t;l++)for(var u=0;u<e;u++,a++)0!=u&&0!=l&&(u<=i==l<=r?(n[o++]=a,n[o++]=a-e-1,n[o++]=a-e,n[o++]=a-e-1,n[o++]=a,n[o++]=a-1):(n[o++]=a-1,n[o++]=a-e,n[o++]=a,n[o++]=a-e,n[o++]=a-1,n[o++]=a-e-1));return n},R.prototype.getOwnPropertyDescriptor_=function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n.get&&void 0!==n.set||(n.configurable=!0,n.enumerable=!0,n.get=function(){return this.getAttribute(t)},n.set=function(e){this.setAttribute(t,e)}),n};var P=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),F=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),S=Math.PI/180,C=.3125;function D(e){this.gl=e,this.attribs={position:0},this.program=d(e,P,F,this.attribs),this.uniforms=A(e,this.program),this.vertexBuffer=e.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function M(e){this.coefficients=e}D.prototype.destroy=function(){var e=this.gl;this.listener&&e.canvas.removeEventListener("click",this.listener,!1),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer)},D.prototype.listen=function(e,t){var n=this.gl.canvas;this.listener=function(i){var r=n.clientWidth/2;i.clientX>r-42&&i.clientX<r+42&&i.clientY>n.clientHeight-42?e(i):i.clientX<42&&i.clientY<42&&t(i)},n.addEventListener("click",this.listener,!1)},D.prototype.onResize=function(){var e=this.gl,t=this,n=[e.ARRAY_BUFFER_BINDING];E(e,n,function(e){var n=[],i=e.drawingBufferWidth/2,r=Math.max(screen.width,screen.height)*window.devicePixelRatio,a=e.drawingBufferWidth/r,o=a*window.devicePixelRatio,s=4*o/2,l=42*o,u=28*o/2,c=14*o;function f(e,t){var r=(90-e)*S,a=Math.cos(r),o=Math.sin(r);n.push(C*a*u+i,C*o*u+u),n.push(t*a*u+i,t*o*u+u)}n.push(i-s,l),n.push(i-s,e.drawingBufferHeight),n.push(i+s,l),n.push(i+s,e.drawingBufferHeight),t.gearOffset=n.length/2;for(var m=0;m<=6;m++){var h=60*m;f(h,1),f(h+12,1),f(h+20,.75),f(h+40,.75),f(h+48,1)}function d(t,i){n.push(c+t,e.drawingBufferHeight-c-i)}t.gearVertexCount=n.length/2-t.gearOffset,t.arrowOffset=n.length/2;var A=s/Math.sin(45*S);d(0,u),d(u,0),d(u+A,A),d(A,u+A),d(A,u-A),d(0,u),d(u,2*u),d(u+A,2*u-A),d(A,u-A),d(0,u),d(A,u-s),d(28*o,u-s),d(A,u+s),d(28*o,u+s),t.arrowVertexCount=n.length/2-t.arrowOffset,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW)})},D.prototype.render=function(){var e=this.gl,t=this,n=[e.CULL_FACE,e.DEPTH_TEST,e.BLEND,e.SCISSOR_TEST,e.STENCIL_TEST,e.COLOR_WRITEMASK,e.VIEWPORT,e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING];E(e,n,function(e){e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.colorMask(!0,!0,!0,!0),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.renderNoState()})},D.prototype.renderNoState=function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.enableVertexAttribArray(this.attribs.position),e.vertexAttribPointer(this.attribs.position,2,e.FLOAT,!1,8,0),e.uniform4f(this.uniforms.color,1,1,1,1),function(e,t,n,i,r,a,o){var s=1/(t-n),l=1/(i-r),u=1/(a-o);e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*s,e[13]=(r+i)*l,e[14]=(o+a)*u,e[15]=1}(this.projMat,0,e.drawingBufferWidth,0,e.drawingBufferHeight,.1,1024),e.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.drawArrays(e.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),e.drawArrays(e.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},M.prototype.distortInverse=function(e){for(var t=0,n=1,i=e-this.distort(t);Math.abs(n-t)>1e-4;){var r=e-this.distort(n),a=n-r*((n-t)/(r-i));t=n,n=a,i=r}return n},M.prototype.distort=function(e){for(var t=e*e,n=0,i=0;i<this.coefficients.length;i++)n=t*(n+this.coefficients[i]);return(n+1)*e};var I=Math.PI/180,L=180/Math.PI,N=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0};N.prototype={constructor:N,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=this.length();if(0!==e){var t=1/e;this.multiplyScalar(t)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(e){this.x*=e,this.y*=e,this.z*=e},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*i-o*n,u=s*n+o*t-r*i,c=s*i+r*n-a*t,f=-r*t-a*n-o*i;return this.x=l*s+f*-r+u*-o-c*-a,this.y=u*s+f*-a+c*-r-l*-o,this.z=c*s+f*-o+l*-a-u*-r,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}};var B=function(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==i?i:1};function O(e){this.width=e.width||f(),this.height=e.height||m(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters}B.prototype={constructor:B,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEulerXYZ:function(e,t,n){var i=Math.cos(e/2),r=Math.cos(t/2),a=Math.cos(n/2),o=Math.sin(e/2),s=Math.sin(t/2),l=Math.sin(n/2);return this.x=o*r*a+i*s*l,this.y=i*s*a-o*r*l,this.z=i*r*l+o*s*a,this.w=i*r*a-o*s*l,this},setFromEulerYXZ:function(e,t,n){var i=Math.cos(e/2),r=Math.cos(t/2),a=Math.cos(n/2),o=Math.sin(e/2),s=Math.sin(t/2),l=Math.sin(n/2);return this.x=o*r*a+i*s*l,this.y=i*s*a-o*r*l,this.z=i*r*l-o*s*a,this.w=i*r*a+o*s*l,this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(n),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e.x,i=e.y,r=e.z,a=e.w,o=t.x,s=t.y,l=t.z,u=t.w;return this.x=n*u+a*o+i*l-r*s,this.y=i*u+a*s+r*o-n*l,this.z=r*u+a*l+n*s-i*o,this.w=a*u-n*o-i*s-r*l,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this.x,i=this.y,r=this.z,a=this.w,o=a*e.w+n*e.x+i*e.y+r*e.z;if(o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),o>=1)return this.w=a,this.x=n,this.y=i,this.z=r,this;var s=Math.acos(o),l=Math.sqrt(1-o*o);if(Math.abs(l)<.001)return this.w=.5*(a+this.w),this.x=.5*(n+this.x),this.y=.5*(i+this.y),this.z=.5*(r+this.z),this;var u=Math.sin((1-t)*s)/l,c=Math.sin(t*s)/l;return this.w=a*u+this.w*c,this.x=n*u+this.x*c,this.y=i*u+this.y*c,this.z=r*u+this.z*c,this},setFromUnitVectors:function(){var e,t;return function(n,i){return void 0===e&&(e=new N),(t=n.dot(i)+1)<1e-6?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,i),this.x=e.x,this.y=e.y,this.z=e.z,this.w=t,this.normalize(),this}}()};var z=new O({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),G=new O({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),U={CardboardV1:new V({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new V({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function k(e,t){this.viewer=U.CardboardV2,this.updateDeviceParams(e),this.distortion=new M(this.viewer.distortionCoefficients);for(var n=0;n<t.length;n++){var i=t[n];U[i.id]=new V(i)}}function V(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients}k.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},k.prototype.getDevice=function(){return this.device},k.prototype.setViewer=function(e){this.viewer=e,this.distortion=new M(this.viewer.distortionCoefficients)},k.prototype.determineDevice_=function(e){if(!e)return r()?(console.warn("Using fallback iOS device measurements."),G):(console.warn("Using fallback Android device measurements."),z);var t=.0254/e.xdpi,n=.0254/e.ydpi,i=f(),a=m();return new O({widthMeters:t*i,heightMeters:n*a,bevelMeters:.001*e.bevelMm})},k.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,t=this.device,n=this.distortion,i=e.screenLensDistance,r=(t.widthMeters-e.interLensDistance)/2,a=e.interLensDistance/2,o=e.baselineLensDistance-t.bevelMeters,s=t.heightMeters-o,l=L*Math.atan(n.distort(r/i)),u=L*Math.atan(n.distort(a/i)),c=L*Math.atan(n.distort(o/i)),f=L*Math.atan(n.distort(s/i));return{leftDegrees:Math.min(l,e.fov),rightDegrees:Math.min(u,e.fov),downDegrees:Math.min(c,e.fov),upDegrees:Math.min(f,e.fov)}},k.prototype.getLeftEyeVisibleTanAngles=function(){var e=this.viewer,t=this.device,n=this.distortion,i=Math.tan(-I*e.fov),r=Math.tan(I*e.fov),a=Math.tan(I*e.fov),o=Math.tan(-I*e.fov),s=t.widthMeters/4,l=t.heightMeters/2,u=e.baselineLensDistance-t.bevelMeters-l,c=e.interLensDistance/2-s,f=-u,m=e.screenLensDistance,h=n.distort((c-s)/m),d=n.distort((f+l)/m),A=n.distort((c+s)/m),p=n.distort((f-l)/m),v=new Float32Array(4);return v[0]=Math.max(i,h),v[1]=Math.min(r,d),v[2]=Math.min(a,A),v[3]=Math.max(o,p),v},k.prototype.getLeftEyeNoLensTanAngles=function(){var e=this.viewer,t=this.device,n=this.distortion,i=new Float32Array(4),r=n.distortInverse(Math.tan(-I*e.fov)),a=n.distortInverse(Math.tan(I*e.fov)),o=n.distortInverse(Math.tan(I*e.fov)),s=n.distortInverse(Math.tan(-I*e.fov)),l=t.widthMeters/4,u=t.heightMeters/2,c=e.baselineLensDistance-t.bevelMeters-u,f=e.interLensDistance/2-l,m=-c,h=e.screenLensDistance,d=(f-l)/h,A=(m+u)/h,p=(f+l)/h,v=(m-u)/h;return i[0]=Math.max(r,d),i[1]=Math.min(a,A),i[2]=Math.min(o,p),i[3]=Math.max(s,v),i},k.prototype.getLeftEyeVisibleScreenRect=function(e){var t=this.viewer,n=this.device,i=t.screenLensDistance,r=(n.widthMeters-t.interLensDistance)/2,a=t.baselineLensDistance-n.bevelMeters,o=(e[0]*i+r)/n.widthMeters,s=(e[1]*i+a)/n.heightMeters,l=(e[2]*i+r)/n.widthMeters,u=(e[3]*i+a)/n.heightMeters;return{x:o,y:u,width:l-o,height:s-u}},k.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},k.prototype.getFieldOfViewRightEye=function(e){var t=this.getFieldOfViewLeftEye(e);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,downDegrees:t.downDegrees}},k.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:L*Math.atan(e.outerDist),rightDegrees:L*Math.atan(e.innerDist),downDegrees:L*Math.atan(e.bottomDist),upDegrees:L*Math.atan(e.topDist)}},k.prototype.getUndistortedViewportLeftEye=function(){var e=this.getUndistortedParams_(),t=this.viewer,n=this.device,i=t.screenLensDistance,r=n.widthMeters/i,a=n.heightMeters/i,o=n.width/r,s=n.height/a,l=Math.round((e.eyePosX-e.outerDist)*o),u=Math.round((e.eyePosY-e.bottomDist)*s);return{x:l,y:u,width:Math.round((e.eyePosX+e.innerDist)*o)-l,height:Math.round((e.eyePosY+e.topDist)*s)-u}},k.prototype.getUndistortedParams_=function(){var e=this.viewer,t=this.device,n=this.distortion,i=e.screenLensDistance,r=e.interLensDistance/2/i,a=t.widthMeters/i,o=t.heightMeters/i,s=a/2-r,l=(e.baselineLensDistance-t.bevelMeters)/i,u=e.fov,c=n.distortInverse(Math.tan(I*u)),f=Math.min(s,c),m=Math.min(r,c),h=Math.min(l,c),d=Math.min(o-l,c);return{outerDist:f,innerDist:m,topDist:d,bottomDist:h,eyePosX:s,eyePosY:l}},k.Viewers=U;var H={format:1,last_updated:"2018-12-10T17:01:42Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3}]};function X(e,t){if(this.dpdb=H,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=t;var n=new XMLHttpRequest,i=this;n.open("GET",e,!0),n.addEventListener("load",function(){i.loading=!1,n.status>=200&&n.status<=299?(i.dpdb=JSON.parse(n.response),i.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),n.send()}}function Q(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm}function W(e,t){this.set(e,t)}function q(e,t){this.kFilter=e,this.isDebug=t,this.currentAccelMeasurement=new W,this.currentGyroMeasurement=new W,this.previousGyroMeasurement=new W,r()?this.filterQ=new B(-1,0,0,1):this.filterQ=new B(1,0,0,1),this.previousFilterQ=new B,this.previousFilterQ.copy(this.filterQ),this.accelQ=new B,this.isOrientationInitialized=!1,this.estimatedGravity=new N,this.measuredGravity=new N,this.gyroIntegralQ=new B}function j(e,t){this.predictionTimeS=e,this.isDebug=t,this.previousQ=new B,this.previousTimestampS=null,this.deltaQ=new B,this.outQ=new B}function Z(e,t,n,i){this.yawOnly=n,this.accelerometer=new N,this.gyroscope=new N,this.filter=new q(e,i),this.posePredictor=new j(t,i),this.isFirefoxAndroid=o(),this.isIOS=r();var a=s();this.isDeviceMotionInRadians=!this.isIOS&&a&&a<66,this.isWithoutDeviceMotion=l(),this.filterToWorldQ=new B,r()?this.filterToWorldQ.setFromAxisAngle(new N(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new N(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new B,this.worldToScreenQ=new B,this.originalPoseAdjustQ=new B,this.originalPoseAdjustQ.setFromAxisAngle(new N(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),c()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new B,this.orientationOut_=new Float32Array(4),this.start()}X.prototype.getDeviceParams=function(){return this.deviceParams},X.prototype.recalculateDeviceParams_=function(){var e=this.calcDeviceParams_();e?(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},X.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return console.error("DPDB not available."),null;if(1!=e.format)return console.error("DPDB has unexpected format version."),null;if(!e.devices||!e.devices.length)return console.error("DPDB does not have a devices section."),null;var t=navigator.userAgent||navigator.vendor||window.opera,n=f(),i=m();if(!e.devices)return console.error("DPDB has no devices section."),null;for(var a=0;a<e.devices.length;a++){var o=e.devices[a];if(o.rules)if("ios"==o.type||"android"==o.type){if(r()==("ios"==o.type)){for(var s=!1,l=0;l<o.rules.length;l++){var u=o.rules[l];if(this.ruleMatches_(u,t,n,i)){s=!0;break}}if(s){var c=o.dpi[0]||o.dpi,h=o.dpi[1]||o.dpi;return new Q({xdpi:c,ydpi:h,bevelMm:o.bw})}}}else console.warn("Device["+a+"] has invalid type.");else console.warn("Device["+a+"] has no rules section.")}return console.warn("No DPDB device match."),null},X.prototype.ruleMatches_=function(e,t,n,i){if(!e.ua&&!e.res)return!1;if(e.ua&&"SM"===e.ua.substring(0,2)&&(e.ua=e.ua.substring(0,7)),e.ua&&t.indexOf(e.ua)<0)return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var r=e.res[0],a=e.res[1];if(Math.min(n,i)!=Math.min(r,a)||Math.max(n,i)!=Math.max(r,a))return!1}return!0},W.prototype.set=function(e,t){this.sample=e,this.timestampS=t},W.prototype.copy=function(e){this.set(e.sample,e.timestampS)},q.prototype.addAccelMeasurement=function(e,t){this.currentAccelMeasurement.set(e,t)},q.prototype.addGyroMeasurement=function(e,t){this.currentGyroMeasurement.set(e,t);var n=t-this.previousGyroMeasurement.timestampS;(function(e){return!isNaN(e)&&(!(e<=.001)&&!(e>1))})(n)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},q.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var e=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,e);this.gyroIntegralQ.multiply(t),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(t);var n=new B;n.copy(this.filterQ),n.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(n),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var i=new B;i.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),i.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",L*function(e){return e.w>1?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos(e.w)}(i),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var r=new B;r.copy(this.filterQ),r.multiply(i),this.filterQ.slerp(r,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},q.prototype.getOrientation=function(){return this.filterQ},q.prototype.accelToQuaternion_=function(e){var t=new N;t.copy(e),t.normalize();var n=new B;return n.setFromUnitVectors(new N(0,0,-1),t),n.inverse(),n},q.prototype.gyroToQuaternionDelta_=function(e,t){var n=new B,i=new N;return i.copy(e),i.normalize(),n.setFromAxisAngle(i,e.length()*t),n},j.prototype.getPrediction=function(e,t,n){if(!this.previousTimestampS)return this.previousQ.copy(e),this.previousTimestampS=n,e;var i=new N;i.copy(t),i.normalize();var r=t.length();if(r<20*I)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(L*r).toFixed(1)),this.outQ.copy(e),this.previousQ.copy(e),this.outQ;var a=r*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(i,a),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(e),this.previousTimestampS=n,this.outQ},Z.prototype.getPosition=function(){return null},Z.prototype.getOrientation=function(){var e=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var e=(new B).setFromAxisAngle(new N(0,0,-1),0),t=new B;return-90===window.orientation?t.setFromAxisAngle(new N(0,1,0),Math.PI/-2):t.setFromAxisAngle(new N(0,1,0),Math.PI/2),e.multiply(t)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var e=new B;return e.setFromAxisAngle(new N(1,0,0),-Math.PI/2),e}(),e=this._deviceOrientationQ;var t=new B;return t.copy(e),t.multiply(this.deviceOrientationFilterToWorldQ),t.multiply(this.resetQ),t.multiply(this.worldToScreenQ),t.multiplyQuaternions(this.deviceOrientationFixQ,t),this.yawOnly&&(t.x=0,t.z=0,t.normalize()),this.orientationOut_[0]=t.x,this.orientationOut_[1]=t.y,this.orientationOut_[2]=t.z,this.orientationOut_[3]=t.w,this.orientationOut_}var n=this.filter.getOrientation();e=this.posePredictor.getPrediction(n,this.gyroscope,this.previousTimestampS);var t=new B;return t.copy(this.filterToWorldQ),t.multiply(this.resetQ),t.multiply(e),t.multiply(this.worldToScreenQ),this.yawOnly&&(t.x=0,t.z=0,t.normalize()),this.orientationOut_[0]=t.x,this.orientationOut_[1]=t.y,this.orientationOut_[2]=t.z,this.orientationOut_[3]=t.w,this.orientationOut_},Z.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),c()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Z.prototype.onDeviceOrientation_=function(e){this._deviceOrientationQ=this._deviceOrientationQ||new B;var t=e.alpha,n=e.beta,i=e.gamma;t=(t||0)*Math.PI/180,n=(n||0)*Math.PI/180,i=(i||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(n,t,-i)},Z.prototype.onDeviceMotion_=function(e){this.updateDeviceMotion_(e)},Z.prototype.updateDeviceMotion_=function(e){var t=e.accelerationIncludingGravity,n=e.rotationRate,i=e.timeStamp/1e3,r=i-this.previousTimestampS;return r<0?(w("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),void(this.previousTimestampS=i)):r<=.001||r>1?(w("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),void(this.previousTimestampS=i)):(this.accelerometer.set(-t.x,-t.y,-t.z),u()?this.gyroscope.set(-n.beta,n.alpha,n.gamma):this.gyroscope.set(n.alpha,n.beta,n.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addAccelMeasurement(this.accelerometer,i),this.filter.addGyroMeasurement(this.gyroscope,i),void(this.previousTimestampS=i))},Z.prototype.onOrientationChange_=function(e){this.setScreenTransform_()},Z.prototype.onMessage_=function(e){var t=e.data;if(t&&t.type){var n=t.type.toLowerCase();"devicemotion"===n&&this.updateDeviceMotion_(t.deviceMotionEvent)}},Z.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new N(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new N(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Z.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),r()&&function(){var e=window.self!==window.top,t=y(document.referrer),n=y(window.location.href);return e&&t!==n}()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Z.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var Y=new N(1,0,0),J=new N(0,0,1),K=new B;K.setFromAxisAngle(Y,-Math.PI/2),K.multiply((new B).setFromAxisAngle(J,Math.PI/2));var $=function(){function n(t){e(this,n),this.config=t,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new B,this._outQ=new B,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return t(n,[{key:"init",value:function(){var e=null;try{(e=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(e){this.errors.push(e),"SecurityError"===e.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===e.name?this.useDeviceMotion():console.error(e)}e&&(this.api="sensor",this.sensor=e,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Z(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var e=this.sensor.quaternion;this._sensorQ.set(e[0],e[1],e[2],e[3]);var t=this._outQ;return t.copy(K),t.multiply(this._sensorQ),this.config.YAW_ONLY&&(t.x=t.z=0,t.normalize()),this._out[0]=t.x,this._out[1]=t.y,this._out[2]=t.z,this._out[3]=t.w,this._out}},{key:"_onSensorError",value:function(e){this.errors.push(e.error),"NotAllowedError"===e.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===e.error.name?console.error("Sensor could not be read"):console.error(e.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),n}();function ee(){this.loadIcon_();var e=document.createElement("div"),t=e.style;t.position="fixed",t.top=0,t.right=0,t.bottom=0,t.left=0,t.backgroundColor="gray",t.fontFamily="sans-serif",t.zIndex=1e6;var n=document.createElement("img");n.src=this.icon;var t=n.style;t.marginLeft="25%",t.marginTop="25%",t.width="50%",e.appendChild(n);var i=document.createElement("div"),t=i.style;t.textAlign="center",t.fontSize="16px",t.lineHeight="24px",t.margin="24px 25%",t.width="50%",i.innerHTML="Place your phone into your Cardboard viewer.",e.appendChild(i);var r=document.createElement("div"),t=r.style;t.backgroundColor="#CFD8DC",t.position="fixed",t.bottom=0,t.width="100%",t.height="48px",t.padding="14px 24px",t.boxSizing="border-box",t.color="#656A6B",e.appendChild(r);var a=document.createElement("div");a.style.float="left",a.innerHTML="No Cardboard viewer?";var o=document.createElement("a");o.href="https://www.google.com/get/cardboard/get-cardboard/",o.innerHTML="get one",o.target="_blank";var t=o.style;t.float="right",t.fontWeight=600,t.textTransform="uppercase",t.borderLeft="1px solid gray",t.paddingLeft="24px",t.textDecoration="none",t.color="#656A6B",r.appendChild(a),r.appendChild(o),this.overlay=e,this.text=i,this.hide()}ee.prototype.show=function(e){e||this.overlay.parentElement?e&&(this.overlay.parentElement&&this.overlay.parentElement!=e&&this.overlay.parentElement.removeChild(this.overlay),e.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var t=this.overlay.querySelector("img"),n=t.style;c()?(n.width="20%",n.marginLeft="40%",n.marginTop="3%"):(n.width="50%",n.marginLeft="25%",n.marginTop="25%")},ee.prototype.hide=function(){this.overlay.style.display="none"},ee.prototype.showTemporarily=function(e,t){this.show(t),this.timer=setTimeout(this.hide.bind(this),e)},ee.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},ee.prototype.update=function(){this.disableShowTemporarily(),!c()&&p()?this.show():this.hide()},ee.prototype.loadIcon_=function(){this.icon=function(e,t){return"data:"+e+","+encodeURIComponent(t)}("image/svg+xml","<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};var te="CardboardV1",ne="WEBVR_CARDBOARD_VIEWER";function ie(e){try{this.selectedKey=localStorage.getItem(ne)}catch(e){console.error("Failed to load viewer profile: %s",e)}this.selectedKey||(this.selectedKey=e||te),this.dialog=this.createDialog_(k.Viewers),this.root=null,this.onChangeCallbacks_=[]}ie.prototype.show=function(e){this.root=e,e.appendChild(this.dialog);var t=this.dialog.querySelector("#"+this.selectedKey);t.checked=!0,this.dialog.style.display="block"},ie.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},ie.prototype.getCurrentViewer=function(){return k.Viewers[this.selectedKey]},ie.prototype.getSelectedKey_=function(){var e=this.dialog.querySelector("input[name=field]:checked");return e?e.id:null},ie.prototype.onChange=function(e){this.onChangeCallbacks_.push(e)},ie.prototype.fireOnChange_=function(e){for(var t=0;t<this.onChangeCallbacks_.length;t++)this.onChangeCallbacks_[t](e)},ie.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),this.selectedKey&&k.Viewers[this.selectedKey]){this.fireOnChange_(k.Viewers[this.selectedKey]);try{localStorage.setItem(ne,this.selectedKey)}catch(e){console.error("Failed to save viewer profile: %s",e)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")},ie.prototype.createDialog_=function(e){var t=document.createElement("div");t.classList.add("webvr-polyfill-viewer-selector"),t.style.display="none";var n=document.createElement("div"),i=n.style;i.position="fixed",i.left=0,i.top=0,i.width="100%",i.height="100%",i.background="rgba(0, 0, 0, 0.3)",n.addEventListener("click",this.hide.bind(this));var r=document.createElement("div"),i=r.style;for(var a in i.boxSizing="border-box",i.position="fixed",i.top="24px",i.left="50%",i.marginLeft="-140px",i.width="280px",i.padding="24px",i.overflow="hidden",i.background="#fafafa",i.fontFamily="'Roboto', sans-serif",i.boxShadow="0px 5px 20px #666",r.appendChild(this.createH1_("Select your viewer")),e)r.appendChild(this.createChoice_(a,e[a].label));return r.appendChild(this.createButton_("Save",this.onSave_.bind(this))),t.appendChild(n),t.appendChild(r),t},ie.prototype.createH1_=function(e){var t=document.createElement("h1"),n=t.style;return n.color="black",n.fontSize="20px",n.fontWeight="bold",n.marginTop=0,n.marginBottom="24px",t.innerHTML=e,t},ie.prototype.createChoice_=function(e,t){var n=document.createElement("div");n.style.marginTop="8px",n.style.color="black";var i=document.createElement("input");i.style.fontSize="30px",i.setAttribute("id",e),i.setAttribute("type","radio"),i.setAttribute("value",e),i.setAttribute("name","field");var r=document.createElement("label");return r.style.marginLeft="4px",r.setAttribute("for",e),r.innerHTML=t,n.appendChild(i),n.appendChild(r),n},ie.prototype.createButton_=function(e,t){var n=document.createElement("button");n.innerHTML=e;var i=n.style;return i.float="right",i.textTransform="uppercase",i.color="#1094f7",i.fontSize="14px",i.letterSpacing=0,i.border=0,i.background="none",i.marginTop="16px",n.addEventListener("click",t),n},"undefined"!=typeof window?window:void 0!==Ee||"undefined"!=typeof self&&self;var re=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(e,t){!function(t,n){e.exports=n()}(0,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(1),a="undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",r),this.noSleepVideo.addEventListener("timeupdate",function(e){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return i(e,[{key:"enable",value:function(){a?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){a?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),e}();e.exports=o},function(e,t,n){e.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})})),ae=1e3,oe=[0,0,.5,1],se=[.5,0,.5,1],le=window.requestAnimationFrame,ue=window.cancelAnimationFrame;function ce(e){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:e.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:e.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:e.canPresent},maxLayers:{writable:!1,enumerable:!0,value:e.maxLayers},hasOrientation:{enumerable:!0,get:function(){return x("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),e.hasOrientation}}})}function fe(e){var t=!("wakelock"in(e=e||{}))||e.wakelock;this.isPolyfilled=!0,this.displayId=ae++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return x("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new ce({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,t&&p()&&(this.wakelock_=new re)}fe.prototype.getFrameData=function(e){return b(e,this._getPose(),this)},fe.prototype.getPose=function(){return x("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},fe.prototype.resetPose=function(){return x("VRDisplay.prototype.resetPose"),this._resetPose()},fe.prototype.getImmediatePose=function(){return x("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},fe.prototype.requestAnimationFrame=function(e){return le(e)},fe.prototype.cancelAnimationFrame=function(e){return ue(e)},fe.prototype.wrapForFullscreen=function(e){if(r())return e;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var t=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",t.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==e)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=e,this.originalParent_=e.parentElement,this.originalParent_||document.body.appendChild(e),!this.fullscreenWrapper_.parentElement){var n=this.fullscreenElement_.parentElement;n.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),n.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var i=this;return function(){if(i.fullscreenElement_){var e=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];i.fullscreenElement_.setAttribute("style",e.join("; ")+";")}}(),this.fullscreenWrapper_},fe.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var e=this.fullscreenElement_;this.fullscreenElementCachedStyle_?e.setAttribute("style",this.fullscreenElementCachedStyle_):e.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var t=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(e),this.originalParent_===t?t.insertBefore(e,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(e),t.removeChild(this.fullscreenWrapper_),e}},fe.prototype.requestPresent=function(e){var t=this.isPresenting,n=this;return e instanceof Array||(x("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),e=[e]),new Promise(function(i,o){if(n.capabilities.canPresent)if(0==e.length||e.length>n.capabilities.maxLayers)o(new Error("Invalid number of layers."));else{var s=e[0];if(s.source){var l=s.leftBounds||oe,u=s.rightBounds||se;if(t){var c=n.layer_;c.source!==s.source&&(c.source=s.source);for(var f=0;f<4;f++)c.leftBounds[f]=l[f],c.rightBounds[f]=u[f];return n.wrapForFullscreen(n.layer_.source),n.updatePresent_(),void i()}if(n.layer_={predistorted:s.predistorted,source:s.source,leftBounds:l.slice(0),rightBounds:u.slice(0)},n.waitingForPresent_=!1,n.layer_&&n.layer_.source){var m=n.wrapForFullscreen(n.layer_.source);n.addFullscreenListeners_(m,function(){var e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;n.isPresenting=m===e,n.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(e){console.error("screen.orientation.lock() failed due to",e.message)}),n.waitingForPresent_=!1,n.beginPresent_(),i()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),n.removeFullscreenWrapper(),n.disableWakeLock(),n.endPresent_(),n.removeFullscreenListeners_()),n.fireVRDisplayPresentChange_()},function(){n.waitingForPresent_&&(n.removeFullscreenWrapper(),n.removeFullscreenListeners_(),n.disableWakeLock(),n.waitingForPresent_=!1,n.isPresenting=!1,o(new Error("Unable to present.")))}),function(e){if(a())return!1;if(e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else{if(!e.msRequestFullscreen)return!1;e.msRequestFullscreen()}return!0}(m)?(n.enableWakeLock(),n.waitingForPresent_=!0):(r()||a())&&(n.enableWakeLock(),n.isPresenting=!0,n.beginPresent_(),n.fireVRDisplayPresentChange_(),i())}n.waitingForPresent_||r()||(h(),o(new Error("Unable to present.")))}else i()}else o(new Error("VRDisplay is not capable of presenting."))})},fe.prototype.exitPresent=function(){var e=this.isPresenting,t=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(n,i){e?(!h()&&r()&&(t.endPresent_(),t.fireVRDisplayPresentChange_()),a()&&(t.removeFullscreenWrapper(),t.removeFullscreenListeners_(),t.endPresent_(),t.fireVRDisplayPresentChange_()),n()):i(new Error("Was not presenting to VRDisplay."))})},fe.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},fe.prototype.fireVRDisplayPresentChange_=function(){var e=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(e)},fe.prototype.fireVRDisplayConnect_=function(){var e=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(e)},fe.prototype.addFullscreenListeners_=function(e,t,n){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=e,this.fullscreenChangeHandler_=t,this.fullscreenErrorHandler_=n,t&&(document.fullscreenEnabled?e.addEventListener("fullscreenchange",t,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenchange",t,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",t,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenchange",t,!1)),n&&(document.fullscreenEnabled?e.addEventListener("fullscreenerror",n,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenerror",n,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",n,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenerror",n,!1))},fe.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var e=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var t=this.fullscreenChangeHandler_;e.removeEventListener("fullscreenchange",t,!1),e.removeEventListener("webkitfullscreenchange",t,!1),document.removeEventListener("mozfullscreenchange",t,!1),e.removeEventListener("msfullscreenchange",t,!1)}if(this.fullscreenErrorHandler_){var n=this.fullscreenErrorHandler_;e.removeEventListener("fullscreenerror",n,!1),e.removeEventListener("webkitfullscreenerror",n,!1),document.removeEventListener("mozfullscreenerror",n,!1),e.removeEventListener("msfullscreenerror",n,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},fe.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},fe.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},fe.prototype.beginPresent_=function(){},fe.prototype.endPresent_=function(){},fe.prototype.submitFrame=function(e){},fe.prototype.getEyeParameters=function(e){return null};var me={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},he={LEFT:"left",RIGHT:"right"};function de(e){var t=v({},me);e=v(t,e||{}),fe.call(this,{wakelock:e.MOBILE_WAKE_LOCK}),this.config=e,this.displayName="Cardboard VRDisplay",this.capabilities=new ce({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new $(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new X(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new k(this.dpdb_.getDeviceParams(),e.ADDITIONAL_VIEWERS),this.viewerSelector_=new ie(e.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new ee),r()&&window.addEventListener("resize",this.onResize_.bind(this))}return de.prototype=Object.create(fe.prototype),de.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},de.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},de.prototype._getFieldOfView=function(e){var t;if(e==he.LEFT)t=this.deviceInfo_.getFieldOfViewLeftEye();else{if(e!=he.RIGHT)return console.error("Invalid eye provided: %s",e),null;t=this.deviceInfo_.getFieldOfViewRightEye()}return t},de.prototype._getEyeOffset=function(e){var t;if(e==he.LEFT)t=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else{if(e!=he.RIGHT)return console.error("Invalid eye provided: %s",e),null;t=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return t},de.prototype.getEyeParameters=function(e){var t=this._getEyeOffset(e),n=this._getFieldOfView(e),i={offset:t,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(i,"fieldOfView",{enumerable:!0,get:function(){return x("VRFieldOfView","VRFrameData's projection matrices"),n}}),i},de.prototype.onDeviceParamsUpdated_=function(e){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},de.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},de.prototype.beginPresent_=function(){var e=this.layer_.source.getContext("webgl");e||(e=this.layer_.source.getContext("experimental-webgl")),e||(e=this.layer_.source.getContext("webgl2")),e&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(e.canvas.width=f()*this.bufferScale_,e.canvas.height=m()*this.bufferScale_,this.cardboardUI_=new D(e)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new D(e)),this.distorter_=new R(e,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(e){this.viewerSelector_.show(this.layer_.source.parentElement),e.stopPropagation(),e.preventDefault()}.bind(this),function(e){this.exitPresent(),e.stopPropagation(),e.preventDefault()}.bind(this)),this.rotateInstructions_&&(c()&&p()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},de.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},de.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},de.prototype.submitFrame=function(e){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var t=this.layer_.source.getContext("webgl").canvas;t.width==this.lastWidth&&t.height==this.lastHeight||this.cardboardUI_.onResize(),this.lastWidth=t.width,this.lastHeight=t.height,this.cardboardUI_.render()}},de.prototype.onOrientationChange_=function(e){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},de.prototype.onResize_=function(e){if(this.layer_){var t=this.layer_.source.getContext("webgl");t.canvas.setAttribute("style",["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"].join("; ")+";"),g(t.canvas)}},de.prototype.onViewerChanged_=function(e){this.deviceInfo_.setViewer(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},de.prototype.fireVRDisplayDeviceParamsChange_=function(){var e=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(e)},de.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},de.VRDisplay=fe,de}()}));class Te extends r{constructor(e){super(),this.global=e,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}get depthNear(){throw new Error("Not implemented")}set depthNear(e){throw new Error("Not implemented")}get depthFar(){throw new Error("Not implemented")}set depthFar(e){throw new Error("Not implemented")}onBaseLayerSet(e,t){throw new Error("Not implemented")}supportsSession(e={}){throw new Error("Not implemented")}async requestSession(e={}){throw new Error("Not implemented")}requestAnimationFrame(e){throw new Error("Not implemented")}onFrameStart(e){throw new Error("Not implemented")}onFrameEnd(e){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(e,t){}cancelAnimationFrame(e){throw new Error("Not implemented")}endSession(e){throw new Error("Not implemented")}getViewport(e,t,n,i){throw new Error("Not implemented")}getProjectionMatrix(e){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(e){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(e,t){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}}!function(){let e=function(){let e=new m(4);return m!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();function Re(){let e=new m(4);return m!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Pe(e,t,n){let i=t[0],r=t[1],a=t[2],o=t[3],s=n[0],l=n[1],u=n[2],c=n[3];return e[0]=i*c+o*s+r*u-a*l,e[1]=r*c+o*l+a*s-i*u,e[2]=a*c+o*u+i*l-r*s,e[3]=o*c-i*s-r*l-a*u,e}function Fe(e,t,n,i){let r,a,o,s,l,u=t[0],c=t[1],m=t[2],h=t[3],d=n[0],A=n[1],p=n[2],v=n[3];return(a=u*d+c*A+m*p+h*v)<0&&(a=-a,d=-d,A=-A,p=-p,v=-v),1-a>f?(r=Math.acos(a),o=Math.sin(r),s=Math.sin((1-i)*r)/o,l=Math.sin(i*r)/o):(s=1-i,l=i),e[0]=s*u+l*d,e[1]=s*c+l*A,e[2]=s*m+l*p,e[3]=s*h+l*v,e}function Se(e,t){let n=t[0],i=t[1],r=t[2],a=t[3],o=n*n+i*i+r*r+a*a,s=o?1/o:0;return e[0]=-n*s,e[1]=-i*s,e[2]=-r*s,e[3]=a*s,e}const Ce=function(e){let t=new m(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},De=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Me=function(e,t){let n=t[0],i=t[1],r=t[2],a=t[3],o=n*n+i*i+r*r+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=i*o,e[2]=r*o,e[3]=a*o),e},Ie=(function(){let e=ae(),t=se(1,0,0),n=se(0,1,0)}(),function(){let e=Re(),t=Re()}(),function(){let e=function(){let e=new m(9);return m!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}()}(),se(.155,-.465,-.15)),Le=se(-.155,-.465,-.15),Ne=se(0,0,-.25),Be=se(0,0,.05),Oe=se(-.08,.14,.08),ze=.4,Ge=.4,Ue=.61,ke=.175,Ve=.12,He=.87,Xe=180/Math.PI;class Qe{constructor(){this.hand="right",this.headElbowOffset=Ie,this.controllerQ=Re(),this.lastControllerQ=Re(),this.headQ=Re(),this.headPos=ae(),this.elbowPos=ae(),this.wristPos=ae(),this.time=null,this.lastTime=null,this.rootQ=Re(),this.position=ae()}setHandedness(e){this.hand!=e&&(this.hand=e,"left"==this.hand?this.headElbowOffset=Le:this.headElbowOffset=Ie)}update(e,t){this.time=l(),e&&(De(this.lastControllerQ,this.controllerQ),De(this.controllerQ,e)),t&&(function(e,t){e[0]=t[12],e[1]=t[13],e[2]=t[14]}(this.headPos,t),function(e,t){let n=t[0]+t[5]+t[10],i=0;n>0?(i=2*Math.sqrt(n+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i)}(this.headQ,t));let n=this.getHeadYawOrientation_(),i=this.quatAngle_(this.lastControllerQ,this.controllerQ);i/((this.time-this.lastTime)/1e3)>Ue?Fe(this.rootQ,this.rootQ,n,Math.min(i/ke,1)):De(this.rootQ,n);let r=se(0,0,-1);pe(r,r,this.controllerQ);let a=he(r,[0,1,0]),o=this.clamp_((a-Ve)/He,0,1),s=Ce(this.rootQ);Se(s,s),Pe(s,s,this.controllerQ);let u=this.elbowPos;le(u,this.headPos),ce(u,u,this.headElbowOffset);let c=oe(Oe);fe(c,c,o),ce(u,u,c);let f=this.quatAngle_(s,Re())*Xe,m=(1-Math.pow(f/180,4))*(ze+(1-ze)*o*Ge),h=Re();Fe(h,h,s,m);let d=Se(Re(),h),A=Ce(s);Pe(A,A,d);let p=this.wristPos;le(p,Be),pe(p,p,h),ce(p,p,Ne),pe(p,p,A),ce(p,p,u);let v=oe(Oe);fe(v,v,o),ce(this.position,this.wristPos,v),pe(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let e=ae();return function(e,t,n){function i(e,t,n){return e<t?t:e>n?n:e}var r=t[0]*t[0],a=t[1]*t[1],o=t[2]*t[2],s=t[3]*t[3];if("XYZ"===n)e[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),s-r-a+o),e[1]=Math.asin(i(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),e[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),s+r-a-o);else if("YXZ"===n)e[0]=Math.asin(i(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),e[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),s-r-a+o),e[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),s-r+a-o);else if("ZXY"===n)e[0]=Math.asin(i(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),e[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),s-r-a+o),e[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),s-r+a-o);else if("ZYX"===n)e[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),s-r-a+o),e[1]=Math.asin(i(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),e[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),s+r-a-o);else if("YZX"===n)e[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),s-r+a-o),e[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),s+r-a-o),e[2]=Math.asin(i(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else{if("XZY"!==n)return void console.log("No order given for quaternion to euler conversion.");e[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),s-r+a-o),e[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),s+r-a-o),e[2]=Math.asin(i(2*(t[2]*t[3]-t[0]*t[1]),-1,1))}}(e,this.headQ,"YXZ"),function(e,t,n,i){let r=.5*Math.PI/180;t*=r,n*=r,i*=r;let a=Math.sin(t),o=Math.cos(t),s=Math.sin(n),l=Math.cos(n),u=Math.sin(i),c=Math.cos(i);return e[0]=a*l*c-o*s*u,e[1]=o*s*c+a*l*u,e[2]=o*l*u-a*s*c,e[3]=o*l*c+a*s*u,e}(Re(),0,e[1]*Xe,0)}clamp_(e,t,n){return Math.min(Math.max(e,t),n)}quatAngle_(e,t){let n=[0,0,-1],i=[0,0,-1];return pe(n,n,e),pe(i,i,t),function(e,t){let n=se(e[0],e[1],e[2]),i=se(t[0],t[1],t[2]);me(n,n),me(i,i);let r=he(n,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}(n,i)}}class We{constructor(e,t=0){this.polyfill=e,this.gamepad=null,this.inputSource=new Y(this),this.lastPosition=ae(),this.emulatedPosition=!1,this.basePoseMatrix=h(),this.inputPoses=new WeakMap,this.primaryButtonIndex=t,this.primaryActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}updateFromGamepad(e){this.gamepad=e,this.handedness=e.hand,e.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!e.pose.hasPosition):""===e.hand&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.gamepad&&this.gamepad.pose){let e=this.gamepad.pose,t=e.position,n=e.orientation;if(!t&&!n)return;t?(this.lastPosition[0]=t[0],this.lastPosition[1]=t[1],this.lastPosition[2]=t[2]):e.hasPosition?t=this.lastPosition:(this.armModel||(this.armModel=new Qe),this.armModel.setHandedness(this.gamepad.hand),this.armModel.update(n,this.polyfill.getBasePoseMatrix()),t=this.armModel.getPosition()),g(this.basePoseMatrix,n,t)}else d(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRInputPose(e){this.updateBasePoseMatrix();let t=this.inputPoses.get(e);t||(t=new j(this,this.gamepad&&this.gamepad.pose),this.inputPoses.set(e,t));const n=new Float32Array(16);return e.transformBasePoseMatrix(n,this.basePoseMatrix),t.targetRay=ye(n),t.gripMatrix&&e.transformBasePoseMatrix(t.gripMatrix,this.basePoseMatrix),t}}const qe=!1,je={highRefreshRate:!0},Ze={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1};let Ye=0;class Je{constructor(e,t={}){if(this.outputContext=e.outputContext,this.immersive=e.immersive,this.ended=null,this.baseLayer=null,this.id=++Ye,this.modifiedCanvasLayer=!1,this.outputContext&&!qe){const e=t.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(e)}}}class Ke extends Te{constructor(e,t){const{canPresent:n}=t.capabilities;super(e),this.display=t,this.frame=new e.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=n,this.baseModelMatrix=h(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),e.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=e.navigator&&"getGamepads"in e.navigator,this.HAS_BITMAP_SUPPORT=be(e)}get depthNear(){return this.display.depthNear}set depthNear(e){this.display.depthNear=e}get depthFar(){return this.display.depthFar}set depthFar(e){this.display.depthFar=e}onBaseLayerSet(e,t){const n=this.sessions.get(e),i=t.context.canvas;if(n.immersive){const e=this.display.getEyeParameters("left"),r=this.display.getEyeParameters("right");i.width=2*Math.max(e.renderWidth,r.renderWidth),i.height=Math.max(e.renderHeight,r.renderHeight),this.display.requestPresent([{source:i,attributes:je}]).then(()=>{qe||this.global.document.body.contains(i)||(n.modifiedCanvasLayer=!0,this.global.document.body.appendChild(i),xe(i)),n.baseLayer=t})}else n.outputContext&&(n.baseLayer=t)}supportsSession(e={}){return!0!==e.immersive||!1!==this.canPresent}async requestSession(e={}){if(!this.supportsSession(e))return Promise.reject();if(e.immersive){const e=this.global.document.createElement("canvas");if(!qe){e.getContext("webgl")}await this.display.requestPresent([{source:e,attributes:je}])}const t=new Je(e,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(t.id,t),e.immersive&&(this.immersiveSession=t,this.dispatchEvent("@@webxr-polyfill/vr-present-start",t.id)),Promise.resolve(t.id)}requestAnimationFrame(e){return this.display.requestAnimationFrame(e)}getPrimaryButtonIndex(e){let t=0,n=e.id.toLowerCase();for(let e in Ze)if(n.includes(e)){t=Ze[e];break}return Math.min(t,e.buttons.length-1)}onFrameStart(e){this.display.getFrameData(this.frame);const t=this.sessions.get(e);if(t.immersive&&this.CAN_USE_GAMEPAD){let e=this.gamepadInputSources;this.gamepadInputSources={};let n=this.global.navigator.getGamepads();for(let i=0;i<n.length;++i){let r=n[i];if(r&&r.displayId===this.display.displayId){let n=e[i];if(n||(n=new We(this,this.getPrimaryButtonIndex(r))),n.updateFromGamepad(r),this.gamepadInputSources[i]=n,-1!=n.primaryButtonIndex){let e=r.buttons[n.primaryButtonIndex].pressed;e&&!n.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:t.id,inputSource:n.inputSource}):!e&&n.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:t.id,inputSource:n.inputSource}),n.primaryActionPressed=e}}}}if(!qe&&t.outputContext&&!t.immersive){const e=t.outputContext.canvas,n=e.offsetWidth,i=e.offsetHeight;e.width!=n&&(e.width=n),e.height!=i&&(e.height=i);const r=t.baseLayer.context.canvas;this.immersiveSession&&r===this.immersiveSession.baseLayer.context.canvas||(r.width!=n&&(r.width=n),r.height!=i&&(r.height=i),function(e,t,n,i,r){let a,o=1/Math.tan(t/2);e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(a=1/(i-r),e[10]=(r+i)*a,e[14]=2*r*i*a):(e[10]=-1,e[14]=-2*i)}(this.frame.leftProjectionMatrix,.4*Math.PI,n/i,this.depthNear,this.depthFar))}}onFrameEnd(e){const t=this.sessions.get(e);if(!t.ended&&t.baseLayer){if(t.outputContext&&(!t.immersive||this.display.capabilities.hasExternalDisplay)){const e=t.immersive&&this.display.capabilities.hasExternalDisplay,n=t.baseLayer.context.canvas,i=e?n.width/2:n.width,r=n.height;if(!qe){const e=t.outputContext.canvas,a=e.width,o=e.height,s=t.renderContext;this.HAS_BITMAP_SUPPORT?n.transferToImageBitmap?s.transferFromImageBitmap(n.transferToImageBitmap()):this.global.createImageBitmap(n,0,0,i,r,{resizeWidth:a,resizeHeight:o}).then(e=>s.transferFromImageBitmap(e)):s.drawImage(n,0,0,i,r,0,0,a,o)}}t.immersive&&t.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(e){this.display.cancelAnimationFrame(e)}async endSession(e){const t=this.sessions.get(e);if(!t.ended)return t.immersive?this.display.exitPresent():void(t.ended=!0)}requestStageBounds(){if(this.display.stageParameters){const e=this.display.stageParameters.sizeX,t=this.display.stageParameters.sizeZ,n=[];return n.push(-e/2),n.push(-t/2),n.push(e/2),n.push(-t/2),n.push(e/2),n.push(t/2),n.push(-e/2),n.push(t/2),n}return null}async requestFrameOfReferenceTransform(e,t){if("stage"===e&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform)return this.display.stageParameters.sittingToStandingTransform}getProjectionMatrix(e){if("left"===e)return this.frame.leftProjectionMatrix;if("right"===e)return this.frame.rightProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(e,t,n,i){const r=this.sessions.get(e),{width:a,height:o}=n.context.canvas;if(!r.immersive)return i.x=i.y=0,i.width=a,i.height=o,!0;if("left"===t)i.x=0;else{if("right"!==t)return!1;i.x=a/2}return i.y=0,i.width=a/2,i.height=o,!0}getBasePoseMatrix(){let{position:e,orientation:t}=this.frame.pose;return e||t?(e||((e=this.tempVec3)[0]=e[1]=e[2]=0),g(this.baseModelMatrix,t,e),this.baseModelMatrix):this.baseModelMatrix}getBaseViewMatrix(e){if("left"===e)return this.frame.leftViewMatrix;if("right"===e)return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let e=[];for(let t in this.gamepadInputSources)e.push(this.gamepadInputSources[t].inputSource);return e}getInputPose(e,t){if(!t)return null;for(let n in this.gamepadInputSources){let i=this.gamepadInputSources[n];if(i.inputSource===e)return i.getXRInputPose(t)}return null}onWindowResize(){}onVRDisplayPresentChange(e){this.display.isPresenting||this.sessions.forEach(e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){const t=e.baseLayer.context.canvas;document.body.removeChild(t),t.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}})}}const $e=async function(e,t){let n=await async function(e){let t=null;if("xr"in e.navigator)try{t=await e.navigator.xr.requestDevice()}catch(e){}return t}(e);return n||(t.webvr&&(n=await async function(e){let t=null;if("getVRDisplays"in e.navigator)try{const n=await e.navigator.getVRDisplays();n&&n.length&&(t=new Ke(e,n[0]))}catch(e){}return t}(e))?new H(n):t.cardboard&&we(e)?(e.VRFrameData||(e.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new H(new class extends Ke{constructor(e){const t=new _e;super(e,t),this.display=t,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}}(e))):null)},et={webvr:!0,cardboard:!0},tt=["navigator","HTMLCanvasElement","WebGLRenderingContext"];t.a=class{constructor(e,t={}){this.global=e||n,this.config=Object.freeze(Object.assign({},et,t)),this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this.config.cardboard&&we(this.global)&&this._patchRequestDevice():this._injectPolyfill(this.global)}_injectPolyfill(e){if(!tt.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${tt}`);for(const t of Object.keys(ne))void 0!==e[t]?console.warn(`${t} already defined on global.`):e[t]=ne[t];if(ie(e.WebGLRenderingContext)){const t=be(e)?"bitmaprenderer":"2d";re(e.HTMLCanvasElement,t),e.OffscreenCanvas&&re(e.OffscreenCanvas,null),e.WebGL2RenderingContext&&ie(e.WebGL2RenderingContext)}this.injected=!0,this._patchRequestDevice()}_patchRequestDevice(){const e=$e(this.global,this.config);this.xr=new o(e),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}}}).call(this,n(9))},function(e,t,n){var i;e.exports=function e(t,n,r){function a(s,l){if(!n[s]){if(!t[s]){var u="function"==typeof i&&i;if(!l&&u)return i(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return a(n||e)},f,f.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof i&&i,s=0;s<r.length;s++)a(r[s]);return a}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("./clock"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.frame=0,i.fps=n,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"update",value:function(){this.isPlaying?(this.time=this.frame/this.fps,this.deltaTime=1/this.fps,this.frame++):this.deltaTime=0}},{key:"setTime",value:function(e){this.frame=Math.floor(this.fps*e),this.time=this.frame/this.fps}}]),t}();n.default=o},{"./clock":3}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("./clock"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.realtime=!0,n.rtTime=0,n.rtDate=+new Date,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"update",value:function(){if(this.isPlaying){var e=this.time,t=Date.now()-this.rtDate;this.time=this.rtTime+t/1e3,this.deltaTime=this.time-e}else this.rtTime=this.time,this.rtDate=+new Date,this.deltaTime=0}},{key:"setTime",value:function(e){this.time=e,this.rtTime=this.time,this.rtDate=+new Date}}]),t}();n.default=o},{"./clock":3}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.automaton=t,this.time=0,this.deltaTime=0,this.isPlaying=!0}return i(e,[{key:"update",value:function(e){var t=this.time;this.time=e,this.deltaTime=this.time-t}},{key:"play",value:function(){this.isPlaying=!0}},{key:"pause",value:function(){this.isPlaying=!1}},{key:"setTime",value:function(e){this.time=e}}]),e}();n.default=r},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=[],r=function(e,t){return 1-3*t+3*e},a=function(e,t){return 3*t-6*e},o=function(e){return 3*e},s=function(e){return Math.min(Math.max(e,0),1)},l=function(e,t,n){return((r(t,n)*e+a(t,n))*e+o(t))*e},u=function(e,t,n){return 3*r(t,n)*e*e+2*a(t,n)*e+o(t)},c=function(e,t,n,r,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))return a;if(e===t&&n===r)return a;if(a<=0)return 0;if(1<=a)return 1;e=s(e),n=s(n);for(var o=0;o<21;o++)i[o]=l(o/20,e,n);for(var c=1,f=1;f<21&&(c=f-1,!(a<i[f]));f++);var m=(c+(a-i[c])/(i[c+1]-i[c]))/20,h=u(m,e,n);return.001<=h?m=function(e,t,n,i){for(var r=0;r<4;r++){var a=u(t,n,i);if(0===a)return t;t-=(l(t,n,i)-e)/a}return t}(a,m,e,n):0!==h&&(m=function(e,t,n,i,r){for(var a=0,o=0,s=0;s<10&&(0<(a=l(o=t+(n-t)/2,i,r)-e)?n=o:t=o,!(1e-6<Math.abs(a)));s++);return o}(a,c/20,(c+1)/20,e,n)),l(m,t,r)};n.default=function(e,t,n){var i=t.time-e.time,r=t.value-e.value,a=e.out.time/i,o=e.out.value/r,s=(t.time+t.in.time-e.time)/i,l=(t.value+t.in.value-e.value)/r,u=(n-e.time)/i;return e.value+c(a,o,s,l,u)*r}},{}],5:[function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("./clock"),a=m(r),o=e("./clock-frame"),s=m(o),l=e("./clock-realtime"),u=m(l),c=e("./param"),f=m(c);function m(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t){var n=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.__version="2.0.4",this.loop=t.loop||!1,this.__clock=t.fps?new s.default(this,t.fps):t.realtime?new u.default(this):new a.default(this),this.__listeners={},this.__paramFxDefs={};var i=t.data;this.load(i),this.auto=function(e){return n.__auto(e)}}return i(e,[{key:"createParam",value:function(e,t){this.__params[e]=new f.default({automaton:this,data:t})}},{key:"load",value:function(e){for(var t in this.__length=e.length,this.__resolution=e.resolution,this.__params={},e.params)this.createParam(t,e.params[t])}},{key:"seek",value:function(e){this.__clock.setTime(e),this.__emit("seek")}},{key:"play",value:function(){this.__clock.play(),this.__emit("play")}},{key:"pause",value:function(){this.__clock.pause(),this.__emit("pause")}},{key:"addFxDefinition",value:function(e,t){this.__paramFxDefs[e]=t,this.precalcAll()}},{key:"__emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.__listeners[e]&&this.__listeners[e].map(function(e){return e.apply(void 0,n)})}},{key:"on",value:function(e,t){this.__listeners[e]||(this.__listeners[e]=[]),this.__listeners[e].push(t)}},{key:"precalcAll",value:function(){for(var e in this.__params)this.__params[e].precalc()}},{key:"update",value:function(e){for(var t in this.__clock.update(e),this.loop&&(this.time<0||this.length<this.time)&&this.__clock.setTime(this.time-Math.floor(this.time/this.length)*this.length),this.__params)this.__params[t].getValue()}},{key:"__auto",value:function(e){return this.__params[e].getValue()}},{key:"version",get:function(){return this.__version}},{key:"time",get:function(){return this.__clock.time}},{key:"length",get:function(){return this.__length}},{key:"resolution",get:function(){return this.__resolution}},{key:"deltaTime",get:function(){return this.__clock.deltaTime}},{key:"isPlaying",get:function(){return this.__clock.isPlaying}},{key:"progress",get:function(){return this.time/this.length}},{key:"frame",get:function(){return this.__clock.frame?this.__clock.frame:void 0}},{key:"fps",get:function(){return this.__clock.fps?this.__clock.fps:void 0}},{key:"realtime",get:function(){return Boolean(this.__clock.realtime)}}]),e}();t.exports=h,h.default=h},{"./clock":3,"./clock-frame":1,"./clock-realtime":2,"./param":6}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("./cubic-bezier"),a=s(r),o=e("./main");function s(e){return e&&e.__esModule?e:{default:e}}s(o);var l=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.__automaton=t.automaton,this.__values=new Float32Array(this.__automaton.resolution*this.__automaton.length+1),this.load(t.data),this.__lastValue=0,this.__lastTime=0}return i(e,[{key:"load",value:function(e){this.__nodes=e.nodes,this.__fxs=e.fxs,this.precalc()}},{key:"precalc",value:function(){for(var e=0;e<this.__nodes.length-1;e++){var t=this.__nodes[e],n=this.__nodes[e+1],i=Math.floor(t.time*this.__automaton.resolution),r=Math.floor(n.time*this.__automaton.resolution);this.__values[i]=t.value;for(var o=i+1;o<=r;o++){var s=o/this.__automaton.resolution,l=(0,a.default)(t,n,s);this.__values[o]=l}}for(var u=0;u<this.__fxs.length;u++){var c=this.__fxs[u];if(!c.bypass){var f=this.__automaton.__paramFxDefs[c.def];if(f){for(var m=Math.ceil(this.__automaton.resolution*c.time),h=Math.floor(this.__automaton.resolution*(c.time+c.length)),d=new Float32Array(h-m),A=d.length,p={i0:m,i1:h,t0:c.time,t1:c.time+c.length,deltaTime:1/this.__automaton.resolution,dt:1/this.__automaton.resolution,resolution:this.__automaton.resolution,length:c.length,params:c.params,array:this.__values,getValue:this.getValue.bind(this),init:!0},v=0;v<A;v++)p.i=p.index=v+m,p.t=p.time=p.i/this.__automaton.resolution,p.v=p.value=this.__values[v+m],p.p=p.progress=(p.t-c.time)/c.length,d[v]=f.func(p),p.init=!1;this.__values.set(d,m)}}}}},{key:"getValue",value:function(e){var t=e;if("number"!=typeof t&&(t=this.__automaton.time),t===this.__lastTime)return this.__lastValue;if(this.__automaton.loop&&(t-=Math.floor(t/this.__automaton.length)*this.__automaton.length),t<=0)return this.__values[0];if(this.__automaton.length<=t)return this.__values[this.__values.length-1];var n=t*this.__automaton.resolution,i=Math.floor(n),r=n%1,a=this.__values[i],o=a+(this.__values[i+1]-a)*r;return this.__lastTime=t,this.__lastValue=o,o}}]),e}();n.default=l},{"./cubic-bezier":4,"./main":5}]},{},[5])(5)},function(e,t){e.exports=(e=>{let t=[],n=[],i=[];const r=Object.assign({size:1},e).size;for(let e=0;e<6;e++){let a=[[-r,-r,r],[r,-r,r],[-r,r,r],[r,r,r]],o=[[0,0,1],[0,0,1],[0,0,1],[0,0,1]],s=[0,1,3,0,3,2].map(t=>t+4*e);if(0!==e){let t=t=>{if(e<4){let n=e*Math.PI/2,i=t[0],r=t[2];t[0]=Math.cos(n)*i-Math.sin(n)*r,t[2]=Math.sin(n)*i+Math.cos(n)*r}else{let n=(e-.5)*Math.PI,i=t[1],r=t[2];t[1]=Math.cos(n)*i-Math.sin(n)*r,t[2]=Math.sin(n)*i+Math.cos(n)*r}};a.map(t),o.map(t)}a.map(e=>t.push(...e)),o.map(e=>n.push(...e)),i.push(...s)}return{position:t,normal:n,index:i}})},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports="float aTime;\nfloat rawTime;\nfloat pattern;\n\nuniform float timeHead;\nuniform float patternHead;\nuniform float sampleRate;\nuniform float bufferSize;\nuniform sampler2D samplerChord;\n\nvec2 aNoise2( float t ) {\n  return 1.0 - 2.0 * texture2D( samplerRandomStatic, t * vec2( 0.741, 0.891 ) ).xy;\n}\n\nfloat i2f( float i ) {\n  float chord = (\n    rawTime < SECTION_WHAT_THE ?\n    0.0 :\n    mod( floor( rawTime / ( 8.0 beat ) ), 4.0 )\n  );\n\n  vec2 noteUv = ( vec2( mod( floor( i ), 8.0 ), chord ) + 0.5 ) / vec2( 8.0, 4.0 );\n  float note = texture2D( samplerChord, noteUv ).x;\n\n  float trans = -16.8 + (\n    rawTime < SECTION_WHAT_THE ?\n    0.0 :\n    mod( 5.0 - floor( rawTime / ( 8.0 beat ) ), 12.0 ) - 5.0\n  );\n\n  return n2f(\n    note + trans +\n    floor( i / 8.0 ) * 24.0 +\n    12.0 * linearstep( SECTION_AAAAA - 16.0 beat, SECTION_AAAAA, rawTime ) +\n    ( SECTION_AAAAA < rawTime ? -12.0 : 0.0 )\n  ); \n}\n\nvec2 kick( float t ) {\n  float attack = rawTime < SECTION_AAAAA ? 3.0 : 20.0;\n  float lorate = rawTime < SECTION_AAAAA ? 1E-9 : 0.04;\n\n  return vec2( exp( -10.0 * t ) * sin( TAU * lofi(\n    i2f( -8.0 ) * t - attack * ( exp( -40.0 * t ) + exp( -200.0 * t ) ),\n    lorate ) ) );\n}\n\nvec2 snare( float _phase ) {\n  if ( _phase < 0.0 ) { return vec2( 0.0 ); }\n  return aSaturate( (\n    aNoise2( _phase / 0.01 ).xy +\n    sin( _phase * 3600.0 * vec2( 1.005, 0.995 ) - exp( -_phase * 800.0 ) * 30.0 )\n  ) * 4.0 * exp( -_phase * 23.0 ) );\n}\n\nvec2 snare909( float _phase ) {\n  if ( _phase < 0.0 ) { return vec2( 0.0 ); }\n  return aSaturate( (\n    aNoise2( _phase / 0.01 ).xy * 2.0 +\n    sin( _phase * 1400.0 * vec2( 1.005, 0.995 ) - exp( -_phase * 80.0 ) * 30.0 )\n  ) * 1.0 * exp( -_phase * 10.0 ) );\n}\n\nvec2 tableTalking( float t, float offset ) {\n  vec4 dice = random4( offset );\n  return exp( -mix( 10.0, 30.0, dice.w ) * t ) * aSaturate( 5.0 * aNoise2(\n    100.0 * mod( t, mix( 0.008, 0.08, dice.x ) ) * mix( 0.01, 0.03, dice.y ) + 100.0 * dice.z\n  ) );\n}\n\nvec2 bass( float freq, float t ) {\n  vec2 hi = 16.0 + 0.1 * smoothstep( 0.0, 0.4, t ) * vec2( -1.0, 1.0 );\n  vec2 fm = 0.1 * smoothstep( 0.0, 0.4, t ) * sin(\n    TAU * freq * t + sin( TAU * hi * freq * t )\n  );\n  return vec2( tri( lofi( freq * t + fm, 0.0625 ) ) );\n}\n\nvec2 filterSaw( float freq, float time, float cutoff, float resonance ) {\n  if ( time < 0.0 ) { return vec2( 0.0 ); }\n  vec2 sum = vec2( 0.0 );\n  for ( int i = 1; i <= 32; i ++ ) {\n    float fi = float( i );\n    float cut = smoothstep( cutoff * 1.2, cutoff * 0.8, fi * freq );\n    cut += smoothstep( cutoff * 0.3, 0.0, abs( cutoff - fi * freq ) ) * resonance;\n    vec2 offset = vec2( -1.0, 1.0 ) * ( 0.1 * ( fi - 1.0 ) );\n    sum += sin( fi * freq * time * TAU + offset ) / fi * cut;\n  }\n  return sum;\n}\n\nvec2 rimshot( float _phase ) {\n  if ( _phase < 0.0 ) { return vec2( 0.0 ); }\n  float attack = exp( -_phase * 400.0 ) * 0.6;\n  vec2 wave = (\n    tri( _phase * 450.0 * vec2( 1.005, 0.995 ) - attack ) +\n    tri( _phase * 1800.0 * vec2( 0.995, 1.005 ) - attack )\n  );\n  return aSaturate( 4.0 * wave * exp( -_phase * 400.0 ) );\n}\n\nvec2 cowbell( float _phase ) {\n  if ( _phase < 0.0 ) { return vec2( 0.0 ); }\n  float attack = exp( -_phase * 800.0 ) * 20.0;\n  vec2 wave = (\n    pwm( _phase * 1600.0 * vec2( 1.005, 0.995 ) - attack, vec2( 0.5 ) ) +\n    pwm( _phase * 1080.0 * vec2( 0.995, 1.005 ) - attack, vec2( 0.5 ) )\n  ) * sin( _phase * 40.0 * TAU );\n  return wave * exp( -_phase * 20.0 );\n}\n\nvec2 chordSaw( float freq, float time ) {\n  vec2 p = fract( time * vec2( 0.99, 1.01 ) * freq );\n  return (\n    fract( 2.0 * p + 1.6 * sin( 2.0 * TAU * p ) ) - 0.5 +\n    fract( 1.0 * p ) - 0.5\n  );\n}\n\nvec2 wavetable( float freq, float time, float speed, float offset ) {\n  if ( time < 0.0 ) { return vec2( 0.0 ); }\n  float p = tri( freq * time );\n  return aNoise2( p * speed + offset );\n}\n\nvec2 clap( float _phase ) {\n  if ( _phase < 0.0 ) { return vec2( 0.0 ); }\n  float amp = exp( -14.0 * _phase );\n  amp *= mix(\n    smoothstep( 0.5, 0.4, sin( 500.0 * _phase ) ),\n    1.0,\n    smoothstep( 0.04, 0.05, _phase )\n  );\n  vec2 wave = wavetable( 1.2, _phase, 1.0, 0.0 );\n  return lofir( amp * wave, 0.25 );\n}\n\nvec2 crash( float _phase, float decay ) {\n  if ( _phase < 0.0 ) { return vec2( 0.0 ); }\n  float amp = exp( -decay * _phase );\n  vec2 wave = wavetable( 96.1, _phase, 0.5, 0.0 );\n  return amp * wave;\n}\n\nvec2 fmArp( float freq, float time ) {\n  if ( time < 0.0 ) { return vec2( 0.0 ); }\n  vec2 p = freq * vec2( 0.999, 1.001 ) * time * TAU;\n  float dl = exp( -time * 1.0 );\n  float ds = exp( -time * 10.0 );\n  return (\n    sin( p * 1.0003 + sin( p * 11.0035 ) * 1.5 * ds + sin( p * 1.0003 ) * 1.0 * dl ) +\n    sin( p * 0.9997 + sin( p * 0.9997 + sin( p * 4.9984 ) * 2.0 * dl ) * 0.5 * ds )\n  ) * 0.5 * ds;\n}\n\nvoid main() {\n  aTime = timeHead + ( floor( gl_FragCoord.x ) + bufferSize * floor( gl_FragCoord.y ) ) / sampleRate;\n  rawTime = aTime + 16.0 beat * patternHead;\n  pattern = patternHead + ( 16.0 beat < aTime ? 1.0 : 0.0 );\n  aTime = mod( aTime, 16.0 beat );\n\n  vec2 dest = vec2( 0.0 );\n\n  // -- tone -------------------------------------------------------------------\n  if ( rawTime < 16.0 beat ) {\n    if ( 8.0 beat < aTime ) {\n      float freq = mod( aTime, 4.0 beat ) < 1.0 beat ? 2000.0 : 1000.0;\n      float amp = smoothstep( 0.05, 0.04, mod( aTime, 1.0 beat ) );\n      dest.xy += amp * sin( freq * TAU * aTime );\n    }\n\n    gl_FragColor = vec4( dest, 0.0, 0.0 );\n    return;\n  }\n\n  // -- boom -------------------------------------------------------------------\n  if ( inRange( SECTION_AAAAA - 0.6 beat, SECTION_AAAAA, rawTime ) ) {\n    float t = ( aTime - 15.5 beat );\n    gl_FragColor = vec4( 0.4 * wavetable(\n      70.0, t, 0.2 * exp( -12.0 * t ), 0.0\n    ), 0.0, 0.0 );\n    return;\n  }\n\n  aTime = calcRhythms( aTime, rawTime );\n\n  // -- kick -------------------------------------------------------------------\n  dest += 0.5 * kick( kickTime );\n\n  // -- sweep ------------------------------------------------------------------\n  if ( inRange( SECTION_AAAAA - 16.0 beat, SECTION_AAAAA, rawTime ) ) {\n    float buildup = linearstep( SECTION_AAAAA - 16.0 beat, SECTION_AAAAA, rawTime );\n    dest += 0.1 * sqrt( buildup ) * wavetable( 40.0, aTime, 0.1 * buildup, 0.0 );\n  }\n\n  // -- crash ------------------------------------------------------------------\n  {\n    float amp = 0.2 * mix( 0.4, 1.0, sidechain );\n    dest += (\n      inRange( SECTION_HI_ACID, SECTION_HI_ACID + 16.0 beat, rawTime ) ||\n      inRange( SECTION_ITS_BEGINNING, SECTION_ITS_BEGINNING + 16.0 beat, rawTime ) ||\n      inRange( SECTION_AAAAA, SECTION_AAAAA + 16.0 beat, rawTime ) ||\n      inRange( SECTION_WHAT_THE, SECTION_WHAT_THE + 16.0 beat, rawTime ) ||\n      inRange( SECTION_FINISH, SECTION_FINISH + 16.0 beat, rawTime )\n    ) ? amp * crash( aTime, rawTime < SECTION_AAAAA ? 4.0 : 1.0 ) : vec2( 0.0 );\n  }\n\n  // -- clap -------------------------------------------------------------------\n  if ( inRange( SECTION_HI_ACID - 1.0 beat, SECTION_ITS_BEGINNING, rawTime ) ) {\n    dest += (\n      rawTime < SECTION_ITS_BEGINNING - 8.0 beat ?\n      0.2 * clap( mod( aTime - 1.0 beat, 2.0 beat ) ) :\n      vec2( 0.0 )\n    );\n  }\n\n  // -- acid -------------------------------------------------------------------\n  if ( inRange( SECTION_HI_ACID, SECTION_ITS_BEGINNING, rawTime ) ) {\n    if ( mod( aTime, 0.25 beat ) < 0.2 beat ) {\n      float t = mod( aTime, 0.25 beat );\n      vec4 dice = random4( lofi( rawTime + 4.12, 0.25 beat ) );\n      float filt = (\n        100.0 +\n        mix( 1000.0, 4000.0, dice.z ) * exp( -mix( 20.0, 40.0, dice.w ) * t )\n      );\n      float freq = (\n        i2f( -8.0 + 8.0 * pow( dice.y, 5.0 ) ) *\n        ( dice.x < 0.2 ? 1.335 : 1.0 ) *\n        ( dice.w < 0.5 ? 2.0 : 1.0 )\n      );\n      float amp = 0.16 * smoothstep( 0.25 beat, 0.2 beat, t );\n      dest += amp * aSaturate( 0.7 * filterSaw( freq, t, filt, filt / 500.0 ) );\n    }\n  }\n\n  // -- bass -------------------------------------------------------------------\n  if ( SECTION_AAAAA < rawTime ) {\n    dest += 0.4 * sidechain * bass( i2f( -8.0 ), kickTime );\n  }\n\n  // -- hihat ------------------------------------------------------------------\n  {\n    float amp = 0.3 * exp( -hihatOpen * hihatTime );\n    vec2 wave = wavetable( 80.0, hihatTime, 0.4, 0.0 );\n    dest += amp * wave;\n  }\n\n  // -- click ------------------------------------------------------------------\n  if ( rawTime < SECTION_ITS_BEGINNING - 1.0 beat ) {\n    float t = mod( aTime, 0.25 beat );\n    vec4 dice = random4( lofi( aTime, 0.25 beat ) );\n    t = mod( t, 0.25 / pow( 2.0, floor( 5.0 * pow( dice.z, 20.0 ) ) ) beat );\n    float amp = 0.3 * exp( -100.0 * t );\n    dest += amp * dice.xy;\n  }\n\n  // -- clav -------------------------------------------------------------------\n  if ( inRange( SECTION_HI_RIM, SECTION_ITS_BEGINNING, rawTime ) ) {\n    float amp = exp( -100.0 * clavTime );\n    float phase = clavTime + tri( 700.0 * clavTime );\n    dest += 0.2 * amp * tri( phase * vec2( 0.9, 1.1 ) );\n  }\n\n  // -- rimshot ----------------------------------------------------------------\n  if ( inRange( SECTION_HI_RIM, SECTION_ITS_BEGINNING - 4.0 beat, rawTime ) ) {\n    dest.x += 0.3 * rimshot( rimshotTime.x ).x;\n    dest.y += 0.3 * rimshot( rimshotTime.y ).y;\n  }\n\n  // -- snare ------------------------------------------------------------------\n  if (\n    inRange( SECTION_AAAAA, SECTION_FINISH, rawTime ) &&\n    !inRange( SECTION_WHAT_THE - 3.0 beat, SECTION_WHAT_THE, rawTime )\n  ) {\n    dest += 0.2 * snare( mod( aTime - 1.0 beat, 2.0 beat ) );\n  }\n\n  // -- snare909 ---------------------------------------------------------------\n  if ( inRange( SECTION_WHAT_THE - 8.0 beat, SECTION_WHAT_THE, rawTime ) ) {\n    float t = rawTime < SECTION_WHAT_THE - 2.0 beat ? mod( aTime, 0.25 beat ) : mod( aTime, 0.125 beat );\n    float amp = 0.14 * smoothstep( SECTION_WHAT_THE - 8.0 beat, SECTION_WHAT_THE, rawTime );\n    dest += amp * snare909( t );\n  }\n\n  // -- cowbell ----------------------------------------------------------------\n  if ( SECTION_AAAAA < rawTime ) {\n    dest += 0.1 * cowbell( mod( aTime - 0.25 beat, 2.0 beat ) );\n  }\n\n  // -- ???? -------------------------------------------------------------------\n  if ( SECTION_AAAAA < rawTime ) {\n    float t = mod( aTime, 32.0 beat );\n    float amp = 0.06 * sidechain;\n    vec2 wave = wavetable( 170.0, t, sidechain * 0.05, 0.0 );\n    dest += amp * wave;\n\n    dest += 0.08 * tableTalking( mod( aTime, 0.25 beat ), 4.8 * lofi( rawTime, 0.25 beat ) );\n  }\n\n  // -- pads -------------------------------------------------------------------\n  {\n    vec2 wave = vec2( 0.0 );\n    for ( int i = 0; i < 8; i ++ ) {\n      wave += (\n        rawTime < SECTION_ITS_BEGINNING + 16.0 beat ?\n        vec2( sin( TAU * lofi(\n          i2f( float( i ) ) * aTime + sin( float( i ) + 2.0 * aTime ),\n          0.0625\n        ) ) ) :\n        chordSaw( i2f( 2.3 * float( i - 2 ) ), aTime )\n      );\n    }\n    float env = 0.3 * linearstep( SECTION_ITS_BEGINNING + 16.0 beat, SECTION_AAAAA, rawTime );\n    float amp = 0.07 * sidechain * (\n      rawTime < SECTION_ITS_BEGINNING + 16.0 beat ?\n      0.8 * smoothstep( SECTION_ITS_BEGINNING + 16.0 beat, SECTION_ITS_BEGINNING, rawTime ) :\n      smoothstep( ( 0.1 + env ) beat, ( -0.2 + env ) beat, mod( aTime, 0.25 beat ) )\n    );\n    dest += amp * wave;\n  }\n\n  // -- arps -------------------------------------------------------------------\n  if ( SECTION_HI_ARP < rawTime ) {\n    for ( int i = 0; i < 3; i ++ ) {\n      float timeD = aTime - float( i ) * 0.75 beat;\n      float t = mod( timeD, 0.25 beat );\n      vec4 dice = random4( timeD - t + 2.59 );\n\n      float buildup = smoothstep( SECTION_ITS_BEGINNING, SECTION_AAAAA, rawTime );\n\n      float amp = (\n        rawTime < SECTION_WHAT_THE ?\n        0.12 * exp( -mix( 40.0, 10.0, buildup ) * t ) :\n        0.1\n      ) * exp( -mix( 4.0, 1.0, buildup ) * float( i ) );\n      float freq = (\n        rawTime < SECTION_WHAT_THE ?\n        i2f( 1.3 * floor( mod( timeD / ( 0.25 beat ), 8.0 ) ) ) :\n        i2f(\n          floor( 3.0 + 3.0 * tri( ( timeD - t ) / ( 1.0 beat ) ) + dice.x * 10.0 ) +\n          ( 0.8 < dice.y && 0.125 beat < t ? 2.0 : 0.0 )\n        )\n      );\n      float form = (\n        rawTime < SECTION_WHAT_THE ?\n        mix( 0.001, exp( -8.0 * t ) * 0.004, buildup ) :\n        -0.0015 * smoothstep( 0.4 beat, 0.0, t )\n      );\n\n      dest += amp * wavetable( freq, t, form, dice.w );\n    }\n  }\n\n  // -- chip -------------------------------------------------------------------\n  if ( SECTION_AAAAA < rawTime ) {\n    float freq = 2.0 * i2f( floor( mod( aTime * BPM / 3.75, 8.0 ) ) );\n    dest += vec2( 0.07 ) * sidechain * pwm( freq * aTime, 0.25 );\n  }\n\n  // fade out\n  dest *= smoothstep( 150.0, 142.0, rawTime );\n\n  gl_FragColor = vec4( dest, 0.0, 0.0 );\n}\n"},function(e,t){e.exports="// == defines ==================================================================\n#define PI 3.141592654\n#define TAU 6.283185307\n#define HUGE 9E16\n#define BPM 160.0\n#define saturate(i) clamp(i, 0.,1.)\n#define aSaturate(i) clamp(i, -1.,1.)\n#define linearstep(a,b,x) saturate(((x)-(a))/((b)-(a)))\n#define lofi(i,m) (floor((i)/(m))*(m))\n#define lofir(i,m) (floor((i)/(m)+0.5)*(m))\n#define pwm(x,d) (step(fract(x),(d))*2.0-1.0)\n#define tri(p) (1.-4.*abs(fract(p)-0.5))\n#define n2f(n) (440.0*pow(2.0,(n)/12.0))\n#define inRange(a,b,x) ((a)<=(x)&&(x)<(b))\n#define geta(i,m) (m)\n#define sinexp(i) (sin(PI*exp(i)))\n#define mp2zp(i) (.5+.5*(i))\n#define zp2mp(i) ((i)*2.-1.)\n#define beat *60.0/BPM\n\n// == sections =================================================================\n#define SECTION_HI_RIM (48.0 beat)\n#define SECTION_HI_ACID (80.0 beat)\n#define SECTION_HI_ARP (112.0 beat)\n#define SECTION_ITS_BEGINNING (144.0 beat)\n#define SECTION_AAAAA (240.0 beat)\n#define SECTION_WHAT_THE (304.0 beat)\n#define SECTION_FINISH (368.0 beat)\n\n// == h ========================================================================\nprecision highp float;\n\n// == globals ==================================================================\nfloat kickTime;\nfloat sidechain;\nvec2 rimshotTime;\nfloat clavTime;\nfloat hihatTime;\nfloat hihatOpen;\n\n// == uniforms =================================================================\nuniform bool isInitialFrame;\nuniform float time;\nuniform vec2 resolution;\nuniform float progress;\nuniform float deltaTime;\nuniform float totalFrame;\nuniform vec3 cameraPos;\nuniform float near;\nuniform float far;\nuniform bool isVR;\nuniform vec3 lightPos;\nuniform vec3 lightCol;\nuniform mat4 matP;\nuniform mat4 matV;\nuniform mat4 matPL;\nuniform mat4 matVL;\nuniform sampler2D samplerRandomStatic;\nuniform sampler2D samplerRandomDynamic;\nuniform vec2 zOffset;\nuniform vec2 mouse;\nuniform vec3 bgColor;\n\n// == baaa =====================================================================\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n// == prng =====================================================================\nfloat prng(inout vec4 n)\n{\n  // Based on the post http://gpgpu.org/forums/viewtopic.php?t=2591&sid=17051481b9f78fb49fba5b98a5e0f1f3\n  // (The page no longer exists as of March 17th, 2015. Please let me know if you see why this code works.)\n  const vec4 q = vec4(   1225.0,    1585.0,    2457.0,    2098.0);\n  const vec4 r = vec4(   1112.0,     367.0,      92.0,     265.0);\n  const vec4 a = vec4(   3423.0,    2646.0,    1707.0,    1999.0);\n  const vec4 m = vec4(4194287.0, 4194277.0, 4194191.0, 4194167.0);\n\n  vec4 beta = floor(n / q);\n  vec4 p = a * (n - beta * q) - beta * r;\n  beta = (sign(-p) + vec4(1.0)) * vec4(0.5) * m;\n  n = (p + beta);\n\n  return fract(dot(n / m, vec4(1.0, -1.0, 1.0, -1.0)));\n}\n\nvec3 randomSphere( inout vec4 seed ) {\n  vec3 v;\n  for ( int i = 0; i < 10; i ++ ) {\n    v = vec3(\n      prng( seed ),\n      prng( seed ),\n      prng( seed )\n    ) * 2.0 - 1.0;\n    if ( length( v ) < 1.0 ) { break; }\n  }\n  return v;\n}\n\nvec2 randomCircle( inout vec4 seed ) {\n  vec2 v;\n  for ( int i = 0; i < 10; i ++ ) {\n    v = vec2(\n      prng( seed ),\n      prng( seed )\n    ) * 2.0 - 1.0;\n    if ( length( v ) < 1.0 ) { break; }\n  }\n  return v;\n}\n\nvec3 randomBox( inout vec4 seed ) {\n  vec3 v;\n  v = vec3(\n    prng( seed ),\n    prng( seed ),\n    prng( seed )\n  ) * 2.0 - 1.0;\n  return v;\n}\n\n// == snoise ===================================================================\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nfloat mod289(float x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat permute(float x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat taylorInvSqrt(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 grad4(float j, vec4 ip)\n  {\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n  }\n\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\nfloat noise4d(vec4 v)\n  {\n  const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n                        0.276393202250021,  // 2 * G4\n                        0.414589803375032,  // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n// First corner\n  vec4 i  = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v -   i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n//  i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  //  x0 = x0 - 0.0 + 0.0 * C.xxxx\n  //  x1 = x0 - i1  + 1.0 * C.xxxx\n  //  x2 = x0 - i2  + 2.0 * C.xxxx\n  //  x3 = x0 - i3  + 3.0 * C.xxxx\n  //  x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n// Permutations\n  i = mod289(i);\n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0,   ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n  }\n\n// == misc. ====================================================================\nfloat calcDepth( float z ) {\n  return linearstep( near, far, z );\n}\n\nfloat calcDepth( vec3 v ) {\n  return calcDepth( dot( matV[ 2 ].xyz, v ) );\n}\n\nfloat calcDepthL( vec3 v ) {\n  return calcDepth( dot( matVL[ 2 ].xyz, v ) );\n}\n\nvec4 random4( float t ) {\n  return texture2D( samplerRandomStatic, lofi( t * vec2( 0.741, 0.891 ), 1.0 / 2048.0 ) + 0.5 / 2048.0 );\n}\n\nvec4 random4( vec2 v ) {\n  return texture2D( samplerRandomStatic, lofi( v, 1.0 / 2048.0 ) + 0.5 / 2048.0 );\n}\n\nmat2 rotate2D( float _t ) {\n  return mat2( cos( _t ), sin( _t ), -sin( _t ), cos( _t ) );\n}\n\nfloat smin( float a, float b, float k ) {\n  float res = exp( -k * a ) + exp( -k * b );\n  return -log( res ) / k;\n}\n\nvec3 catColor( float _p ) {\n  return 0.5 + 0.5 * vec3(\n    cos( _p ),\n    cos( _p + PI / 3.0 * 4.0 ),\n    cos( _p + PI / 3.0 * 2.0 )\n  );\n}\n\n// == rhythms ==================================================================\nfloat calcRhythms( float aTime, float rawTime ) {\n  // -- glitch -----------------------------------------------------------------\n  {\n    vec4 dice = random4( lofi( aTime, 0.5 beat ) - 4.78 );\n    float thr = (\n      rawTime < SECTION_AAAAA ?\n      0.2 * linearstep( SECTION_AAAAA - 10.0 beat, SECTION_AAAAA, rawTime ) :\n      0.0\n    );\n\n    if ( dice.x < thr ) {\n      aTime -= 0.82 * lofi( mod( aTime, 0.5 beat ), 0.03 );\n    } else if ( dice.x < 2.0 * thr ) {\n      aTime -= 0.95 * lofi( mod( aTime, 0.5 beat ), 0.017 );\n    } else if ( dice.x < 3.0 * thr ) {\n      aTime -= lofi( mod( aTime, 0.5 beat ), 0.125 beat );\n    } else if ( dice.x < 4.0 * thr ) {\n      aTime -= pow( 2.0 * mod( aTime, 0.5 beat ), 2.0 );\n    }\n  }\n\n  // -- kick -------------------------------------------------------------------\n  kickTime = mod( mod( aTime, 2.0 beat ), 0.75 beat );\n  sidechain = smoothstep( 0.0, 0.3, kickTime );\n  kickTime = (\n    rawTime < ( SECTION_ITS_BEGINNING - 8.0 beat ) ? kickTime :\n    rawTime < SECTION_ITS_BEGINNING ? aTime - 8.0 beat :\n    rawTime < ( SECTION_AAAAA - 4.0 beat ) ? mod( aTime, 2.0 beat ) :\n    rawTime < SECTION_AAAAA ? aTime - 12.0 beat :\n    inRange( SECTION_WHAT_THE - 4.0 beat, SECTION_WHAT_THE, rawTime ) ? aTime - 12.0 beat :\n    SECTION_FINISH + 0.75 beat < rawTime ? rawTime - SECTION_FINISH :\n    kickTime\n  );\n  kickTime += 15.75 beat < aTime ? ( aTime - 15.75 beat ) : 0.0;\n\n  // -- rimshot ----------------------------------------------------------------\n  rimshotTime = (\n    inRange( SECTION_HI_RIM, SECTION_ITS_BEGINNING - 4.0 beat, rawTime )\n    ? vec2(\n      mod( mod( mod( aTime, 2.25 beat ), 1.25 beat ), 0.5 beat ),\n      mod( mod( mod( aTime - 0.25 beat, 2.75 beat ), 0.75 beat ), 0.5 beat )\n    )\n    : vec2( 1E9 )\n  );\n\n  // -- clav -------------------------------------------------------------------\n  clavTime = (\n    inRange( SECTION_HI_RIM, SECTION_ITS_BEGINNING, rawTime )\n    ? mod( mod( mod( aTime - 0.75, 3.75 beat ), 2.75 beat ), 0.75 beat )\n    : 1E9\n  );\n\n  // -- hihat ------------------------------------------------------------------\n  hihatTime = mod( aTime, 0.5 beat );\n  vec4 dice = random4( aTime - hihatTime );\n  float trrr = rawTime < SECTION_ITS_BEGINNING ? 1.9 : 2.2;\n  hihatOpen = rawTime < SECTION_ITS_BEGINNING ? 200.0 : mix( 20.0, 200.0, dice.x );\n  hihatTime = mod( hihatTime, 0.5 / pow( 2.0, floor( trrr * dice.z ) ) beat );\n  hihatTime = (\n    inRange( SECTION_ITS_BEGINNING - 4.0 beat, SECTION_AAAAA - 32.0 beat, rawTime ) ?\n    1E9 :\n    hihatTime\n  );\n\n  // -- end --------------------------------------------------------------------\n  return aTime;\n}\n\nvoid calcRhythms() {\n  calcRhythms( mod( time, 16.0 beat ), time );\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying vec2 uv;\nuniform sampler2D sampler0;\n\nvoid main() {\n  gl_FragColor = texture2D( sampler0, uv );\n}"},function(e,t){e.exports="#define RADIUS 40.0\n\nuniform vec3 circleColor;\nuniform sampler2D sampler0;\n\nbool print( in vec2 _coord, float _in ) {\n  vec2 coord = _coord;\n\n  // vertical restriction\n  if ( coord.y <= 0.0 || 5.0 <= coord.y ) { return false; }\n  \n  // dot\n  if ( 0.0 < coord.x && coord.x < 2.0 ) {\n    return coord.x < 1.0 && coord.y < 1.0;\n  }\n\n  // padded by dot\n  if ( 2.0 < coord.x ) { coord.x -= 2.0; }\n  \n  // determine digit\n  float ci = floor( coord.x / 5.0 ) + 1.0;\n\n  // too low / too high\n  if ( 4.0 < ci ) { return false; }\n  if ( ci < -4.0 ) { return false; }\n\n  // x of char\n  float cfx = floor( mod( coord.x, 5.0 ) );\n\n  // width is 4\n  if ( 4.0 == cfx ) { return false; }\n\n  // y of char\n  float cfy = floor( coord.y );\n\n  // bit of char\n  float cf = cfx + 4.0 * cfy;\n\n  // determine char  \n  float num = 0.0;\n  if ( 0.0 < ci ) {\n    float n = abs( _in );\n    for ( int i = 0; i < 6; i ++ ) {\n      if ( ci < float( i ) ) { break; }\n      \n      num = mod( floor( n ), 10.0 );\n      n -= num;\n      n *= 10.0;\n    }\n  } else {\n    float n = abs( _in );\n    for ( int i = 0; i < 6; i ++ ) {\n      if ( -ci < float( i ) ) { break; }\n      \n      if ( ci != 0.0 && n < 1.0 ) {\n        // minus\n        return float( i ) == -ci && _in < 0.0 && cfy == 2.0 && 0.0 < cfx;\n      }\n      num = mod( floor( n ), 10.0 );\n      n -= num;\n      n /= 10.0;\n    }\n  }\n\n  bool a;\n  a = 1.0 == mod( floor( (\n    num == 0.0 ? 432534.0 :\n    num == 1.0 ? 410692.0 :\n    num == 2.0 ? 493087.0 :\n    num == 3.0 ? 493191.0 :\n    num == 4.0 ? 630408.0 :\n    num == 5.0 ? 989063.0 :\n    num == 6.0 ? 399254.0 :\n    num == 7.0 ? 1016898.0 :\n    num == 8.0 ? 431766.0 :\n    433798.0\n  ) / pow( 2.0, cf ) ), 2.0 );\n  \n  return a ? true : false;\n}\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n\n  vec2 m = floor( vec2( 0.0, resolution.y ) + vec2( 1.0, -1.0 ) * mouse );\n  vec2 center = floor( m + vec2( 1.0, 0.7 ) * RADIUS );\n  float circle = length( gl_FragCoord.xy - center ) - RADIUS;\n\n  vec4 col = texture2D( sampler0, uv );\n  vec4 mcol = texture2D( sampler0, ( m + 0.5 ) / resolution );\n  vec4 bcol = vec4( circleColor, 1.0 );\n\n  col = mix(\n    col,\n    mix(\n      bcol,\n      mcol,\n      smoothstep( 1.0, 0.0, circle + 5.0 )\n    ),\n    smoothstep( 1.0, 0.0, circle )\n  );\n\n  if ( circle < 0.0 ) {\n    col = print( gl_FragCoord.xy - center - vec2( 0.0, 8.0 ), mcol.x ) ? bcol : col;\n    col = print( gl_FragCoord.xy - center - vec2( 0.0, 0.0 ), mcol.y ) ? bcol : col;\n    col = print( gl_FragCoord.xy - center - vec2( 0.0, -8.0 ), mcol.z ) ? bcol : col;\n    col = print( gl_FragCoord.xy - center - vec2( 0.0, -16.0 ), mcol.w ) ? bcol : col;\n  }\n\n  gl_FragColor = col;\n}"},function(e,t){e.exports="void main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  if ( time < 8.0 beat ) {\n    gl_FragColor = vec4( uv, time / ( 8.0 beat ), 1.0 );\n  } else {\n    vec2 p = ( gl_FragCoord.xy * 2.0 - resolution ) / resolution.y;\n    float radius = 0.3 * exp( -fract( time / ( 1.0 beat ) ) );\n    float shape = linearstep( 2.0 / resolution.y, 0.0, length( p ) - radius );\n    gl_FragColor = vec4( vec3( shape ), 1.0 );\n  }\n}"},function(e,t,n){"use strict";n.r(t);var i=n(0);let r=0,a=[];const o={};let s=!1,l=[0,0,0],u=[.7,.8,1.1];o.line=(()=>{a.push(114514),l[0]=0}),o.print=(e=>{for(let t=0;t<e.length;t++)a.push([l.concat(),u.concat([e.codePointAt(t)])]),l[0]+=.1}),o.code=(e=>{a.push([l.concat(),u.concat([e])]),l[0]+=.1}),o.pos=(e=>{l=e||[0,0,0]}),o.color=(e=>{u=e||[1,1.2,2]}),o.err=(e=>{o.line(),o.color([1.7,.2,.5]),o.print("[ERR!] "),o.color(),o.print(e)}),o.warn=(e=>{o.line(),o.color([1.3,.8,.2]),o.print("[WARN] "),o.color(),o.print(e)}),o.info=(e=>{o.line(),o.color([.2,1.5,.9]),o.print("[INFO] "),o.color(),o.print(e)}),o.verb=(e=>{o.line(),o.color([.5,.1,1]),o.print("[VERB] "),o.color([.6,.6,.6]),o.print(e)}),o.drop=(()=>{a.splice(0),s=!0}),t.default=(e=>{const t=e.glCatPath,l=t.glCat,u=l.gl,c=e.automaton.auto,f=l.createVertexbuffer(new Float32Array(i.c)),m=l.createVertexbuffer(new Float32Array(i.b(32,32).map((e,t)=>t%2==0?(2*e+.5)/32/2:(e+.5)/32))),h=l.createTexture();{const e=new Image;e.onload=(()=>{l.setTexture(h,e),l.textureFilter(h,u.NEAREST)}),e.src=n(16)}const d=l.createTexture();return l.setTextureFromArray(d,1,1,new Uint8Array([0,0,0,0])),t.add({logCompute:{width:64,height:32,vert:n(3),frag:n(17),blend:[u.ONE,u.ZERO],clear:[0,0,0,0],framebuffer:!0,swapbuffer:!0,float:!0,func:(e,t)=>{if(l.uniform1i("logReturn",!1),0<a.length){const e=a.shift();114514===e?l.uniform1i("logReturn",!0):(e[0][3]=r,l.uniform4fv("logPos",e[0]),l.uniform4fv("logCol",e[1]),r=(r+1)%1024)}else l.uniform4fv("logPos",[0,0,0,-1]);l.uniform1i("logDrop",s),s=!1,l.attribute("p",f,2),l.uniform1f("nParticle",1024),l.uniform1f("nParticleSqrt",32),l.uniform1f("ppp",2),l.uniform3fv("logOffset",[c("log-offsetX"),c("log-offsetY"),c("log-offsetZ")]),l.uniformTexture("samplerPcompute",e.swapbuffer.texture,0),l.uniform1f("noisePhase",c("particles-noisePhase")),l.uniform1f("genRate",c("particles-genRate")),u.drawArrays(u.TRIANGLE_STRIP,0,4)}},logRender:{vert:n(18),frag:n(19),blend:[u.ONE,u.ZERO],drawbuffers:3,depthTest:!1,depthWrite:!1,func:(e,n)=>{l.attribute("computeUV",m,2),l.uniform1f("nParticle",1024),l.uniform1f("nParticleSqrt",32),l.uniform1f("ppp",2),l.uniform2fv("resolutionPcompute",[64,32]),l.uniform1i("isShadow",n.isShadow?1:0),l.uniformTexture("samplerPcompute",t.fb("logCompute").texture,0),l.uniformTexture("samplerSprite",h,1),l.uniformTexture("samplerShadow",n.textureShadow||d,2),u.drawArrays(u.POINTS,0,1024)}}}),o})},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAABG2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+Gkqr6gAAAYNpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAACiRdZHPK8NhHMdfhshoigPlsDQO2jRT4uIwMQqHmTJctu9+qW2+fb9bWq7KdUWJi18H/gKuylkpIiUHJ2fiwvr6fLfVluzz9Hk+r+f9PJ9Pz/N5wBJIKim9wQ2pdEbz+7z2peCyvekVK920MYAnpOjq3MJUgJr29UCdGe9cZq3a5/41aySqK1DXLDyuqFpGeFp4diOjmrwr3KkkQhHhc2GnJhcUvjf1cInfTI6X+MdkLeCfAEu7sD1exeEqVhJaSlhejiOVzCrl+5gvaY2mFxck9or3oOPHhxc7M0wywQhDjMk8ggsPg7KiRr67mD/PuuQqMqvk0FgjToIMTlGzUj0qMSZ6VEaSnNn/v33VY8OeUvVWLzS+GMZHHzTtQCFvGN/HhlE4gfpnuEpX8tePYPRT9HxFcxyCbQsuritaeA8ut6HrSQ1poaJUL26JxeD9DNqC0HELLSulnpX3OX2EwKZ81Q3sH0C/nLet/gLBYmgPgVKqUQAAAAlwSFlzAAALEwAACxMBAJqcGAAABvRJREFUeJzNW9uW40gIs+fk/3/Z+zLVSxRJiLLTZ3iJTYEQFHVJT+Y8Qrmu61Jj53mea/w8z3PZr2f0R319T+Iye2c34YJ+Hd6fjjgLhglgIPRVxFiMrhjVZkm1WeLycFKboWLWmPVZFpAVKyHjiqGeGXYycUknMl+F53CZ33me54sZJgmsNmZ2k+WKuoXZxcI4Kvk6IWwFMFzEVpN7XdclCzjZZ9IidIlMYqf8VG5sMhO/D75sL6mEcCwhyZahi6P8v6lLReWw5I8zVmBTQmvGljh/Vfw0LuKrlfBUXJsMEmOEFBm3l3WxcJlXrMWX6VJR++SOfARnB0ElrEg4SbvAxXAY7mBKYuNkqElh/GxR2NhuByLWE51/R9eJKuAID0HSfeISwnwYUaVjMRQPNva0tLhdAV2hVAJJgt27GmOTFSW6IRFmYtR1oMNTBZ/wcDHU5DKMxC7hMxIXGAvDEksJfaMDd4sw8tvpQFZQVTxlo+Ikk6Bi7uSW4MjvrkuXXmuqbvfKQgmKmwLTTQW5JuMfcV27p0un6hhe2gGJr9JNcJkPSoJ9XeWPCd1sIIDqwISw6iIWP+lAxsHpMFeXd11VdHWms5nsGZPZd3F37HY4YJyuA5m8Jl/ROjDlm3Sq8p3ugel+yDqL8WZjVd8eIiyJqV3Svc4WD6XkK9XbMjM6hqN82WS+UucndSp5pWMFmgorQDfOaoPvb4dIR/xOt02WIY7dKaKaQJS6pKuP6/LjOI5XBahB085iZBXBRIcJJXEZZ4zRFcJxdHltHyJuD+x0LoHdbmN5qPdpDNadS3/rcJiQ+Y19ViWO76xJVBO1ncv2vl2dwp3idZ9Kl8RWOudrm+QCUcSZHY6lSaSF2imE4zHRpziv45hdPivg+VdQl2BNZOF2+JP4HR7qpZ0CqRVnwdiMJCd5YoebtrLHZ8ZHxWXxnJ2MwZJgCe92V0JwjalT2CXUJeua49HVotb4GnN7htoHla/a25id49VJh83e0Qc5oM7+e6ojl14JJpLcA9M9F3FY1+NWgKsluT69/biI7S3OWRHvfJ19Eney9FROTwn9dZbqBLaPsZlOdQ7f8WDS+XYHUiLpYfOI3Nm7npZuH1Y2Dm89v1Rn7HaWCpRuCe7q0+GhqK1B2bKiqr3zZyyZCTU7afGmMfDTYXTcJtwdB8X5D5I5/4ojt8TdHTupM85mOvFfwmIv/Q4ufjp+0QWZLS9HmvkpW4yPS8RhVCw2hsV1B4jK0eX7NoAdx5aRAlE2Ve+WDNop/W6MJA+22lSMN9vJsmOiCDpbRUZh3IlxF4/5Vs72i3h1mtzv/iVd5Y+F6HQVj+21H8vdtTtbKukymCwXF2OqU++JLuX8YsbJDH+jKxMuLK7TIf5U0u6lG6XSq47Ed2fT+aZ4nc5hOnvWcco/2rw7ci6YSmSS8K6wSXdFZ5+OX/SbPCVo5zZa1F3X/i8iWNwEL+HmcqT5snZNZooFVrN1R1fHGNepr8shecb3Fxtg3wSc3dJPOpAR675RLJ9JXOxOVsREGLY0uKubdDDrDtdRE5l06m4M6fgbxUO/J4qm/BMOnT/ztX/JqK2Pdm7jRqyfYIDL4rqlmWz6SR6JLn22G+ROxzgd64JO0pWgbOpnx6OrBavHx6+zlCQb9xTjWz5LarcsHLZq1DeWqkebn/e0Y1DvujPV7XSk803xJr4d1gvXNtunqm4BqllzhHfkTtej3aSbU7sXK1wNpm79qvVZYJZ40qGMV8XrhB1wjnM3WWz88Q5Mi+VO4TrmCt0Vktm5CWa+XW6PdyCTnQPH+e4efBUvjRtLsqQmvrsxWOe5bux8v2H31oEO4LckXZLLNulANY4xdid/vdM/JqQBur3FEXF3rGob3cUMLydP2NH/J+JE7X2T7mF6hqEmaDpxtWPv+DL5J5ZwV/w746rwT/gex/H+E9/JyVqDMN8drCleF2PnypJeaZbQDkwDd4LLJplRx2Vy2PyW/Py8rX7uXiy7TR91amYZHj6rhNLD7CmRp9+HIVysuy5g3YY6hoe66WpIC61kcsgdh/mJL5J5gojTdzh3uHxT6Ne3D6PmKG+DEP+u8yqvDs91+I5vx/nNl23S6Hj9FdQpH2XbPVesFCPl53gzHqz4DMveA11nuuW0eyVSB1BNdrK/YbGSfbvmmsSwBdzdjCfFS5JjE8LuiOoTY6Wc8Z35v/2bCHaa60AWVC0zjKEIq8Q6PowfdhPGZjaMY8fvbc2z/YDZKgyXvCKU2MTJGKkcGV+W/y1xgK7IqE9slY/6TPE6zh1eUtSP/2hzHP//W8RqcQyAexHT1/EuIcTC2JNDqdo5XopPGufrksy48kntJzx2sJIO3L5sOt3Su/eE/FOdMOnEqfwHNmIjIwDn6G0AAAAASUVORK5CYII="},function(e,t){e.exports="uniform float nParticleSqrt;\nuniform float nParticle;\nuniform float ppp;\n\nuniform sampler2D samplerPcompute;\n\nuniform vec4 logPos;\nuniform vec3 logOffset;\nuniform vec4 logCol;\nuniform bool logReturn;\nuniform bool logDrop;\n\n// ------\n\nvec4 sampleRandom( vec2 _uv ) {\n  return texture2D( samplerRandomDynamic, _uv );\n}\n\n// ------\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  vec2 puv = vec2( ( floor( gl_FragCoord.x / ppp ) * ppp + 0.5 ) / resolution.x, uv.y );\n  float mode = mod( gl_FragCoord.x, ppp );\n  vec2 dpix = vec2( 1.0 ) / resolution;\n\n  // == prepare some vars ======================================================\n  vec4 seed = texture2D( samplerRandomStatic, puv );\n  prng( seed );\n\n  vec4 pos = texture2D( samplerPcompute, puv );\n  vec4 col = texture2D( samplerPcompute, puv + dpix * vec2( 1.0, 0.0 ) );\n\n  float index = floor( uv.x * nParticleSqrt ) + floor( uv.y * nParticleSqrt ) * nParticleSqrt;\n\n  if ( logPos.w == index ) {\n    // == generate particles ===================================================\n    pos = logPos;\n    pos.xyz += logOffset;\n    pos.w = 0.0; // lifetime\n\n    col = logCol;\n  }\n\n  // == update particles =======================================================\n  pos.y += logReturn ? 0.12 : 0.0;\n  pos.w += deltaTime + ( logDrop ? 1E9 : 0.0 );\n\n  gl_FragColor = (\n    mode < 1.0 ? pos :\n    col\n  );\n}"},function(e,t){e.exports="attribute vec2 computeUV;\n\nvarying vec4 vPos;\nvarying vec3 vCol;\nvarying vec2 vUv;\nvarying float vSize;\n\nuniform vec2 resolutionPcompute;\n\nuniform bool isShadow;\n\nuniform float colorVar;\nuniform float colorOffset;\n\nuniform sampler2D samplerPcompute;\n\nvoid main() {\n  // == fetch compute texture ==================================================\n  vec2 puv = computeUV;\n  vec2 dppix = vec2( 1.0 ) / resolutionPcompute;\n\n  vec4 pos = texture2D( samplerPcompute, puv );\n  vec4 col = texture2D( samplerPcompute, puv + dppix * vec2( 1.0, 0.0 ) );\n\n  // == geometry ===============================================================\n  float kickBeat = exp( -10.0 * mod( mod( time, 2.0 beat ), 0.75 beat ) );\n\n  vSize = 0.042 * (\n    ( 1.0 - exp( -10.0 * pos.w ) ) *\n    smoothstep( 10.0, 9.0, pos.w )\n  );\n\n  // == special chars ==========================================================\n  if ( col.w == 3.0 ) { // ♥\n    float wave = 0.5 + 0.5 * sin( 10.0 * pos.x + 10.0 * time );\n    col = vec4( mix(\n      col.xyz,\n      vec3( 1.8, 0.1, 0.5 ),\n      wave\n    ), 3.0 );\n    vSize *= 1.0 + 0.5 * wave;\n  } else if ( col.w == 14.0 ) { // 音\n    float b = exp( -5.0 * mod( mod( time, 2.0 beat ), 0.75 beat ) );\n    col = vec4( mix(\n      col.xyz,\n      vec3( 1.8, 0.8, 3.8 ),\n      kickBeat\n    ), 14.0 );\n    vSize *= 1.0 + kickBeat;\n  } else if ( col.w == 2.0 ) { // 顔\n    col = vec4( mix(\n      vec3( 1.1, 0.5, 0.1 ),\n      vec3( 0.7, 1.4, 0.3 ),\n      floor( mod( totalFrame, 4.0 ) / 2.0 )\n    ), 2.0 );\n  }\n\n  // == assign varying variables ===============================================\n  vCol = col.xyz;\n  float ch = col.w;\n  vUv = floor( vec2( mod( ch, 16.0 ), col.w / 16.0 ) );\n\n  // == finalize ===============================================================\n  vPos = pos;\n\n  vec4 outPos;\n  if ( isShadow ) {\n    outPos = matPL * matVL * vec4( pos.xyz, 1.0 );\n  } else {\n    outPos = matP * matV * vec4( pos.xyz, 1.0 );\n    outPos.x /= resolution.x / resolution.y;\n  }\n  gl_Position = outPos;\n  gl_PointSize = vSize * resolution.y / outPos.z / matP[ 0 ].x;\n}"},function(e,t){e.exports="#extension GL_EXT_draw_buffers : require\n\nvarying vec4 vPos;\nvarying vec3 vCol;\nvarying vec2 vUv;\nvarying float vSize;\n\nuniform bool isShadow;\n\nuniform sampler2D samplerSprite;\n\n// == main procedure ===========================================================\nvoid main() {\n  if ( vSize == 0.0 ) { discard; }\n\n  vec2 uv = ( gl_PointCoord + vUv ) / 16.0;\n  float tex = texture2D( samplerSprite, uv ).x;\n  if ( tex < 0.5 ) { discard; }\n\n  if ( isShadow ) {\n    gl_FragData[ 0 ] = vec4( calcDepthL( vPos.xyz - lightPos ), 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  gl_FragData[ 0 ] = vec4( vPos.xyz, 1.0 );\n  gl_FragData[ 1 ] = vec4( 0.0, 0.0, 1.0, 1.0 );\n  gl_FragData[ 2 ] = vec4( vCol, 2.0 );\n}"},function(e,t,n){"use strict";n.r(t);var i=n(0);t.default=(e=>{const t=e.glCatPath,r=t.glCat,a=r.gl,o=r.createVertexbuffer(new Float32Array(i.c));t.add({preBloom:{vert:n(3),frag:n(21),blend:[a.ONE,a.ONE],clear:[0,0,0,0],framebuffer:!0,float:!0,func:(e,t)=>{r.attribute("p",o,2),r.uniform3fv("bias",t.bias),r.uniform3fv("factor",t.factor),r.uniformTexture("sampler0",t.input,0),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},bloom:{vert:n(3),frag:n(22),blend:[a.ONE,a.ONE],clear:[0,0,0,0],framebuffer:!0,float:!0,swapbuffer:!0,func:(e,n)=>{r.attribute("p",o,2);for(let i=0;i<3;i++){let o=[3,10,50][i];r.uniform1f("var",o),a.bindFramebuffer(a.FRAMEBUFFER,e.swapbuffer.framebuffer),r.clear(...e.clear),r.uniform1i("isVert",!1),r.uniformTexture("sampler0",0===i?t.fb("preBloom").texture:e.framebuffer.texture,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.bindFramebuffer(a.FRAMEBUFFER,n.framebuffer),r.uniform1i("isVert",!0),r.uniformTexture("sampler0",e.swapbuffer.texture,0),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}},postBloom:{vert:n(3),frag:n(23),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,float:!0,func:(e,n)=>{r.attribute("p",o,2),r.uniformTexture("samplerDry",n.dry,0),r.uniformTexture("samplerWet",t.fb("bloom").texture,1),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}})})},function(e,t){e.exports="uniform vec3 bias;\nuniform vec3 factor;\nuniform sampler2D sampler0;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  vec2 deltaTexel = 0.25 / resolution;\n  vec2 uvOrigin = ( floor( gl_FragCoord.xy ) + deltaTexel * 0.5 ) / resolution;\n\n  vec3 sum = vec3( 0.0 );\n  for ( int iy = 0; iy < 4; iy ++ ) {\n    for ( int ix = 0; ix < 4; ix ++ ) {\n      vec2 uv = uvOrigin + vec2( ix, iy ) * deltaTexel;\n      sum += texture2D( sampler0, uv ).xyz / 16.0;\n    }\n  }\n\n  gl_FragColor = vec4(\n    max( vec3( 0.0 ), ( sum + bias ) * factor ),\n    1.0\n  );\n}\n"},function(e,t){e.exports="#define SAMPLES 20\n#define MUL_THR 0.01\n\n// ------\n\nuniform bool isVert;\nuniform sampler2D sampler0;\n\nuniform float var;\n\nfloat gaussian( float _x, float _v ) {\n  return 1.0 / sqrt( 2.0 * PI * _v ) * exp( - _x * _x / 2.0 / _v );\n}\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n\n  if ( var <= 0.0 ) {\n    gl_FragColor = texture2D( sampler0, uv );\n    return;\n  }\n\n  vec2 bv = ( isVert ? vec2( 0.0, 1.0 ) : vec2( 1.0, 0.0 ) ) / resolution;\n\n  vec3 sum = vec3( 0.0 );\n  for ( int i = 0; i <= SAMPLES; i ++ ) {\n    float mul = gaussian( abs( float( i ) ), var );\n    if ( mul < MUL_THR ) { break; }\n    for ( int j = -1; j < 2; j += 2 ) {\n      vec2 v = saturate( uv + bv * float( i * j ) );\n      vec3 tex = texture2D( sampler0, v ).xyz;\n      sum += tex * mul;\n      if ( i == 0 ) { break; }\n    }\n  }\n\n  gl_FragColor = vec4( sum, 1.0 );\n}\n"},function(e,t){e.exports="uniform sampler2D samplerDry;\nuniform sampler2D samplerWet;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  vec3 dry = texture2D( samplerDry, uv ).xyz;\n  vec3 wet = texture2D( samplerWet, uv ).xyz;\n  gl_FragColor = vec4( saturate( dry + wet ), 1.0 );\n}\n"},function(e,t,n){"use strict";n.r(t);var i=n(1),r=n(0),a=n(8),o=n.n(a);t.default=(e=>{const t=e.glCatPath,a=t.glCat,s=a.gl,l=e.automaton.auto,u=o()(),c=a.createVertexbuffer(new Float32Array(u.position)),f=a.createVertexbuffer(new Float32Array(u.normal)),m=a.createIndexbuffer(new Int16Array(u.index)),h=r.b(11,11).map((e,t)=>e/5-1),d=a.createVertexbuffer(new Float32Array(h));t.add({box:{vert:n(25),frag:n(26),blend:[s.ONE,s.ZERO],drawbuffers:3,func:(e,t)=>{a.attribute("aPos",c,3),a.attribute("aNor",f,3),a.attributeDivisor("aMatrix",d,2,1),a.uniform1i("isShadow",t.isShadow),a.uniform1f("size",l("box-size")),a.uniform1f("posOffset",l("box-posOffset")),a.uniform1f("spinOffset",l("box-spinOffset"));let n=i.a.mat4Identity();a.uniformMatrix4fv("matM",n);let r=a.getExtension("ANGLE_instanced_arrays");s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,m),r.drawElementsInstancedANGLE(s.TRIANGLES,u.index.length,s.UNSIGNED_SHORT,0,h.length/2),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null)}}})})},function(e,t){e.exports="// == attributes ===============================================================\nattribute vec3 aPos;\nattribute vec3 aNor;\nattribute vec2 aMatrix;\n\n// == varyings =================================================================\nvarying vec3 vPos;\nvarying vec3 vNor;\n\nuniform bool isShadow;\n\nuniform float posOffset;\nuniform float spinOffset;\nuniform float size;\n\nuniform mat4 matM;\n\n// == main =====================================================================\nvoid main() {\n  calcRhythms();\n\n  vec4 pos = vec4( ( 1.0 + 0.2 * sin( PI * exp( -10.0 * kickTime ) ) ) * size * aPos, 1.0 );\n  pos.yz = rotate2D( spinOffset * aMatrix.x + 1.3 * time ) * pos.yz;\n  pos.zx = rotate2D( spinOffset * aMatrix.y + 0.7 * time ) * pos.zx;\n  pos.xy += posOffset * aMatrix;\n  pos = matM * pos;\n  vPos = pos.xyz;\n\n  vec4 nor = vec4( aNor, 0.0 );\n  nor.yz = rotate2D( spinOffset * aMatrix.x + 1.3 * time ) * nor.yz;\n  nor.zx = rotate2D( spinOffset * aMatrix.y + 0.7 * time ) * nor.zx;\n  nor = normalize( matM * nor );\n  vNor = nor.xyz;\n\n  vec4 outPos;\n  if ( isShadow ) {\n    outPos = matPL * matVL * pos;\n  } else {\n    outPos = matP * matV * pos;\n    outPos.x /= resolution.x / resolution.y;\n  }\n  gl_Position = outPos;\n}"},function(e,t){e.exports="// == shit =====================================================================\n#extension GL_EXT_draw_buffers : require\n\n// == varyings =================================================================\nvarying vec3 vPos;\nvarying vec3 vNor;\n\n// == uniforms =================================================================\nuniform bool isShadow;\n\n// == main =====================================================================\nvoid main() {\n  if ( isShadow ) {\n    gl_FragData[ 0 ] = vec4( calcDepthL( vPos - lightPos ), 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  gl_FragData[ 0 ] = vec4( vPos, 1.0 );\n  gl_FragData[ 1 ] = vec4( vNor, 1.0 );\n  gl_FragData[ 2 ] = vec4( 0.01, 0.03, 0.1, 3.0 );\n}"},function(e,t,n){"use strict";n.r(t);n(4);var i=n(0);n(1);t.default=(e=>{const t=e.glCatPath,r=t.glCat,a=r.gl,o=e.automaton.auto,s=n(28)({radius:1,hole:.8}),l=r.createVertexbuffer(s.position),u=r.createVertexbuffer(s.uv),c=r.createVertexbuffer(s.normal),f=r.createVertexbuffer(new Float32Array(i.a(30))),m=r.createIndexbuffer(s.index);t.add({circle:{vert:n(29),frag:n(30),blend:[a.ONE,a.ZERO],cull:!1,drawbuffers:3,func:(e,t)=>{r.attribute("aPos",l,3),r.attribute("aUv",u,2),r.attribute("aNor",c,3),r.attributeDivisor("aMatrix",f,1,1),r.uniform1i("isShadow",t.isShadow),r.uniform1f("availZ",o("circle-availZ")),r.uniform3fv("color",[1,.1,.3]);let n=r.getExtension("ANGLE_instanced_arrays");a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,m),n.drawElementsInstancedANGLE(a.TRIANGLES,s.index.length,a.UNSIGNED_SHORT,0,30),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}}})})},function(e,t){e.exports=(e=>{let t=Object.assign({radius:1,hole:.5,segments:16},e),n=new Float32Array(6*t.segments),i=new Float32Array(4*t.segments),r=new Float32Array(6*t.segments),a=new Int16Array(6*t.segments),o=t.radius,s=t.hole,l=t.hole/t.radius;const u=2*Math.PI/t.segments;for(let e=0;e<t.segments;e++){const c=e*u,f=Math.cos(c),m=Math.sin(c);n.set([f*s,m*s,0,f*o,m*o,0],6*e),i.set([.5+.5*f*l,.5+.5*m*l,.5+.5*f,.5+.5*m],4*e),r.set([0,0,1,0,0,1],6*e);const h=2*e,d=h+1,A=e===t.segments-1?0:2*e+2,p=A+1;a.set([h,d,p,h,p,A],6*e)}return{position:n,uv:i,normal:r,index:a}})},function(e,t){e.exports="// == attributes ===============================================================\nattribute vec3 aPos;\nattribute vec2 aUv;\nattribute vec3 aNor;\nattribute float aMatrix;\n\n// == varyings =================================================================\nvarying vec3 vPos;\nvarying vec2 vUv;\nvarying vec3 vNor;\nvarying float vScale;\nvarying float vPattern;\n\n// == uniforms =================================================================\nuniform bool isShadow;\n\n// == main =====================================================================\nvoid main() {\n  vec4 pos = vec4( aPos, 1.0 );\n  pos.z += mod( aMatrix + zOffset.x, 30.0 ) - 20.0;\n  vPos = pos.xyz;\n\n  float rot = time * zp2mp( random4( aMatrix * 0.4 + 0.1 ).x );\n  pos.xy = rotate2D( rot ) * pos.xy;\n\n  vUv = aUv;\n  vScale = 1.5;\n  vPattern = mod( aMatrix, 3.0 );\n\n  vec4 nor = normalize( vec4( aNor, 0.0 ) );\n  vNor = nor.xyz;\n\n  vec4 outPos;\n  if ( isShadow ) {\n    outPos = matPL * matVL * pos;\n  } else {\n    outPos = matP * matV * pos;\n    outPos.x /= resolution.x / resolution.y;\n  }\n  gl_Position = outPos;\n}"},function(e,t){e.exports="#extension GL_EXT_draw_buffers : require\n\n// == varyings =================================================================\nvarying vec3 vPos;\nvarying vec2 vUv;\nvarying vec3 vNor;\nvarying float vScale;\nvarying float vPattern;\n\n// == uniforms =================================================================\nuniform bool isShadow;\nuniform float availZ;\n\n// == main =====================================================================\nvoid main() {\n  if ( isShadow ) {\n    gl_FragData[ 0 ] = vec4( calcDepthL( vPos - lightPos ), 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  if (\n    vPos.z < availZ ||\n    inRange( availZ + 0.5, availZ + 1.0, vPos.z )\n  ) { discard; }\n\n  // this bool means visibility\n  bool b = false;\n\n  vec2 uv = vUv;\n\n  if ( vPattern < 0.5 ) {\n    vec2 uv = abs( uv - 0.5 );\n    b = (\n      ( uv.x < 0.15 / vScale ) ? (\n        ( uv.y - 0.45 < 0.03 / vScale ) &&\n        !( ( uv.y - 0.45 ) - ( uv.x - 0.025 / vScale ) * sqrt( 3.0 ) < 0.0 )\n      ) : abs( length( uv ) - 0.45 ) < 0.01 / vScale\n    );\n  } else if ( vPattern < 1.5 ) {\n    vec2 uv = uv - 0.5;\n    b = (\n      abs( fract( atan( uv.y, uv.x ) * 40.0 / PI ) - 0.5 ) < 0.2 / vScale / length( uv ) &&\n      abs( length( uv ) - 0.45 ) < 0.05 / vScale\n    );\n  } else if ( vPattern < 2.5 ) {\n    vec2 uv = abs( uv - 0.5 );\n    b = (\n      abs( length( uv ) - 0.45 ) < 0.04 / vScale &&\n      0.1 / vScale < min( uv.x, uv.y ) ||\n      abs( length( uv ) - 0.47 ) < 0.01 / vScale\n    );\n  }\n\n  if ( !b ) { discard; }\n\n  gl_FragData[ 0 ] = vec4( vPos, 1.0 );\n  gl_FragData[ 1 ] = vec4( vNor, 1.0 );\n  gl_FragData[ 2 ] = vec4( 2.0, 0.0, 0.0, 4.0 );\n}"},function(e,t,n){"use strict";n.r(t);var i=n(0);t.default=(e=>{const t=e.glCatPath,r=t.glCat,a=r.gl,o=r.createVertexbuffer(new Float32Array(i.c));t.add({distance:{vert:n(3),frag:n(32),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,float:!0,func:(e,t)=>{r.attribute("p",o,2),r.uniformTexture("sampler0",t.input,0),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}})})},function(e,t){e.exports="uniform sampler2D sampler0;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  vec4 pos = texture2D( sampler0, uv );\n  gl_FragColor = vec4( length( pos.xyz - cameraPos ) / far, 0.0, 0.0, 1.0 );\n}"},function(e,t,n){"use strict";n.r(t);var i=n(0);t.default=(e=>{const t=e.glCatPath,r=t.glCat,a=r.gl,o=e.automaton.auto,s=r.createVertexbuffer(new Float32Array(i.c));t.add({dof:{vert:n(3),frag:e.isVR?n(34):n(35),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,float:!0,func:(e,t)=>{r.attribute("p",s,2),r.uniform1f("bokehAmp",o("dof-amp")),r.uniform1f("bokehFocus",o("dof-focus")),r.uniformTexture("samplerDry",t.dry,0),r.uniformTexture("samplerDepth",t.depth,1),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}})})},function(e,t){e.exports="#define FOG_ONE calcDepth(mix(near,far,0.25))\n#define FOG_ZERO calcDepth(far)\n\nuniform sampler2D samplerDry;\nuniform sampler2D samplerDepth;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n\n  vec3 col = texture2D( samplerDry, uv ).xyz;\n  float len = texture2D( samplerDepth, uv ).x;\n  col = mix( bgColor.xyz, col, linearstep( FOG_ZERO, FOG_ONE, len ) );\n\n  gl_FragColor = vec4( col, 1.0 );\n}\n"},function(e,t){e.exports="// Ref: https://www.shadertoy.com/view/4d2Xzw\n\n#define FOG_ONE calcDepth(mix(near,far,0.25))\n#define FOG_ZERO calcDepth(far)\n#define BOKEH_ITER 10\n#define BOKEH_ANGLE 2.39996\n#define BOKEH_RADIUS_MAX (resolution.x / 64.0)\n\nuniform sampler2D samplerDry;\nuniform sampler2D samplerDepth;\n\nuniform float bokehAmp;\nuniform float bokehFocus;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n\n  float radiusPerStep = BOKEH_RADIUS_MAX / float( BOKEH_ITER );\n  float radius = radiusPerStep * 1E-5; // EPSILON\n  vec4 seed = texture2D( samplerRandomDynamic, uv );\n  prng( seed ); // mix well\n  prng( seed ); // mix well\n  vec2 nOffset = vec2( 0.0, 1.0 ) * rotate2D( TAU * prng( seed ) );\n  mat2 rotator = rotate2D( BOKEH_ANGLE );\n\n  vec4 sum = vec4( 0.0 );\n\n  for ( int i = 0; i < BOKEH_ITER; i ++ ) {\n    vec2 uv = ( gl_FragCoord.xy + nOffset * radius ) / resolution;\n    vec3 col = texture2D( samplerDry, uv ).xyz;\n    float len = texture2D( samplerDepth, uv ).x;\n\n    col = mix( bgColor.xyz, col, linearstep( FOG_ZERO, FOG_ONE, len ) );\n\n    float r = min( max( abs( 1.0 / len - 1.0 / calcDepth( bokehFocus ) ) * bokehAmp, 1E-2 ), BOKEH_RADIUS_MAX );\n    float amp = 1.0 / ( r / BOKEH_RADIUS_MAX * float( BOKEH_ITER ) );\n    amp *= linearstep( radius, radius + radiusPerStep, r );\n    sum += vec4( col, 1.0 ) * amp;\n\n    nOffset = rotator * nOffset;\n    radius += radiusPerStep;\n  }\n\n  gl_FragColor = vec4( sum.xyz / sum.w, 1.0 );\n}\n"},function(e,t,n){"use strict";n.r(t);var i=n(4),r=n(0);new i.a(15881342356);t.default=(e=>{const t=e.glCatPath,i=t.glCat,a=i.gl,o=e.automaton.auto,s=i.createVertexbuffer(new Float32Array(r.c)),l=i.createVertexbuffer(new Float32Array(r.d)),u=i.createVertexbuffer(new Float32Array(r.b(8,8).map((e,t)=>t%2==0?(1*e+.5)/8/1:(e+.5)/8))),c=i.createTexture();i.setTextureFromArray(c,1,1,new Uint8Array([0,0,0,0])),t.add({patternsCompute:{width:8,height:8,vert:n(3),frag:n(37),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,swapbuffer:!0,float:!0,func:(e,t)=>{i.attribute("p",s,2),i.uniform1f("nParticle",64),i.uniform1f("nParticleSqrt",8),i.uniform1f("ppp",1),i.uniformTexture("samplerPcompute",e.swapbuffer.texture,0),i.uniform1f("noisePhase",o("patterns-noisePhase")),i.uniform1f("genRate",o("patterns-genRate")),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},patternsRender:{vert:n(38),frag:n(39),blend:[a.ONE,a.ZERO],drawbuffers:3,func:(e,n)=>{i.attribute("aPos",l,3),i.attributeDivisor("aComputeUV",u,2,1),i.uniform1f("nParticle",64),i.uniform1f("nParticleSqrt",8),i.uniform1f("ppp",1),i.uniform2fv("resolutionPcompute",[8,8]),i.uniform1i("isShadow",n.isShadow?1:0),i.uniformTexture("samplerPcompute",t.fb("patternsCompute").texture,0),i.uniformTexture("samplerShadow",n.textureShadow||c,1),i.getExtension("ANGLE_instanced_arrays").drawArraysInstancedANGLE(a.TRIANGLE_STRIP,0,4,64)}}})})},function(e,t){e.exports="#define PARTICLE_LIFE_LENGTH 0.5\n\nuniform float nParticleSqrt;\nuniform float nParticle;\nuniform float ppp;\n\nuniform sampler2D samplerPcompute;\n\nuniform float genRate;\n\n// ------\n\nvec2 vInvert( vec2 _uv ) {\n  return vec2( 0.0, 1.0 ) + vec2( 1.0, -1.0 ) * _uv;\n}\n\n// ------\n\nvec4 sampleRandom( vec2 _uv ) {\n  return texture2D( samplerRandomDynamic, _uv );\n}\n\n// ------\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  vec2 puv = vec2( ( floor( gl_FragCoord.x / ppp ) * ppp + 0.5 ) / resolution.x, uv.y );\n  float mode = mod( gl_FragCoord.x, ppp );\n  vec2 dpix = vec2( 1.0 ) / resolution;\n\n  float dt = deltaTime;\n\n  // == prepare some vars ======================================================\n  vec4 seed = texture2D( samplerRandomDynamic, puv );\n  prng( seed );\n\n  vec4 pos = texture2D( samplerPcompute, puv );\n\n  float timing = mix( 0.0, PARTICLE_LIFE_LENGTH, floor( puv.y * nParticleSqrt ) / nParticleSqrt );\n  timing += lofi( time, PARTICLE_LIFE_LENGTH );\n\n  if ( time - deltaTime + PARTICLE_LIFE_LENGTH < timing ) {\n    timing -= PARTICLE_LIFE_LENGTH;\n  }\n\n  // == generate particles =====================================================\n  if (\n    time - deltaTime < timing && timing <= time &&\n    prng( seed ) < genRate\n  ) {\n    dt = time - timing;\n\n    pos.xyz = 3.0 * randomBox( seed ) - vec3( 0.0, 0.0, 2.0 );\n    pos.w = 1.0; // life\n  } else {\n    // == update particles =====================================================\n    pos.z += zOffset.y * dt;\n    pos.w -= dt / PARTICLE_LIFE_LENGTH;\n  }\n\n  gl_FragColor = pos;\n}"},function(e,t){e.exports="attribute vec3 aPos;\nattribute vec2 aComputeUV;\n\nvarying vec3 vPos;\nvarying vec3 vRawPos;\nvarying vec3 vCol;\nvarying float vLife;\nvarying float vMode;\n\nuniform vec2 resolutionPcompute;\n\nuniform bool isShadow;\n\nuniform float colorVar;\nuniform float colorOffset;\n\nuniform sampler2D samplerPcompute;\n\nvoid main() {\n  // == fetch compute texture ==================================================\n  vec2 puv = aComputeUV;\n  vec2 dppix = vec2( 1.0 ) / resolutionPcompute;\n\n  vec4 pos = texture2D( samplerPcompute, puv );\n\n  // == ???????? ===============================================================\n  vec4 dice = texture2D( samplerRandomStatic, puv.xy * 182.92 );\n\n  // == assign varying variables ===============================================\n  vLife = pos.w;\n\n  // vCol = (\n  //   dice.y < 0.8\n  //   ? pow( catColor( TAU * ( ( dice.x * 2.0 - 1.0 ) * colorVar + colorOffset ) ), vec3( 2.0 ) )\n  //   : vec3( 0.4 )\n  // );\n  // vCol = abs( vel.xyz );\n  vCol = 2.0 * exp( 2.3 * ( vLife - 1.0 ) ) * catColor( 6.9 + 2.0 * ( 1.0 - vLife ) );\n\n  // == geometry ===============================================================\n  float size = 0.2;\n  pos.xyz += aPos * size;\n  vRawPos = aPos;\n  vMode = floor( 4.0 * dice.y );\n\n  // == finalize ===============================================================\n  vPos = pos.xyz;\n\n  vec4 outPos;\n  if ( isShadow ) {\n    outPos = matPL * matVL * vec4( pos.xyz, 1.0 );\n  } else {\n    outPos = matP * matV * vec4( pos.xyz, 1.0 );\n    outPos.x /= resolution.x / resolution.y;\n  }\n  gl_Position = outPos;\n}"},function(e,t){e.exports="#extension GL_EXT_draw_buffers : require\n\nvarying vec3 vPos;\nvarying vec3 vCol;\nvarying vec3 vRawPos;\nvarying float vLife;\nvarying float vMode;\n\nuniform bool isShadow;\n\nuniform sampler2D samplerShadow;\n\n// == patterns =================================================================\nbool ptn0( vec2 _p ) {\n  float inner = pow( 1.0 - vLife, 2.0 );\n  float outer = 1.0 - exp( -5.0 * ( 1.0 - vLife ) );\n  vec2 p = _p;\n  return inner < length( p ) && length( p ) < outer;\n}\n\nbool ptn1( vec2 _p ) {\n  float inner = 0.7 * pow( 1.0 - vLife, 2.0 );\n  float outer = 0.7 * ( 1.0 - exp( -5.0 * ( 1.0 - vLife ) ) );\n  vec2 p = _p * rotate2D( PI * ( 1.0 - exp( -2.0 * ( 1.0 - vLife ) ) ) );\n  return (\n    max( abs( p.x ), abs( p.y ) ) < outer &&\n    inner < max( abs( p.x ), abs( p.y ) )\n  );\n}\n\nbool ptn2( vec2 _p ) {\n  float inner = 0.7 * pow( 1.0 - vLife, 2.0 );\n  float outer = 0.7 * ( 1.0 - exp( -5.0 * ( 1.0 - vLife ) ) );\n  vec2 p = _p * rotate2D( PI / 4.0 );\n  return (\n    max( abs( p.x ), abs( p.y ) ) < outer &&\n    inner < min( abs( p.x ), abs( p.y ) )\n  );\n}\n\nbool ptn3( vec2 _p ) {\n  float inner = 0.3 * ( 1.0 - pow( 1.0 - vLife, 2.0 ) );\n  float outer = 0.3 * ( ( 1.0 - exp( -5.0 * ( 1.0 - vLife ) ) ) );\n  float radius = 0.7 * ( ( 1.0 - exp( -5.0 * ( 1.0 - vLife ) ) ) );\n  \n  vec2 p = _p;\n  p = rotate2D( -PI / 2.0 ) * p;\n  p = rotate2D( -lofir( atan( p.y, p.x ), TAU / 6.0 ) ) * p;\n  p.x -= radius * ( ( 1.0 - exp( -5.0 * ( 1.0 - vLife ) ) ) );\n  return (\n    length( p ) < inner &&\n    length( p ) < outer\n  );\n}\n\n// == main procedure ===========================================================\nvoid main() {\n  if ( vLife <= 0.0 ) { discard; }\n\n  // if ( 0.5 < length( gl_PointCoord - 0.5 ) ) { discard; }\n\n  if ( isShadow ) {\n    gl_FragData[ 0 ] = vec4( calcDepthL( vPos - lightPos ), 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  vec2 p = vRawPos.xy;\n  bool b = false;\n\n  if ( vMode < 0.5 ) {\n    b = b || ptn0( p );\n\n  } else if ( vMode < 1.5 ) {\n    b = b || ptn1( p );\n\n  } else if ( vMode < 2.5 ) {\n    b = b || ptn2( p );\n\n  } else {\n    b = b || ptn3( p );\n\n  }\n\n  if ( !b ) { discard; }\n\n  gl_FragData[ 0 ] = vec4( vPos, 1.0 );\n  gl_FragData[ 1 ] = vec4( 0.0, 0.0, 1.0, 1.0 );\n  gl_FragData[ 2 ] = vec4( 1.7, 0.8, 1.1, 2.0 );\n}"},function(e,t,n){"use strict";n.r(t);var i=n(4),r=n(0);new i.a(15881342356);t.default=(e=>{const t=e.glCatPath,i=t.glCat,a=i.gl,o=e.automaton.auto,s=i.createVertexbuffer(new Float32Array(r.c)),l=i.createVertexbuffer(new Float32Array(r.b(512,512).map((e,t)=>t%2==0?(2*e+.5)/512/2:(e+.5)/512))),u=i.createTexture();i.setTextureFromArray(u,1,1,new Uint8Array([0,0,0,0])),t.add({particlesCompute:{width:1024,height:512,vert:n(3),frag:n(41),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,swapbuffer:!0,float:!0,func:(e,t)=>{i.attribute("p",s,2),i.uniform1f("nParticle",262144),i.uniform1f("nParticleSqrt",512),i.uniform1f("ppp",2),i.uniformTexture("samplerPcompute",e.swapbuffer.texture,0),i.uniform1f("noisePhase",o("particles-noisePhase")),i.uniform1f("genRate",o("particles-genRate")),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},particlesRender:{vert:n(42),frag:n(43),blend:[a.ONE,a.ZERO],drawbuffers:3,func:(e,n)=>{i.attribute("computeUV",l,2),i.uniform1f("nParticle",262144),i.uniform1f("nParticleSqrt",512),i.uniform1f("ppp",2),i.uniform2fv("resolutionPcompute",[1024,512]),i.uniform1i("isShadow",n.isShadow?1:0),i.uniform1f("colorVar",o("particles-colorVar")),i.uniform1f("colorOffset",o("particles-colorOffset")),i.uniformTexture("samplerPcompute",t.fb("particlesCompute").texture,0),i.uniformTexture("samplerShadow",n.textureShadow||u,1),a.drawArrays(a.POINTS,0,262144)}}})})},function(e,t){e.exports="#define PARTICLE_LIFE_LENGTH 3.0\n\nuniform float nParticleSqrt;\nuniform float nParticle;\nuniform float ppp;\n\nuniform sampler2D samplerPcompute;\n\nuniform float noisePhase;\nuniform float velScale;\nuniform float genRate;\n\n// ------\n\nvec2 vInvert( vec2 _uv ) {\n  return vec2( 0.0, 1.0 ) + vec2( 1.0, -1.0 ) * _uv;\n}\n\n// ------\n\nvec4 sampleRandom( vec2 _uv ) {\n  return texture2D( samplerRandomDynamic, _uv );\n}\n\n// ------\n\nvoid main() {\n  calcRhythms();\n\n  vec2 uv = gl_FragCoord.xy / resolution;\n  vec2 puv = vec2( ( floor( gl_FragCoord.x / ppp ) * ppp + 0.5 ) / resolution.x, uv.y );\n  float mode = mod( gl_FragCoord.x, ppp );\n  vec2 dpix = vec2( 1.0 ) / resolution;\n\n  float dt = deltaTime;\n\n  // == prepare some vars ======================================================\n  vec4 seed = texture2D( samplerRandomDynamic, puv );\n  prng( seed );\n\n  vec4 pos = texture2D( samplerPcompute, puv );\n  vec4 vel = texture2D( samplerPcompute, puv + dpix * vec2( 1.0, 0.0 ) );\n\n  float timing = mix( 0.0, PARTICLE_LIFE_LENGTH, floor( puv.y * nParticleSqrt ) / nParticleSqrt );\n  timing += lofi( time, PARTICLE_LIFE_LENGTH );\n\n  if ( time - deltaTime + PARTICLE_LIFE_LENGTH < timing ) {\n    timing -= PARTICLE_LIFE_LENGTH;\n  }\n\n  // == generate particles =====================================================\n  if (\n    time - deltaTime < timing && timing <= time &&\n    prng( seed ) < genRate\n  ) {\n    dt = time - timing;\n\n    pos.xyz = 4.0 * randomSphere( seed ) - vec3( 0.0, 0.0, 5.0 );\n\n    vel.xyz = 0.0 * randomSphere( seed );\n    vel.w = 0.0;\n\n    pos.w = 1.0; // life\n  } else {\n    // == update particles =======================================================\n    vel.xyz += dt * ( 10.0 + 20.0 * exp( -5.0 * kickTime ) ) * vec3(\n      noise4d( vec4( 0.8 * pos.xyz, 1.485 + 0.1 * time ) ),\n      noise4d( vec4( 0.8 * pos.xyz, 3.485 + 0.1 * time ) ),\n      noise4d( vec4( 0.8 * pos.xyz, 5.485 + 0.1 * time ) )\n    );\n    vel.xyz += 4.0 * dt * smoothstep( 3.0, 1.5, length( pos.xyz ) ) * normalize( pos.xyz );\n    vel.xyz *= exp( -5.0 * dt );\n\n    pos.xyz += vel.xyz * dt;\n    pos.z += zOffset.y * dt;\n    pos.w -= dt / PARTICLE_LIFE_LENGTH;\n  }\n\n  gl_FragColor = (\n    mode < 1.0 ? pos :\n    vel\n  );\n}"},function(e,t){e.exports="attribute vec2 computeUV;\n\nvarying vec3 vPos;\nvarying vec3 vCol;\nvarying float vLife;\n\nuniform vec2 resolutionPcompute;\n\nuniform bool isShadow;\n\nuniform float colorVar;\nuniform float colorOffset;\n\nuniform sampler2D samplerPcompute;\n\nvoid main() {\n  // == fetch compute texture ==================================================\n  vec2 puv = computeUV;\n  vec2 dppix = vec2( 1.0 ) / resolutionPcompute;\n\n  vec4 pos = texture2D( samplerPcompute, puv );\n  vec4 vel = texture2D( samplerPcompute, puv + dppix * vec2( 1.0, 0.0 ) );\n\n  // == ???????? ===============================================================\n  vec4 dice = texture2D( samplerRandomStatic, puv.xy * 182.92 );\n\n  // == assign varying variables ===============================================\n  vLife = pos.w;\n\n  // vCol = (\n  //   dice.y < 0.8\n  //   ? pow( catColor( TAU * ( ( dice.x * 2.0 - 1.0 ) * colorVar + colorOffset ) ), vec3( 2.0 ) )\n  //   : vec3( 0.4 )\n  // );\n  // vCol = abs( vel.xyz );\n  vCol = 2.0 * exp( 2.3 * ( vLife - 1.0 ) ) * catColor( 6.9 + 2.0 * ( 1.0 - vLife ) );\n\n  // == geometry ===============================================================\n  float size = ( 0.001 + 0.01 * pow( dice.w, 6.0 ) ) * pow( sin( PI * vLife ), 0.25 );\n\n  // == finalize ===============================================================\n  vPos = pos.xyz;\n\n  vec4 outPos;\n  if ( isShadow ) {\n    outPos = matPL * matVL * vec4( pos.xyz, 1.0 );\n  } else {\n    outPos = matP * matV * vec4( pos.xyz, 1.0 );\n    outPos.x /= resolution.x / resolution.y;\n  }\n  gl_Position = outPos;\n  gl_PointSize = resolution.y * size / outPos.z / matP[ 0 ].x;\n}"},function(e,t){e.exports="#extension GL_EXT_draw_buffers : require\n\nvarying vec3 vPos;\nvarying vec3 vCol;\nvarying float vLife;\n\nuniform bool isShadow;\n\nuniform sampler2D samplerShadow;\n\n// == main procedure ===========================================================\nvoid main() {\n  if ( vLife <= 0.0 ) { discard; }\n\n  if ( 0.5 < length( gl_PointCoord - 0.5 ) ) { discard; }\n\n  if ( isShadow ) {\n    gl_FragData[ 0 ] = vec4( calcDepthL( vPos - lightPos ), 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  gl_FragData[ 0 ] = vec4( vPos, 1.0 );\n  gl_FragData[ 1 ] = vec4( 0.0, 0.0, 1.0, 1.0 );\n  gl_FragData[ 2 ] = vec4( 0.8, 0.9, 2.0, 4.0 );\n}"},function(e,t,n){"use strict";n.r(t);var i=n(0);t.default=(e=>{const t=e.glCatPath,r=t.glCat,a=r.gl,o=e.automaton.auto,s=r.createVertexbuffer(new Float32Array(i.c));t.add({post:{vert:n(3),frag:(e.isVR?"#define VR\n":"")+n(45),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,float:!0,func:(e,t)=>{r.attribute("p",s,2),r.uniform1f("barrelAmp",o("post-barrelAmp")),r.uniform1f("barrelOffset",o("post-barrelOffset")),r.uniformTexture("sampler0",t.input,0),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},glitch:{vert:n(3),frag:n(46),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,float:!0,func:(e,t)=>{r.attribute("p",s,2),r.uniform1f("amp",o("glitch-amp")),r.uniform1f("fadeout",o("glitch-fadeout")),r.uniformTexture("sampler0",t.input,0),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},fxaa:{vert:n(3),frag:n(47),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,float:!0,func:(e,t)=>{r.attribute("p",s,2),r.uniformTexture("sampler0",t.input,0),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}})})},function(e,t){e.exports="#define BARREL_ITER 10\n\n// == uniforms =================================================================\nuniform float barrelAmp;\nuniform float barrelOffset;\nuniform sampler2D sampler0;\n\n// == distort a coordination and sample a texture ==============================\nvec3 barrel( float amp, vec2 uv ) {\n  float corn = length( vec2( 0.5 ) );\n  float a = min( 3.0 * sqrt( amp ), corn * PI );\n  float zoom = corn / ( tan( corn * a ) + corn );\n  vec2 p = saturate(\n    ( uv + normalize( uv - 0.5 ) * tan( length( uv - 0.5 ) * a ) ) * zoom +\n    0.5 * ( 1.0 - zoom )\n  );\n  return texture2D( sampler0, vec2( p.x, p.y ) ).xyz;\n}\n\n// == main =====================================================================\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  vec2 p = ( gl_FragCoord.xy * 2.0 - resolution ) / resolution.y;\n\n  // == glitch =================================================================\n  vec3 tex = vec3( 0.0 );\n\n#ifdef VR\n  tex = texture2D( sampler0, uv ).xyz;\n#else\n  // == do barrel distortion ===================================================\n  for ( int i = 0; i < BARREL_ITER; i ++ ) {\n    float fi = ( float( i ) + 0.5 ) / float( BARREL_ITER );\n    vec3 a = saturate( vec3(\n      1.0 - 3.0 * abs( 1.0 / 6.0 - fi ),\n      1.0 - 3.0 * abs( 1.0 / 2.0 - fi ),\n      1.0 - 3.0 * abs( 5.0 / 6.0 - fi )\n    ) ) / float( BARREL_ITER ) * 4.0;\n    tex += a * barrel( barrelOffset + barrelAmp * fi, uv );\n  }\n\n  // == do vignette ============================================================\n  float vig = 1.0 - length( p ) * 0.4;\n  tex = mix( vec3( 0.0 ), tex, vig );\n#endif\n\n  // == do color correction ====================================================\n  vec3 col = pow( saturate( tex.xyz ), vec3( 1.0 / 1.6 ) );\n  col = vec3(\n    smoothstep( 0.00, 1.00, col.x ),\n    col.y,\n    0.1 + 0.8 * col.z\n  );\n\n  // == done ===================================================================\n  gl_FragColor = vec4( col, 1.0 );\n}"},function(e,t){e.exports="uniform float amp;\nuniform float fadeout;\nuniform sampler2D sampler0;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  vec2 uv2 = uv;\n  float vrSegMul = isVR ? 0.25 : 1.0;\n  for ( int i = 0; i < 5; i ++ ) {\n    float p = pow( 2.0, float( i ) );\n    uv2 += amp * vec2( 1.0, 0.0 ) * zp2mp(\n      random4( uv2 / vec2( 256.0, 128.0 ) * vrSegMul * p + 0.5 * mod( totalFrame, 2.0 ) ).xy\n    ) / p;\n  }\n  vec2 displace = uv2 - uv;\n  displace += 0.2 * fadeout * vec2( zp2mp( random4( lofi( uv.y, 1.0 / 48.0 * vrSegMul ) ).x ), 0.0 );\n  gl_FragColor = vec4( ( 1.0 - fadeout ) * vec3(\n    texture2D( sampler0, fract( uv + displace ) ).x,\n    texture2D( sampler0, fract( uv + 1.2 * displace ) ).y,\n    texture2D( sampler0, fract( uv + 1.4 * displace ) ).z\n  ), 1.0 );\n}"},function(e,t){e.exports="#define FXAA_REDUCE_MIN (1.0 / 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 16.0\n\n// ------\n\nprecision highp float;\n\nuniform sampler2D sampler0;\n\n// ------\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n\n  #define T(v) texture2D( sampler0, (v) / resolution ).xyz\n  vec3 rgb11 = T( gl_FragCoord.xy );\n  vec3 rgb00 = T( gl_FragCoord.xy + vec2( -1.0, -1.0 ) );\n  vec3 rgb02 = T( gl_FragCoord.xy + vec2( -1.0,  1.0 ) );\n  vec3 rgb20 = T( gl_FragCoord.xy + vec2(  1.0, -1.0 ) );\n  vec3 rgb22 = T( gl_FragCoord.xy + vec2(  1.0,  1.0 ) );\n  #undef T\n\n  vec3 luma = vec3( 0.299, 0.587, 0.114 );\n  #define L(c) dot( c, luma )\n  float luma11 = L( rgb11 );\n  float luma00 = L( rgb00 );\n  float luma02 = L( rgb02 );\n  float luma20 = L( rgb20 );\n  float luma22 = L( rgb22 );\n  #undef L\n\n  float lumaMin = min( luma00, min( min( luma00, luma02 ), min( luma20, luma22 ) ) );\n  float lumaMax = max( luma00, max( max( luma00, luma02 ), max( luma20, luma22 ) ) );\n\n  vec2 dir = vec2(\n    -( ( luma00 + luma20 ) - ( luma02 + luma22 ) ),\n    ( ( luma00 + luma02 ) - ( luma20 + luma22 ) )\n  );\n\n  float dirReduce = max(\n    ( luma00 + luma02 + luma20 + luma22 ) * 0.25 * FXAA_REDUCE_MUL,\n    FXAA_REDUCE_MIN\n  );\n  float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\n  dir = min(\n    vec2( FXAA_SPAN_MAX ),\n    max(\n      vec2( -FXAA_SPAN_MAX ),\n      dir * rcpDirMin\n    )\n  ) / resolution;\n\n  vec3 rgbA = 0.5 * (\n    texture2D( sampler0, uv + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +\n    texture2D( sampler0, uv + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz\n  );\n  vec3 rgbB = rgbA * 0.5 + 0.25 * (\n    texture2D( sampler0, uv - dir * 0.5 ).xyz +\n    texture2D( sampler0, uv + dir * 0.5 ).xyz\n  );\n\n  float lumaB = dot( rgbB, luma );\n  gl_FragColor = (\n    ( ( lumaB < lumaMin ) || ( lumaMax < lumaB ) ) ?\n    vec4( rgbA, 1.0 ) :\n    vec4( rgbB, 1.0 )\n  );\n}"},function(e,t,n){"use strict";n.r(t);var i=n(4),r=n(0);new i.a(15881342356);t.default=(e=>{const t=e.glCatPath,i=t.glCat,a=i.gl,o=e.automaton.auto,s=i.createVertexbuffer(new Float32Array(r.c)),l=i.createVertexbuffer(new Float32Array(r.b(64,256).map((e,t)=>t%2==0?(2*e+.5)/64/2:(e+.5)/256))),u=i.createTexture();i.setTextureFromArray(u,1,1,new Uint8Array([0,0,0,0])),t.add({racerCompute:{width:128,height:256,vert:n(3),frag:n(49),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,swapbuffer:!0,float:!0,func:(e,t)=>{i.attribute("p",s,2),i.uniform1f("trails",256),i.uniform1f("trailLength",64),i.uniform1f("ppp",2),i.uniformTexture("samplerPcompute",e.swapbuffer.texture,0),i.uniform1f("genRate",o("racer-genRate")),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},racerRender:{vert:n(50),frag:n(51),blend:[a.ONE,a.ZERO],drawbuffers:3,func:(e,n)=>{i.attribute("aComputeUV",l,2),i.uniform1f("trails",256),i.uniform1f("trailLength",64),i.uniform1f("ppp",2),i.uniform2fv("resolutionPcompute",[128,256]),i.uniform1i("isShadow",n.isShadow?1:0),i.uniformTexture("samplerPcompute",t.fb("racerCompute").texture,0),i.uniformTexture("samplerShadow",n.textureShadow||u,1),a.drawArrays(a.POINTS,0,16384)}}})})},function(e,t){e.exports="#define PARTICLE_LIFE_LENGTH 3.0\n\nuniform float trails;\nuniform float trailLength;\nuniform float ppp;\n\nuniform sampler2D samplerPcompute;\nuniform float genRate;\n\n// ------\n\nvec2 vInvert( vec2 _uv ) {\n  return vec2( 0.0, 1.0 ) + vec2( 1.0, -1.0 ) * _uv;\n}\n\n// ------\n\nvec4 random( vec2 _uv ) {\n  return texture2D( samplerRandomDynamic, _uv );\n}\n\n// ------\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  vec2 puv = vec2( ( floor( gl_FragCoord.x / ppp ) * ppp + 0.5 ) / resolution.x, uv.y );\n  float mode = mod( gl_FragCoord.x, ppp );\n  vec2 dpix = vec2( 1.0 ) / resolution;\n\n  float dt = deltaTime;\n\n  // == if it is not head of particles =========================================\n  if ( ppp < gl_FragCoord.x ) {\n    puv.x -= ppp / resolution.x;\n    vec4 pos = texture2D( samplerPcompute, puv );\n    vec4 vel = texture2D( samplerPcompute, puv + dpix * vec2( 1.0, 0.0 ) );\n\n    pos.z += zOffset.y * dt;\n    pos.w = saturate( pos.w - 1.0 / trailLength );\n\n    gl_FragColor = (\n      mode < 1.0 ? pos :\n      vel\n    );\n    return;\n  }\n\n  // == prepare some vars for fuck around head particle ========================\n  vec4 seed = texture2D( samplerRandomDynamic, puv );\n  prng( seed );\n\n  vec4 pos = texture2D( samplerPcompute, puv );\n  vec4 vel = texture2D( samplerPcompute, puv + dpix * vec2( 1.0, 0.0 ) );\n\n  float timing = mix( 0.0, PARTICLE_LIFE_LENGTH, floor( puv.y * trails ) / trails );\n  timing += lofi( time, PARTICLE_LIFE_LENGTH );\n\n  if ( time - deltaTime + PARTICLE_LIFE_LENGTH < timing ) {\n    timing -= PARTICLE_LIFE_LENGTH;\n  }\n\n  // == initialize particles ===================================================\n  if (\n    time - deltaTime < timing && timing <= time\n  ) {\n    dt = time - timing;\n\n    pos.xyz = 2.0 * randomSphere( seed ) - vec3( 0.0, 0.0, zOffset.y );\n\n    vel.xyz = 1.0 * randomSphere( seed );\n    vel.w = 1.0; // jumping flag\n\n    pos.w = prng( seed ) < genRate ? 1.0 : 0.0; // life\n  } else {\n    vel.w = 0.0; // remove jumping flag\n  }\n\n  // == update particles =======================================================\n  vel.xyz += 10.0 * vec3(\n    noise4d( vec4( 0.4 * pos.xyz, 1.845 + 0.1 * time ) ),\n    noise4d( vec4( 0.4 * pos.xyz, 2.853 + 0.1 * time ) ),\n    noise4d( vec4( 0.4 * pos.xyz, 4.129 + 0.1 * time ) )\n  ) * dt;\n  vel.xy += 4.0 * dt * smoothstep( 2.0, 1.0, length( pos.xy ) ) * normalize( pos.xy );\n  vel.xyz *= exp( -1.0 * dt );\n\n  vec3 velt = vel.xyz;\n  velt.x *= abs( velt.x ) < abs( velt.y ) ? 0.0 : abs( velt.x ) < abs( velt.z ) ? 0.0 : 1.0;\n  velt.y *= abs( velt.y ) < abs( velt.z ) ? 0.0 : abs( velt.y ) < abs( velt.x ) ? 0.0 : 1.0;\n  velt.z *= abs( velt.z ) < abs( velt.x ) ? 0.0 : abs( velt.z ) < abs( velt.y ) ? 0.0 : 1.0;\n\n  pos.xyz += normalize( velt ) * 0.04;\n  pos.z += zOffset.y * dt;\n\n  gl_FragColor = (\n    mode < 1.0 ? pos :\n    vel\n  );\n}"},function(e,t){e.exports="attribute vec2 aComputeUV;\n\nvarying vec3 vPos;\nvarying float vLife;\n\nuniform float trails;\nuniform float trailLength;\nuniform float ppp;\n\nuniform bool isShadow;\n\nuniform float colorVar;\nuniform float colorOffset;\n\nuniform sampler2D samplerPcompute;\n\nvoid main() {\n  // == fetch compute texture ==================================================\n  vec2 puv = aComputeUV;\n  vec2 dppix = vec2( 1.0 ) / vec2( trailLength, trails );\n\n  vec4 pos = texture2D( samplerPcompute, puv );\n  vec4 vel = texture2D( samplerPcompute, puv + dppix * vec2( 1.0, 0.0 ) );\n\n  // == ???????? ===============================================================\n  vec4 dice = texture2D( samplerRandomStatic, puv.xy * 182.92 );\n\n  // == assign varying variables ===============================================\n  vLife = pos.w;\n\n  // == finalize ===============================================================\n  vPos = pos.xyz;\n\n  vec4 outPos;\n  if ( isShadow ) {\n    outPos = matPL * matVL * vec4( pos.xyz, 1.0 );\n  } else {\n    outPos = matP * matV * vec4( pos.xyz, 1.0 );\n    outPos.x /= resolution.x / resolution.y;\n  }\n  gl_Position = outPos;\n  gl_PointSize = resolution.y * 0.01 / outPos.z / matP[ 0 ].x;\n}"},function(e,t){e.exports="#extension GL_EXT_draw_buffers : require\n\nvarying vec3 vPos;\nvarying vec3 vCol;\nvarying float vLife;\n\nuniform bool isShadow;\n\nuniform sampler2D samplerShadow;\n\n// == main procedure ===========================================================\nvoid main() {\n  if ( vLife <= 0.0 ) { discard; }\n\n  if ( 0.5 < length( gl_PointCoord - 0.5 ) ) { discard; }\n\n  if ( isShadow ) {\n    gl_FragData[ 0 ] = vec4( calcDepthL( vPos - lightPos ), 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  float lumi = (\n    1.3 +\n    4.0 * exp( -3.0 * ( 1.0 - vLife ) ) +\n    9.0 * exp( -20.0 * ( 1.0 - vLife ) )\n  );\n\n  gl_FragData[ 0 ] = vec4( vPos, 1.0 );\n  gl_FragData[ 1 ] = vec4( 0.0, 0.0, 1.0, 1.0 );\n  gl_FragData[ 2 ] = vec4( lumi, 0.0, 0.0, 4.0 );\n}"},function(e,t,n){"use strict";n.r(t);var i=n(0);t.default=(e=>{const t=e.glCatPath,r=t.glCat,a=r.gl,o=(e.width,e.height,e.automaton.auto),s=r.createVertexbuffer(new Float32Array(i.c));t.add({raymarch:{vert:n(3),frag:n(53),blend:[a.ONE,a.ZERO],drawbuffers:3,func:(e,t)=>{r.attribute("p",s,2),r.uniform1i("isShadow",t.isShadow?1:0),r.uniform4fv("ifsParams",[o("raymarch-ifsParamsX"),o("raymarch-ifsParamsY"),o("raymarch-ifsParamsZ"),o("raymarch-ifsParamsW")]),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}})})},function(e,t){e.exports="#extension GL_EXT_frag_depth : require\n#extension GL_EXT_draw_buffers : require\n\n#define TRACE_ITER 1\n#define MARCH_MUL 0.8\n#define MARCH_ITER 60\n#define INTERSECT_MIN 0.01\n#define MARCH_FAR 20.0\n#define FOV 90.0\n\nuniform bool isShadow;\nuniform vec4 ifsParams;\n\n// ------\n\nstruct Camera {\n  mat4 matP;\n  mat4 matV;\n};\n\nstruct Ray {\n  vec3 dir;\n  vec3 ori;\n};\n\n// ------\n\nCamera camInit( in mat4 _matP, in mat4 _matV ) {\n  Camera cam;\n  cam.matP = _matP;\n  cam.matV = _matV;\n\n  return cam;\n}\n\nRay rayInit( in vec3 _ori, in vec3 _dir ) {\n  Ray ray;\n  ray.dir = _dir;\n  ray.ori = _ori;\n  return ray;\n}\n\nRay rayFromCam( in vec2 _uv, in Camera _cam ) {\n  mat4 imat = inverse( _cam.matP * _cam.matV );\n  vec4 near = imat * vec4( 2.0 * _uv - 1.0, 0.0, 1.0 );\n  vec4 far = near + imat[ 2 ];\n  near /= near.w;\n  far /= far.w;\n  vec3 dir = far.xyz - near.xyz;\n  dir.x *= resolution.x / resolution.y;\n  return rayInit( near.xyz, normalize( dir ) );\n}\n\n// ------\n\nfloat distBox( vec3 _p, vec3 _s ) {\n  vec3 d = abs( _p ) - _s;\n  return min( max( d.x, max( d.y, d.z ) ), 0.0 ) + length( max( d, 0.0 ) );\n}\n\nvec3 typeIfs( vec3 _p, vec3 _rot, vec3 _shift ) {\n  vec3 pos = _p;\n\n  vec3 shift = _shift;\n\n  for ( int i = 0; i < 5; i ++ ) {\n    float intensity = pow( 2.0, -float( i ) );\n\n    pos = abs( pos ) - shift * intensity;\n\n    shift.yz = rotate2D( _rot.x ) * shift.yz;\n    shift.zx = rotate2D( _rot.y ) * shift.zx;\n    shift.xy = rotate2D( _rot.z ) * shift.xy;\n\n    if ( pos.x < pos.y ) { pos.xy = pos.yx; }\n    if ( pos.x < pos.z ) { pos.xz = pos.zx; }\n    if ( pos.y < pos.z ) { pos.yz = pos.zy; }\n  }\n\n  return pos;\n}\n\nfloat distFunc( vec3 _p, out vec4 mtl ) {\n  float dist = 1E9;\n\n  vec3 p = _p - vec3( 0.0, 0.0, zOffset.x );\n\n  {\n    vec3 p = mod( p, 2.0 ) - 1.0;\n    float ch = min( distBox( p, vec3( 0.1, 0.01, 0.01 ) ), distBox( p, vec3( 0.01, 0.1, 0.01 ) ) );\n\n    mtl = ch < dist ? vec4( 0.8, 0.8, 0.8, 1.0 ) : mtl;\n    dist = ch < dist ? ch : dist;\n  }\n\n\n  if ( 224.0 beat < time ) {\n    vec3 p = p;\n    p.z = mod( p.z - 2.5, 5.0 ) - 2.5;\n    p = typeIfs( p, vec3( -0.01, 0.06, -0.01 ), vec3( ifsParams.x * 4.8, ifsParams.x * 6.8, 4.8 ) );\n    float ch = 1.8 * distBox( p / 1.8, vec3( ifsParams.y * 0.2 ) );\n\n    mtl = ch < dist ? vec4( 0.02, 0.05, 0.08, 3.0 ) : mtl;\n    dist = ch < dist ? ch : dist;\n  }\n\n  if ( 224.0 beat < time ) {\n    vec3 p = p;\n    p.z = mod( p.z - 1.0, 2.0 ) - 1.0;\n    p = typeIfs( p, vec3( 0.02, -0.13, 0.01 ), vec3( ifsParams.x * 11.4, ifsParams.x * 4.8, 5.1 ) );\n    float ch = distBox( p, vec3( ifsParams.y * 0.4 ) );\n\n    mtl = ch < dist ? vec4( 0.02, 0.05, 0.08, 3.0 ) : mtl;\n    dist = ch < dist ? ch : dist;\n  }\n\n  return dist;\n}\n\nfloat distFunc( vec3 _p ) {\n  vec4 dummy;\n  return distFunc( _p, dummy );\n}\n\nvec3 normalFunc( in vec3 _p, in float _d ) {\n  vec2 d = vec2( 0.0, _d );\n  return normalize( vec3(\n    distFunc( _p + d.yxx ) - distFunc( _p - d.yxx ),\n    distFunc( _p + d.xyx ) - distFunc( _p - d.xyx ),\n    distFunc( _p + d.xxy ) - distFunc( _p - d.xxy )\n  ) );\n}\n\n// ------\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n\n  Camera cam = camInit(\n    isShadow ? matPL : matP,\n    isShadow ? matVL : matV\n  );\n  Ray ray = rayFromCam( uv, cam );\n\n  float rayLen = 0.0;\n  vec3 rayPos = ray.ori + ray.dir * rayLen;\n  vec4 mtl;\n\n  float dist;\n  for ( int iMarch = 0; iMarch < MARCH_ITER; iMarch ++ ) {\n    dist = distFunc( rayPos, mtl );\n    rayLen += dist * MARCH_MUL;\n    rayPos = ray.ori + ray.dir * rayLen;\n\n    if ( abs( dist ) < INTERSECT_MIN ) { break; }\n    if ( MARCH_FAR < dist ) { break; }\n  }\n\n  vec3 normal = vec3( 0.0 );\n  if ( abs( dist ) < INTERSECT_MIN ) {\n    normal = normalFunc( rayPos, 1E-4 );\n\n    vec4 c = cam.matP * cam.matV * vec4( rayPos, 1.0 );\n    gl_FragDepthEXT = c.z / c.w;\n  } else {\n    gl_FragDepthEXT = 1.0;\n  }\n\n  if ( isShadow ) {\n    gl_FragData[ 0 ] = vec4( calcDepthL( rayPos - lightPos ), 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  gl_FragData[ 0 ] = vec4( rayPos, 1.0 );\n  gl_FragData[ 1 ] = vec4( normal, 1.0 );\n  gl_FragData[ 2 ] = mtl;\n}"},function(e,t,n){"use strict";n.r(t);var i=n(0);t.default=(e=>{const t=e.glCatPath,r=t.glCat,a=r.gl,o=r.createVertexbuffer(new Float32Array(i.c));t.add({render:{vert:n(3),frag:n(55),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,float:!0,func:(e,t)=>{r.attribute("p",o,2),r.uniformTexture("sampler0",t.inputs[0],0),r.uniformTexture("sampler1",t.inputs[1],1),r.uniformTexture("sampler2",t.inputs[2],2),r.uniformTexture("samplerShadow",t.shadow,3),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}})})},function(e,t){e.exports="// == uniforms =================================================================\nuniform sampler2D sampler0;\nuniform sampler2D sampler1;\nuniform sampler2D sampler2;\nuniform sampler2D samplerShadow;\n\n// == struct: isect ============================================================\nstruct Isect {\n  vec3 pos;\n  vec3 nor;\n  int mtl;\n  vec4 props;\n};\n\nIsect getIsect( vec2 _uv ) {\n  vec4 tex0 = texture2D( sampler0, _uv );\n  vec4 tex1 = texture2D( sampler1, _uv );\n  vec4 tex2 = texture2D( sampler2, _uv );\n\n  Isect isect;\n  isect.pos = tex0.xyz;\n  isect.nor = tex1.xyz;\n  isect.mtl = int( tex2.w );\n  isect.props = vec4( tex2.xyz, fract( floor( tex2.w ) ) );\n\n  return isect;\n}\n\nfloat getEdge( vec2 _uv ) {\n  vec4 tex0 = texture2D( sampler0, _uv - vec2( 0.0, 0.0 ) / resolution );\n  vec4 tex1 = texture2D( sampler1, _uv - vec2( 0.0, 0.0 ) / resolution );\n  vec4 tex2 = texture2D( sampler2, _uv - vec2( 0.0, 0.0 ) / resolution );\n  vec3 ray = tex0.xyz - cameraPos;\n  vec3 rayDir = normalize( ray );\n  float rayLen = length( ray );\n\n  vec4 tex0x = texture2D( sampler0, _uv + vec2( 1.0, 0.0 ) / resolution );\n  vec4 tex0y = texture2D( sampler0, _uv + vec2( 0.0, 1.0 ) / resolution );\n  vec4 tex1x = texture2D( sampler1, _uv + vec2( 1.0, 0.0 ) / resolution );\n  vec4 tex1y = texture2D( sampler1, _uv + vec2( 0.0, 1.0 ) / resolution );\n  vec4 tex2x = texture2D( sampler2, _uv + vec2( 1.0, 0.0 ) / resolution );\n  vec4 tex2y = texture2D( sampler2, _uv + vec2( 0.0, 1.0 ) / resolution );\n\n  float validx = tex2.w == tex2x.w ? 1.0 : 0.0;\n  float validy = tex2.w == tex2y.w ? 1.0 : 0.0;\n\n  return (\n    abs( dot( rayDir, tex0x.xyz ) - dot( rayDir, tex0.xyz ) ) / rayLen * validx +\n    abs( dot( rayDir, tex0y.xyz ) - dot( rayDir, tex0.xyz ) ) / rayLen * validy +\n    length( tex1x.xyz - tex1.xyz ) * validx +\n    length( tex1y.xyz - tex1.xyz ) * validy\n  );\n}\n\n// == shadow ===================================================================\nfloat shadow( Isect _isect ) {\n  vec3 lig = _isect.pos - lightPos;\n  float d = max( 0.001, dot( -_isect.nor, normalize( lig ) ) );\n\n  vec4 pl = matPL * matVL * vec4( _isect.pos, 1.0 );\n  vec2 uv = pl.xy / pl.w * 0.5 + 0.5;\n\n  float dc = calcDepthL( lig );\n  float ret = 0.0;\n  for ( int iy = -1; iy <= 1; iy ++ ) {\n    for ( int ix = -1; ix <= 1; ix ++ ) {\n      vec2 uv = uv + vec2( float( ix ), float ( iy ) ) * 1E-3;\n      float proj = texture2D( samplerShadow, uv ).x;\n      float bias = 0.001 + ( 1.0 - d ) * 0.003;\n\n      float dif = mix(\n        smoothstep( bias * 2.0, bias, abs( dc - proj ) ),\n        1.0,\n        smoothstep( 0.4, 0.5, max( abs( uv.x - 0.5 ), abs( uv.y - 0.5 ) ) )\n      );\n      ret += dif / 9.0;\n    }\n  }\n  return ret;\n}\n\n// == do shading ===============================================================\nvec3 radiance( Isect _isect, vec3 dif, vec3 spe, float rough ) {\n  // Ref: https://www.shadertoy.com/view/lsXSz7\n\n  // calc a bunch of vectors\n  vec3 ligDir = normalize( _isect.pos - lightPos );\n  vec3 viewDir = normalize( _isect.pos - cameraPos );\n  vec3 halfDir = normalize( ligDir + viewDir );\n\n  float dotLig = max( 0.001, dot( -_isect.nor, ligDir ) );\n  float dotView = max( 0.001, dot( -_isect.nor, viewDir ) );\n  float dotHalf = max( 0.001, dot( -_isect.nor, halfDir ) );\n  float dotHalfView = max( 0.001, dot( halfDir, viewDir ) );\n\n  // Cook-Torrance\n  float G = min( 1.0, 2.0 * dotHalf * min( dotView, dotLig ) / dotHalfView );\n\n  // Beckmann\n  float sqDotHalf = dotHalf * dotHalf;\n  float sqDotHalfRough = sqDotHalf * rough * rough;\n  float D = exp( ( sqDotHalf - 1.0 ) / sqDotHalfRough ) / ( sqDotHalf * sqDotHalfRough );\n\n  // Fresnel\n  vec3 Fspe = spe + ( 1.0 - spe ) * pow( 1.0 - dotHalfView, 5.0 );\n  vec3 Fdif = spe + ( 1.0 - spe ) * pow( 1.0 - dotLig, 5.0 );\n\n  // BRDF\n  vec3 brdfSpe = Fspe * D * G / ( dotView * dotLig * 4.0 );\n  vec3 brdfDif = dif * ( 1.0 - Fdif );\n\n  // shadow\n  float sh = mix( 0.6, 1.0, shadow( _isect ) );\n\n  return ( brdfSpe + brdfDif ) * lightCol * dotLig * sh;\n}\n\n// == main =====================================================================\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  Isect isect = getIsect( uv );\n\n  // if there are no normal, it's an air\n  if ( length( isect.nor ) < 0.5 ) {\n    gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  vec3 thisColorIsCool = 0.2 + 0.8 * catColor(\n    3.0 + smoothstep( -5.0, 2.0, isect.pos.z )\n  );\n\n  // material\n  vec3 col;\n  if ( isect.mtl == 1 ) {\n    col = radiance( isect, isect.props.xyz, vec3( 0.1 ), 0.2 );\n  } else if ( isect.mtl == 2 ) {\n    col = isect.props.xyz;\n  } else if ( isect.mtl == 3 ) {\n    col = radiance( isect, isect.props.xyz, vec3( 0.2 ), 0.2 );\n    col += 2.4 * thisColorIsCool * smoothstep( 0.03, 0.2, getEdge( uv ) );\n  } else if ( isect.mtl == 4 ) {\n    col = isect.props.x * thisColorIsCool;\n  }\n\n  gl_FragColor = vec4( col, 1.0 );\n}"},function(e,t,n){"use strict";n.r(t);var i=n(4),r=n(0);new i.a(15881342356);t.default=(e=>{const t=e.glCatPath,i=t.glCat,a=i.gl,o=e.automaton.auto,s=i.createVertexbuffer(new Float32Array(r.c)),l=i.createVertexbuffer((()=>{let e=new Float32Array(24);for(let t=0;t<8;t++){const n=(2*t+.5)/16;e[3*t+0]=n,e[3*t+1]=n,e[3*t+2]=n}return e})()),u=i.createVertexbuffer((()=>{let e=new Float32Array(24);for(let t=0;t<8;t++)e[3*t+0]=0,e[3*t+1]=1,e[3*t+2]=2;return e})()),c=i.createIndexbuffer((()=>{let e=new Uint16Array(126);for(let t=0;t<7;t++)for(let n=0;n<3;n++){const i=(n+1)%3;e[18*t+6*n+0]=3*t+n,e[18*t+6*n+1]=3*t+3+n,e[18*t+6*n+2]=3*t+3+i,e[18*t+6*n+3]=3*t+n,e[18*t+6*n+4]=3*t+3+i,e[18*t+6*n+5]=3*t+i}return e})()),f=i.createVertexbuffer((()=>{let e=new Float32Array(4096);for(let t=0;t<4096;t++)e[t]=(t+.5)/4096;return e})()),m=i.createTexture();i.setTextureFromArray(m,1,1,new Uint8Array([0,0,0,0])),t.add({trailsCompute:{width:16,height:4096,vert:n(3),frag:n(57),blend:[a.ONE,a.ZERO],clear:[0,0,0,0],framebuffer:!0,swapbuffer:!0,float:!0,func:(e,t)=>{i.attribute("p",s,2),i.uniform1f("trails",4096),i.uniform1f("trailLength",8),i.uniform1f("ppp",2),i.uniformTexture("samplerPcompute",e.swapbuffer.texture,0),i.uniform1f("genRate",o("trails-genRate")),i.uniform1f("noiseScale",o("trails-noiseScale")),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},trailsRender:{vert:n(58),frag:n(59),blend:[a.ONE,a.ZERO],drawbuffers:3,func:(e,n)=>{i.attribute("computeU",l,1),i.attribute("triIndex",u,1),i.attributeDivisor("computeV",f,1,1),i.uniform1f("trails",4096),i.uniform1f("trailLength",8),i.uniform1f("ppp",2),i.uniform2fv("resolutionPcompute",[16,4096]),i.uniform1i("isShadow",n.isShadow?1:0),i.uniformTexture("samplerPcompute",t.fb("trailsCompute").texture,0),i.uniformTexture("samplerShadow",n.textureShadow||m,1);let r=i.getExtension("ANGLE_instanced_arrays");a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c),r.drawElementsInstancedANGLE(a.TRIANGLES,126,a.UNSIGNED_SHORT,0,4096),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}}})})},function(e,t){e.exports="#define PARTICLE_LIFE_LENGTH 3.0\n\nuniform float trails;\nuniform float trailLength;\nuniform float ppp;\n\nuniform sampler2D samplerPcompute;\nuniform float genRate;\n\n// ------\n\nvec2 vInvert( vec2 _uv ) {\n  return vec2( 0.0, 1.0 ) + vec2( 1.0, -1.0 ) * _uv;\n}\n\n// ------\n\nvec4 random( vec2 _uv ) {\n  return texture2D( samplerRandomDynamic, _uv );\n}\n\n// ------\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / resolution;\n  vec2 puv = vec2( ( floor( gl_FragCoord.x / ppp ) * ppp + 0.5 ) / resolution.x, uv.y );\n  float mode = mod( gl_FragCoord.x, ppp );\n  vec2 dpix = vec2( 1.0 ) / resolution;\n\n  float dt = deltaTime;\n\n  // == if it is not head of particles =========================================\n  if ( ppp < gl_FragCoord.x ) {\n    puv.x -= ppp / resolution.x;\n    vec4 pos = texture2D( samplerPcompute, puv );\n    vec4 vel = texture2D( samplerPcompute, puv + dpix * vec2( 1.0, 0.0 ) );\n\n    pos.z += zOffset.y * dt;\n    pos.w = saturate( pos.w - 1.0 / trailLength );\n\n    gl_FragColor = (\n      mode < 1.0 ? pos :\n      vel\n    );\n    return;\n  }\n\n  // == prepare some vars for fuck around head particle ========================\n  vec4 seed = texture2D( samplerRandomDynamic, puv );\n  prng( seed );\n\n  vec4 pos = texture2D( samplerPcompute, puv );\n  vec4 vel = texture2D( samplerPcompute, puv + dpix * vec2( 1.0, 0.0 ) );\n\n  float timing = mix( 0.0, PARTICLE_LIFE_LENGTH, floor( puv.y * trails ) / trails );\n  timing += lofi( time, PARTICLE_LIFE_LENGTH );\n\n  if ( time - deltaTime + PARTICLE_LIFE_LENGTH < timing ) {\n    timing -= PARTICLE_LIFE_LENGTH;\n  }\n\n  // == initialize particles ===================================================\n  if (\n    time - deltaTime < timing && timing <= time\n  ) {\n    dt = time - timing;\n\n    pos.xyz = 2.0 * vec3( sin( time ), cos( time ), 0.0 );\n    pos.yz = rotate2D( -1.0 ) * pos.yz;\n    pos.xyz *= prng( seed ) < 0.5 ? 1.0 : -1.0;\n    pos.xyz += 0.5 * randomSphere( seed );\n\n    vel.xyz = 1.0 * randomSphere( seed );\n    vel.w = 1.0; // jumping flag\n\n    pos.w = prng( seed ) < genRate ? 1.0 : 0.0; // life\n  } else {\n    vel.w = 0.0; // remove jumping flag\n  }\n\n  // == update particles =======================================================\n  vel.xyz += 40.0 * vec3(\n    noise4d( vec4( 0.4 * pos.xyz, 1.845 + 0.1 * time ) ),\n    noise4d( vec4( 0.4 * pos.xyz, 2.853 + 0.1 * time ) ),\n    noise4d( vec4( 0.4 * pos.xyz, 4.129 + 0.1 * time ) )\n  ) * dt;\n  vel.xyz += 4.0 * dt * smoothstep( 3.0, 1.5, length( pos.xyz ) ) * normalize( pos.xyz );\n  vel.xyz *= exp( -5.0 * dt );\n\n  pos.xyz += vel.xyz * dt;\n  pos.w -= dt / PARTICLE_LIFE_LENGTH;\n\n  gl_FragColor = (\n    mode < 1.0 ? pos :\n    vel\n  );\n}"},function(e,t){e.exports="attribute float computeU;\nattribute float computeV;\nattribute float triIndex;\n\nvarying vec3 vPos;\nvarying vec3 vNor;\nvarying vec3 vCol;\nvarying float vLife;\nvarying float vIsOkayToDraw;\n\nuniform vec2 resolutionPcompute;\nuniform float ppp;\n\nuniform sampler2D samplerPcompute;\n\nvoid main() {\n  vec2 puv = vec2( computeU, computeV );\n  vec2 dppix = vec2( 1.0 ) / resolutionPcompute;\n\n  // == fetch texture ==========================================================\n  vec4 pos = texture2D( samplerPcompute, puv );\n  vec4 vel = texture2D( samplerPcompute, puv + dppix * vec2( 1.0, 0.0 ) );\n  vec4 velp = texture2D( samplerPcompute, puv + dppix * vec2( -ppp + 1.0, 0.0 ) );\n\n  // == assign varying variables ===============================================\n  vLife = pos.w;\n  vPos = pos.xyz;\n\n  vec4 dice = texture2D( samplerRandomStatic, puv.yy * 182.92 );\n  vCol = dice.z < 0.7 ? vec3( 0.8, 0.2 * dice.xy ) : vec3( 0.8 );\n\n  vIsOkayToDraw = ( velp.w < 0.5 && vel.w < 0.5 ) ? 1.0 : 0.0;\n\n  // == compute size and direction =============================================\n  float size = 0.003 + 0.01 * pow( dice.w, 2.0 );\n  vec3 dir = normalize( vel.xyz );\n  vec3 sid = normalize( cross( dir, vec3( 0.0, 1.0, 0.0 ) ) );\n  vec3 top = normalize( cross( sid, dir ) );\n\n  float theta = triIndex / 3.0 * TAU + vLife * 1.0;\n  vec2 tri = vec2( sin( theta ), cos( theta ) );\n  vNor = ( tri.x * sid + tri.y * top );\n  pos.xyz += size * vNor;\n\n  vec4 outPos = matP * matV * vec4( pos.xyz, 1.0 );\n  outPos.x /= resolution.x / resolution.y;\n  gl_Position = outPos;\n}"},function(e,t){e.exports="#extension GL_EXT_draw_buffers : require\n\nvarying vec3 vPos;\nvarying vec3 vNor;\nvarying vec3 vCol;\nvarying float vLife;\nvarying float vIsOkayToDraw;\n\nuniform bool isShadow;\n\nvoid main() {\n  if ( vIsOkayToDraw < 0.5 ) { discard; }\n  if ( vLife <= 0.0 ) { discard; }\n\n  if ( isShadow ) {\n    gl_FragData[ 0 ] = vec4( calcDepthL( vPos - lightPos ), 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  vec3 col = 4.0 * vCol;\n\n  gl_FragData[ 0 ] = vec4( vPos, 1.0 );\n  gl_FragData[ 1 ] = vec4( vNor, 1.0 );\n  gl_FragData[ 2 ] = vec4( col, 1.0 );\n}"},function(e,t,n){"use strict";n.r(t);var i=n(1);n(0);t.default=(e=>{const t=e.glCatPath,r=t.glCat,a=r.gl,o=(e.automaton.auto,r.createVertexbuffer(new Float32Array([-4.5,2.5,0,-3.5,1.5,0,4.5,2.5,0,3.5,1.5,0,4.5,-2.5,0,3.5,-1.5,0,-4.5,-2.5,0,-3.5,-1.5,0,-4.5,2.5,0,-3.5,1.5,0]))),s=r.createVertexbuffer(new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])),l=r.createTexture();t.add({ui:{vert:n(61),frag:n(62),blend:[a.ONE,a.ZERO],drawbuffers:3,depthTest:!1,depthWrite:!1,func:(e,t)=>{r.attribute("aPos",o,3),r.attribute("aNor",s,3),r.uniform1i("isShadow",t.isShadow),r.uniform4fv("color",[.2,.3,.4,3]),r.setTextureFromFloatArray(l,2048,1,t.analyserData,a.LUMINANCE),r.uniformTexture("samplerLv",l,0);let n=i.a.mat4Identity();r.uniformMatrix4fv("matM",n),a.drawArrays(a.TRIANGLE_STRIP,0,10)}}})})},function(e,t){e.exports="// == attributes ===============================================================\nattribute vec3 aPos;\nattribute vec3 aNor;\n\n// == varyings =================================================================\nvarying vec3 vPos;\nvarying vec3 vRawPos;\nvarying vec3 vNor;\n\n// == uniforms =================================================================\nuniform bool isShadow;\nuniform mat4 matM;\n\n// == main =====================================================================\nvoid main() {\n  vRawPos = aPos;\n  vec4 pos = matM * vec4( aPos, 1.0 );\n  vPos = pos.xyz;\n\n  vec4 nor = normalize( matM * vec4( aNor, 0.0 ) );\n  vNor = nor.xyz;\n\n  vec4 outPos;\n  if ( isShadow ) {\n    outPos = matPL * matVL * pos;\n  } else {\n    outPos = matP * matV * pos;\n    outPos.x /= resolution.x / resolution.y;\n  }\n  gl_Position = outPos;\n}"},function(e,t){e.exports="// == shit =====================================================================\n#extension GL_EXT_draw_buffers : require\n\n// == varyings =================================================================\nvarying vec3 vPos;\nvarying vec3 vRawPos;\nvarying vec3 vNor;\n\n// == uniforms =================================================================\nuniform bool isShadow;\n\nuniform vec4 color;\n\nuniform sampler2D samplerLv;\n\n// == main =====================================================================\nvoid main() {\n  if ( isShadow ) {\n    gl_FragData[ 0 ] = vec4( calcDepthL( vPos - lightPos ), 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  calcRhythms();\n\n  bool b = 4.47 < abs( vRawPos.x ) || 2.47 < abs( vRawPos.y );\n\n  vec2 circ = vRawPos.xy - vec2( 3.8, -2.1 );\n  circ = rotate2D( zOffset.x ) * circ;\n  b = b || (\n    length( circ ) < 0.25 &&\n    0.2 < length( circ ) &&\n    0.03 < abs( circ.y )\n  ) || length( circ ) < 0.15;\n\n  vec4 rectLv = vec4( 3.5, -1.7, 4.1, 2.4 );\n\n  float lvuv = 0.01 + 0.4 * linearstep( rectLv.y, rectLv.w, lofi( vRawPos.y, 0.1 ) );\n  float lv = 0.1 + 0.9 * linearstep( -90.0, -30.0, texture2D( samplerLv, vec2( lvuv, 0.5 ) ).x );\n  b = b || (\n    inRange( rectLv.y, rectLv.w, vRawPos.y ) &&\n    inRange( mix( rectLv.z, rectLv.x, lv ), rectLv.z, vRawPos.x ) &&\n    abs( mod( vRawPos.y, 0.1 ) - 0.05 ) < 0.03\n  );\n\n  b = b || (\n    abs( abs( vRawPos.x ) - 4.3 ) < 0.1 &&\n    abs( vRawPos.y ) < 2.4 &&\n    mod( vRawPos.x + vRawPos.y + 0.4 * sign( vRawPos.x ) * time, 0.2 ) < 0.15\n  );\n\n  vec2 vRawPosYAbs = vec2( vRawPos.x, abs( vRawPos.y ) );\n\n  b = b || (\n    length( vRawPosYAbs.xy - vec2( 0.0, 2.3 ) ) < 0.05 * smoothstep( 0.2, 0.0, clavTime )\n  );\n\n  b = b || (\n    length( vRawPosYAbs.xy - vec2( -0.2, 2.3 ) ) < 0.05 * smoothstep( 0.2, 0.0, rimshotTime.x )\n  );\n\n  b = b || (\n    length( vRawPosYAbs.xy - vec2( 0.2, 2.3 ) ) < 0.05 * smoothstep( 0.2, 0.0, rimshotTime.y )\n  );\n\n  b = b || (\n    inRange( 2.40, 2.41, vRawPosYAbs.y ) &&\n    abs( vRawPosYAbs.x ) < 0.3 + 0.3 * exp( -0.1 * hihatOpen * hihatTime )\n  );\n\n  if ( !b ) { discard; }\n\n  gl_FragData[ 0 ] = vec4( vPos, 1.0 );\n  gl_FragData[ 1 ] = vec4( vNor, 1.0 );\n  gl_FragData[ 2 ] = vec4( 0.7, 0.9, 1.1, 2.0 );\n}"},function(e,t,n){"use strict";n.r(t);var i=n(1),r=n(0);t.default=(e=>{const t=e.glCatPath,a=t.glCat,o=a.gl,s=e.automaton.auto,l=a.createVertexbuffer(new Float32Array(r.d)),u=a.createVertexbuffer(new Float32Array(r.e)),c=(a.createVertexbuffer(new Float32Array(r.f)),r.b(75,75).map((e,t)=>.4*e-14.8)),f=a.createVertexbuffer(new Float32Array(c));t.add({veryPlane:{vert:n(64),frag:n(65),blend:[o.ONE,o.ZERO],cull:!1,drawbuffers:3,func:(e,t)=>{a.attribute("aPos",l,3),a.attribute("aNor",u,3),a.attributeDivisor("aMatrix",f,2,1),a.uniform1i("isShadow",t.isShadow),a.uniform1f("flipThreshold",s("veryPlane-flipThreshold")),a.uniform4fv("color",[.2,.3,.4,3]);let n=i.a.mat4Apply(i.a.mat4Translate([0,-5,0]),i.a.mat4RotateX(Math.PI/2),i.a.mat4Identity());a.uniformMatrix4fv("matM",n),a.getExtension("ANGLE_instanced_arrays").drawArraysInstancedANGLE(o.TRIANGLE_STRIP,0,4,c.length/2)}}})})},function(e,t){e.exports="// == attributes ===============================================================\nattribute vec3 aPos;\nattribute vec3 aNor;\nattribute vec2 aMatrix;\n\n// == varyings =================================================================\nvarying vec3 vPos;\nvarying vec3 vNor;\nvarying float vFlip;\n\n// == nani =====================================================================\nuniform bool isShadow;\nuniform float flipThreshold;\n\nuniform mat4 matM;\n\n// == main =====================================================================\nvoid main() {\n  vec4 pos = vec4( 0.4 * aPos, 1.0 );\n  float t = mod( time - 1.0 beat, 2.0 beat );\n  float aaaa = random4( 0.179 * aMatrix + 0.188 * ( time - t ) ).x;\n\n  float flip = PI * smoothstep( 1.0, 0.1, exp( -5.0 * t ) );\n  pos.zx = rotate2D(\n    aaaa < flipThreshold * 0.25 ? flip :\n    aaaa < flipThreshold * 0.5 ? -flip :\n    0.0\n  ) * pos.zx;\n  pos.yz = rotate2D(\n    aaaa < flipThreshold * 0.5 ? 0.0 :\n    aaaa < flipThreshold * 0.75 ? flip :\n    aaaa < flipThreshold ? -flip :\n    0.0\n  ) * pos.yz;\n  vFlip = sin( aaaa < flipThreshold ? sin( flip ) : 0.0 );\n\n  pos.x += 2.0 * aMatrix.x;\n  pos.y += mod( 2.0 * aMatrix.y - zOffset.x, 60.0 ) - 20.0;\n  pos = matM * pos;\n\n  float bbbb = random4( 0.179 * aMatrix ).x;\n  pos.y += 1.0 * noise4d( vec4( 0.1 * pos.zx, 0.1 * time, 6.724 ) );\n  vPos = pos.xyz;\n\n  vec4 nor = vec4( aNor, 0.0 );\n  nor = normalize( matM * nor );\n  vNor = nor.xyz;\n\n  vec4 outPos;\n  if ( isShadow ) {\n    outPos = matPL * matVL * pos;\n  } else {\n    outPos = matP * matV * pos;\n    outPos.x /= resolution.x / resolution.y;\n  }\n  gl_Position = outPos;\n}"},function(e,t){e.exports="// == shit =====================================================================\n#extension GL_EXT_draw_buffers : require\n\n// == varyings =================================================================\nvarying vec3 vPos;\nvarying vec3 vNor;\nvarying float vFlip;\n\n// == uniforms =================================================================\nuniform bool isShadow;\n\n// == main =====================================================================\nvoid main() {\n  if ( isShadow ) {\n    gl_FragData[ 0 ] = vec4( calcDepthL( vPos - lightPos ), 0.0, 0.0, 1.0 );\n    return;\n  }\n\n  vec4 col = vec4( mix(\n    vec3( 0.2, 0.3, 0.4 ),\n    vec3( 0.7, 1.8, 1.2 ),\n    sin( vFlip )\n  ), 1.0 );\n\n  gl_FragData[ 0 ] = vec4( vPos, 1.0 );\n  gl_FragData[ 1 ] = vec4( vNor, 1.0 );\n  gl_FragData[ 2 ] = col;\n}"},function(e){e.exports={v:"2.0.4",length:150,resolution:60,params:{"camera-rotY":{nodes:[{time:0,value:0,out:{time:0,value:0}},{time:150,value:0,in:{time:-.5,value:0}}],fxs:[{time:90,length:60,row:0,def:"sine",params:{amp:.1,freq:7,phase:0}}]},"camera-rotX":{nodes:[{time:0,value:0,out:{time:0,value:0}},{time:84,value:0,in:{time:0,value:0},out:{time:5.90382835235873,value:0}},{time:90,value:.1,in:{time:-.48103919876365353,value:0},out:{time:0,value:0}},{time:150,value:.1,in:{time:0,value:0}}],fxs:[{time:90,length:60,row:0,def:"sine",params:{amp:.05,freq:10,phase:0}}]},"post-barrelAmp":{nodes:[{time:0,value:.05,out:{time:0,value:0}},{time:84,value:.05,in:{time:0,value:0},out:{time:5.681300833335072,value:0}},{time:89.82183951568419,value:.36,in:{time:-.13581911075600317,value:0},out:{time:.11926543397217415,value:0}},{time:90.375,value:.05,in:{time:-.5331073535676296,value:0},out:{time:0,value:0}},{time:150,value:.05,in:{time:0,value:0}}],fxs:[]},"post-barrelOffset":{nodes:[{time:0,value:0,out:{time:0,value:0}},{time:150,value:0,in:{time:0,value:0}}],fxs:[]},"camera-Radius":{nodes:[{time:0,value:3,out:{time:0,value:0}},{time:138,value:3,in:{time:0,value:0},out:{time:5.18,value:0}},{time:150,value:7.1000000000000005,in:{time:0,value:0}}],fxs:[]},"dof-amp":{nodes:[{time:0,value:1,out:{time:0,value:0}},{time:150,value:1,in:{time:0,value:0}}],fxs:[]},"dof-focus":{nodes:[{time:0,value:2.5,out:{time:0,value:0}},{time:138,value:2.5,in:{time:0,value:0},out:{time:7.913834203708461,value:0}},{time:150,value:0,in:{time:-4.233974890918859,value:0}}],fxs:[]},"particles-noisePhase":{nodes:[{time:0,value:0,out:{time:0,value:0}},{time:150,value:0,in:{time:0,value:0}}],fxs:[]},"particles-genRate":{nodes:[{time:0,value:0,out:{time:0,value:0}},{time:60,value:0,in:{time:0,value:0},out:{time:0,value:0}},{time:90,value:1,in:{time:0,value:0},out:{time:0,value:0}},{time:150,value:1,in:{time:0,value:0}}],fxs:[]},"particles-colorVar":{nodes:[{time:0,value:0,out:{time:0,value:0}},{time:150,value:0,in:{time:0,value:0}}],fxs:[]},"particles-colorOffset":{nodes:[{time:0,value:0,out:{time:0,value:0}},{time:150,value:0,in:{time:0,value:0}}],fxs:[]},"box-posOffset":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:84,value:0,in:{time:0,value:0},out:{time:.5,value:0}},{time:90,value:.2,in:{time:-.5,value:0},out:{time:0,value:0}},{time:150,value:.2,in:{time:0,value:0}}],fxs:[]},"box-spinOffset":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:84,value:0,in:{time:0,value:0},out:{time:.5,value:0}},{time:90,value:.5,in:{time:-.5,value:0},out:{time:0,value:0}},{time:150,value:.5,in:{time:0,value:0}}],fxs:[]},"log-offsetX":{nodes:[{time:0,value:-4.1000000000000005,out:{time:.5,value:0}},{time:150,value:-4.1000000000000005,in:{time:0,value:0}}],fxs:[]},"log-offsetY":{nodes:[{time:0,value:-2.35,out:{time:.5,value:0}},{time:150,value:-2.35,in:{time:-.5,value:0}}],fxs:[]},"log-offsetZ":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:150,value:0,in:{time:-.5,value:0}}],fxs:[]},"camera-fov":{nodes:[{time:0,value:1,out:{time:.5,value:0}},{time:84,value:1,in:{time:-.5,value:0},out:{time:5.499210388713067,value:0}},{time:89.78873216211655,value:1.96,in:{time:-.15237278753981798,value:0},out:{time:.15237278753981798,value:0}},{time:90.375,value:1,in:{time:-.5,value:0},out:{time:0,value:0}},{time:150,value:1,in:{time:-.5,value:0}}],fxs:[]},dzOffset:{nodes:[{time:0,value:1,out:{time:.5,value:0}},{time:84,value:1,in:{time:0,value:0},out:{time:4.501818881948054,value:0}},{time:89.80433128247881,value:20,in:{time:-.5,value:0},out:{time:.2141557941465635,value:0}},{time:90.63765245921151,value:4,in:{time:-.7858442058534365,value:0},out:{time:0,value:0}},{time:150,value:4,in:{time:-.5,value:0}}],fxs:[]},"raymarch-ifsParamsX":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:84,value:.7000000000000001,in:{time:0,value:0},out:{time:4.9658162056481245,value:0}},{time:90,value:1,in:{time:-.5,value:0},out:{time:0,value:0}},{time:150,value:1,in:{time:-.5,value:0}}],fxs:[]},"raymarch-ifsParamsY":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:84,value:0,in:{time:-.5,value:0},out:{time:5.021638908218719,value:0}},{time:90,value:1,in:{time:-1.0582270257060173,value:0},out:{time:0,value:0}},{time:150,value:1,in:{time:-.5,value:0}}],fxs:[]},"raymarch-ifsParamsZ":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:150,value:0,in:{time:-.5,value:0}}],fxs:[]},"raymarch-ifsParamsW":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:150,value:0,in:{time:-.5,value:0}}],fxs:[]},"trails-genRate":{nodes:[{time:0,value:0,out:{time:0,value:0}},{time:30,value:0,in:{time:0,value:0},out:{time:0,value:0}},{time:30,value:1,in:{time:0,value:0},out:{time:0,value:0}},{time:54,value:1,in:{time:0,value:0},out:{time:0,value:0}},{time:60,value:0,in:{time:0,value:0},out:{time:0,value:0}},{time:150,value:0,in:{time:0,value:0}}],fxs:[]},"trails-noiseScale":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:150,value:0,in:{time:-.5,value:0}}],fxs:[]},"box-size":{nodes:[{time:0,value:.5,out:{time:0,value:0}},{time:84,value:.5,in:{time:0,value:0},out:{time:1.906411162149766,value:0}},{time:90,value:.30000000000000004,in:{time:-2.5946549223507276,value:0},out:{time:0,value:0}},{time:150,value:.30000000000000004,in:{time:0,value:0}}],fxs:[]},"circle-availZ":{nodes:[{time:0,value:10,out:{time:0,value:0}},{time:77.625,value:9.9,in:{time:0,value:0},out:{time:0,value:0}},{time:79.125,value:-20,in:{time:0,value:0},out:{time:0,value:0}},{time:150,value:-20,in:{time:-.5,value:0}}],fxs:[]},"veryPlane-flipThreshold":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:29.625,value:0,in:{time:0,value:0},out:{time:0,value:0}},{time:29.625,value:.30000000000000004,in:{time:0,value:0},out:{time:0,value:0}},{time:51,value:.30000000000000004,in:{time:0,value:0},out:{time:0,value:0}},{time:51,value:0,in:{time:0,value:0},out:{time:0,value:0}},{time:150,value:0,in:{time:0,value:0}}],fxs:[]},"glitch-amp":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:87.75,value:0,in:{time:0,value:0},out:{time:0,value:0}},{time:87.75,value:.01712662045790897,in:{time:0,value:0},out:{time:0,value:0}},{time:87.93634314694167,value:.01709630631347539,in:{time:0,value:0},out:{time:0,value:0}},{time:87.93634314694167,value:0,in:{time:0,value:0},out:{time:0,value:0}},{time:88.30578380323469,value:0,in:{time:-.5,value:0},out:{time:0,value:0}},{time:88.5,value:.017778558888035506,in:{time:-.5,value:0},out:{time:0,value:0}},{time:88.5,value:0,in:{time:0,value:0},out:{time:0,value:0}},{time:88.67645929948311,value:0,in:{time:0,value:0},out:{time:.8831802607859061,value:.0016742114391677665}},{time:89.795,value:.012529013071470606,in:{time:0,value:0},out:{time:0,value:0}},{time:90.16,value:0,in:{time:-.34742630715584255,value:0},out:{time:0,value:0}},{time:150,value:0,in:{time:-.5,value:0}}],fxs:[]},"glitch-fadeout":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:89.82596046836848,value:0,in:{time:0,value:0},out:{time:0,value:0}},{time:89.82596046836848,value:1,in:{time:0,value:0},out:{time:0,value:0}},{time:89.87576725816758,value:1,in:{time:0,value:0},out:{time:.10208270396090313,value:0}},{time:90.13074425441285,value:0,in:{time:-.24965033763372446,value:0},out:{time:0,value:0}},{time:142.5,value:0,in:{time:0,value:0},out:{time:1.841742447483199,value:0}},{time:150,value:1,in:{time:-2.78908745441052,value:0}}],fxs:[]},"patterns-noisePhase":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:150,value:0,in:{time:-.5,value:0}}],fxs:[]},"patterns-genRate":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:114,value:0,in:{time:0,value:0},out:{time:0,value:0}},{time:120,value:1,in:{time:0,value:0},out:{time:0,value:0}},{time:150,value:1,in:{time:-.5,value:0}}],fxs:[]},"racer-genRate":{nodes:[{time:0,value:0,out:{time:.5,value:0}},{time:60,value:0,in:{time:0,value:0},out:{time:28.0991821945506,value:0}},{time:90,value:1,in:{time:-6.377240086626983,value:0},out:{time:0,value:0}},{time:150,value:1,in:{time:-.5,value:0}}],fxs:[]}},guiSettings:{snapActive:!0,snapTime:.375,snapValue:.1}}},function(e,t,n){"use strict";n.r(t);var i=n(6);class r{constructor(e){this.session=e,this.isReady=!1,this.session.addEventListener("end",()=>{this.destroy()})}async setup(e){this.session.baseLayer=new window.XRWebGLLayer(this.session,e),this.frameOfReference=await this.session.requestFrameOfReference("eye-level"),this.isReady=!0,this.session.requestAnimationFrame((e,t)=>this.handleFrame(e,t))}handleFrame(e,t){if(!this.isReady)return;const n=t.getDevicePose(this.frameOfReference);t.views.forEach((e,i)=>{const r=e.projectionMatrix,a=n.getViewMatrix(e),o=this.session.baseLayer.getViewport(e),s=[o.x,o.y,o.width,o.height];this.onFrame&&this.onFrame({iView:i,nView:t.views.length,viewMatrix:a,projectionMatrix:r,viewport:s})}),this.session.requestAnimationFrame((e,t)=>this.handleFrame(e,t))}destroy(){this.session=null,this.frameOfReference=null,this.isReady=!1}}var a=n(7),o=n.n(a),s=n(1),l=n(0);const u=class{constructor(e){this.audio=new AudioContext,this.sampleRate=this.audio.sampleRate,this.bufferSize=2048,this.processor=this.audio.createScriptProcessor(this.bufferSize,2,2),this.processor.onaudioprocess=(e=>this.onprocess(e)),this.bufferPoolSize=2048,this.bufferPoolIndex=0,this.bufferPool=new Float32Array(4*this.bufferSize*this.bufferPoolSize),this.analyserData=new Float32Array(2048),this.analyser=this.audio.createAnalyser(),this.analyser.fftSize=2048,this.processor.connect(this.audio.destination),this.processor.connect(this.analyser),this.isPlaying=!1,this.currentTime=0,this.currentTimeDate=Date.now();const t=this.glCatPath=e.glCatPath,i=this.glCat=t.glCat,r=this.gl=i.gl,a=i.createVertexbuffer(new Float32Array(l.c)),o=i.createTexture();i.setTextureFromFloatArray(o,8,4,[0,5,10,12,7,19,17,22,0,7,4,14,11,19,16,26,0,2,5,12,7,14,10,22,0,7,4,19,11,26,16,31],r.LUMINANCE),i.textureWrap(o,r.REPEAT),t.add({audio:{width:this.bufferSize,height:this.bufferPoolSize,vert:n(3),frag:n(10),blend:[r.ONE,r.ZERO],clear:[0,0,0,0],framebuffer:!0,float:!0,func:(e,t)=>{i.attribute("p",a,2),i.uniform1f("timeHead",t.time%6),i.uniform1f("patternHead",Math.floor(t.time/6)),i.uniform1f("bufferSize",this.bufferSize),i.uniform1f("sampleRate",this.sampleRate),i.uniformTexture("samplerChord",o,0),r.drawArrays(r.TRIANGLE_STRIP,0,4)}}})}play(){this.audio.resume&&this.audio.resume(),this.isPlaying=!0,this.currentTimeDate=Date.now(),this.processor.connect(this.audio.destination),this.processor.connect(this.analyser)}pause(){this.isPlaying=!1,this.processor.disconnect(this.audio.destination),this.processor.disconnect(this.analyser)}setTime(e){this.currentTime=e,this.currentTimeDate=Date.now(),this.bufferPoolIndex=0}getTime(){let e=this.currentTime;return this.isPlaying&&(e+=(Date.now()-this.currentTimeDate)/1e3),e}getAnalyserData(){return this.analyser.getFloatFrequencyData(this.analyserData),this.analyserData}onprocess(e){const t=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1),i=this.glCatPath,r=this.gl;this.currentTime+=this.bufferSize/this.sampleRate,this.currentTimeDate=Date.now(),0===this.bufferPoolIndex&&(i.renderOutsideOfPipeline("audio",{time:this.currentTime}),r.readPixels(0,0,this.bufferSize,this.bufferPoolSize,r.RGBA,r.FLOAT,this.bufferPool));for(let e=0;e<this.bufferSize;e++)t[e]=this.bufferPool[this.bufferPoolIndex+4*e],n[e]=this.bufferPool[this.bufferPoolIndex+4*e+1];this.bufferPoolIndex=(this.bufferPoolIndex+4*this.bufferSize)%(4*this.bufferSize*this.bufferPoolSize)}};var c=n(4);var f=class{constructor(e){this.gl=e;const t=this.gl;t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.__extensions={},this.__currentProgram=null}getExtension(e,t){const n=this.gl;if("object"==typeof e&&e.isArray())return e.every(e=>this.getExtension(e,t));if("string"==typeof e){if(this.__extensions[e])return this.__extensions[e];if(this.__extensions[e]=n.getExtension(e),this.__extensions[e])return this.__extensions[e];if(t)throw new Error('The extension "'+e+'" is not supported');return null}throw new Error("GLCat.getExtension: _name must be string or array")}createProgram(e,t,n){const i=this.gl;let r;r="function"==typeof n?n:e=>{throw new Error(e)};const a=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(a,e),i.compileShader(a),!i.getShaderParameter(a,i.COMPILE_STATUS))return r(i.getShaderInfoLog(a)),i.deleteShader(a),null;const o=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(o,t),i.compileShader(o),!i.getShaderParameter(o,i.COMPILE_STATUS))return r(i.getShaderInfoLog(o)),i.deleteShader(a),i.deleteShader(o),null;const s=i.createProgram();return i.attachShader(s,a),i.attachShader(s,o),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)?{vert:a,frag:o,program:s,locations:{}}:(r(i.getProgramInfoLog(s)),i.deleteShader(a),i.deleteShader(o),i.deleteProgram(s),null)}useProgram(e){this.gl.useProgram(e.program),this.__currentProgram=e}createVertexbuffer(e){const t=this.gl.createBuffer();return e&&this.setVertexbuffer(t,e),t}setVertexbuffer(e,t,n){const i=this.gl,r=n||i.STATIC_DRAW;i.bindBuffer(i.ARRAY_BUFFER,e),i.bufferData(i.ARRAY_BUFFER,t,r),i.bindBuffer(i.ARRAY_BUFFER,null)}createIndexbuffer(e){const t=this.gl.createBuffer();return e&&this.setIndexbuffer(t,e),t}setIndexbuffer(e,t,n){const i=this.gl,r=n||i.STATIC_DRAW;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t,r),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null)}getAttribLocation(e){const t=this.gl;let n;return this.__currentProgram.locations[e]?n=this.__currentProgram.locations[e]:(n=t.getAttribLocation(this.__currentProgram.program,e),this.__currentProgram.locations[e]=n),n}attribute(e,t,n,i,r,a){const o=this.gl,s=this.getAttribLocation(e);if(-1===s)return;o.bindBuffer(o.ARRAY_BUFFER,t),o.enableVertexAttribArray(s),o.vertexAttribPointer(s,n,i||o.FLOAT,!1,r||0,a||0);const l=this.getExtension("ANGLE_instanced_arrays");l&&l.vertexAttribDivisorANGLE(s,0),o.bindBuffer(o.ARRAY_BUFFER,null)}attributeDivisor(e,t,n,i,r,a,o){const s=this.gl;this.getExtension("ANGLE_instanced_arrays",!0);const l=this.getAttribLocation(e);if(-1===l)return;s.bindBuffer(s.ARRAY_BUFFER,t),s.enableVertexAttribArray(l),s.vertexAttribPointer(l,n,r||s.FLOAT,!1,a||0,o||0);const u=this.getExtension("ANGLE_instanced_arrays");u&&u.vertexAttribDivisorANGLE(l,i),s.bindBuffer(s.ARRAY_BUFFER,null)}getUniformLocation(e){const t=this.gl;let n;return void 0!==this.__currentProgram.locations[e]?n=this.__currentProgram.locations[e]:(n=t.getUniformLocation(this.__currentProgram.program,e),this.__currentProgram.locations[e]=n),n}uniform(e,t,n){const i=this.gl,r=this.getUniformLocation(t);i["uniform"+e](r,n)}uniform1i(e,t){const n=this.gl,i=this.getUniformLocation(e);n.uniform1i(i,t)}uniform1f(e,t){const n=this.gl,i=this.getUniformLocation(e);n.uniform1f(i,t)}uniform2fv(e,t){const n=this.gl,i=this.getUniformLocation(e);n.uniform2fv(i,t)}uniform3fv(e,t){const n=this.gl,i=this.getUniformLocation(e);n.uniform3fv(i,t)}uniform4fv(e,t){const n=this.gl,i=this.getUniformLocation(e);n.uniform4fv(i,t)}uniformMatrix4fv(e,t,n){const i=this.gl,r=this.getUniformLocation(e);i.uniformMatrix4fv(r,n||!1,t)}uniformTexture(e,t,n){const i=this.gl,r=this.getUniformLocation(e);i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,t),i.uniform1i(r,n)}uniformCubemap(e,t,n){const i=this.gl,r=this.getUniformLocation(e);i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_CUBE_MAP,t),i.uniform1i(r,n)}createTexture(){const e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}textureFilter(e,t){const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,t),n.bindTexture(n.TEXTURE_2D,null)}textureWrap(e,t){const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),n.bindTexture(n.TEXTURE_2D,null)}setTexture(e,t){const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),n.bindTexture(n.TEXTURE_2D,null)}setTextureFromArray(e,t,n,i,r){const a=this.gl;a.bindTexture(a.TEXTURE_2D,e),a.texImage2D(a.TEXTURE_2D,0,r||a.RGBA,t,n,0,r||a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(i)),a.bindTexture(a.TEXTURE_2D,null)}setTextureFromFloatArray(e,t,n,i,r){const a=this.gl;this.getExtension("OES_texture_float",!0),a.bindTexture(a.TEXTURE_2D,e),a.texImage2D(a.TEXTURE_2D,0,r||a.RGBA,t,n,0,r||a.RGBA,a.FLOAT,new Float32Array(i)),this.getExtension("OES_texture_float_linear")||this.textureFilter(e,a.NEAREST),a.bindTexture(a.TEXTURE_2D,null)}copyTexture(e,t,n){const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,t,n,0),i.bindTexture(i.TEXTURE_2D,null)}createCubemap(e){const t=this.gl,n=t.createTexture();t.bindTexture(t.TEXTURE_CUBE_MAP,n);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e[n]);return t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_CUBE_MAP,null),n}createFramebuffer(e,t){const n=this.gl,i={};return i.framebuffer=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,i.framebuffer),i.depth=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,i.depth),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,i.depth),i.texture=this.createTexture(),n.bindTexture(n.TEXTURE_2D,i.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindTexture(n.TEXTURE_2D,null),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,i.texture,0),n.bindFramebuffer(n.FRAMEBUFFER,null),i}resizeFramebuffer(e,t,n){let i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e.framebuffer),i.bindRenderbuffer(i.RENDERBUFFER,e.depth),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,n),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindTexture(i.TEXTURE_2D,e.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,n,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null)}createFloatFramebuffer(e,t){let n=this,i=n.gl;n.getExtension("OES_texture_float",!0);let r={};return r.framebuffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,r.framebuffer),r.depth=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,r.depth),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,t),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,r.depth),r.texture=n.createTexture(),i.bindTexture(i.TEXTURE_2D,r.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.FLOAT,null),n.getExtension("OES_texture_float_linear")||n.textureFilter(r.texture,i.NEAREST),i.bindTexture(i.TEXTURE_2D,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,r.texture,0),i.bindFramebuffer(i.FRAMEBUFFER,null),r}resizeFloatFramebuffer(e,t,n){let i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e.framebuffer),i.bindRenderbuffer(i.RENDERBUFFER,e.depth),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,n),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindTexture(i.TEXTURE_2D,e.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,n,0,i.RGBA,i.FLOAT,null),i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null)}createDrawBuffers(e,t,n){let i=this,r=i.gl;i.getExtension("OES_texture_float",!0);let a=i.getExtension("WEBGL_draw_buffers",!0);if(a.MAX_DRAW_BUFFERS_WEBGL<n)throw"createDrawBuffers: MAX_DRAW_BUFFERS_WEBGL is "+a.MAX_DRAW_BUFFERS_WEBGL;let o={};o.framebuffer=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,o.framebuffer),o.depth=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,o.depth),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e,t),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,o.depth),o.textures=[];for(let s=0;s<n;s++)o.textures[s]=i.createTexture(),r.bindTexture(r.TEXTURE_2D,o.textures[s]),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.FLOAT,null),i.getExtension("OES_texture_float_linear")||i.textureFilter(o.textures[s],r.NEAREST),r.bindTexture(r.TEXTURE_2D,null),r.framebufferTexture2D(r.FRAMEBUFFER,a.COLOR_ATTACHMENT0_WEBGL+s,r.TEXTURE_2D,o.textures[s],0);let s=r.checkFramebufferStatus(r.FRAMEBUFFER);if(s!==r.FRAMEBUFFER_COMPLETE)throw"createDrawBuffers: gl.checkFramebufferStatus( gl.FRAMEBUFFER ) returns "+s;return r.bindFramebuffer(r.FRAMEBUFFER,null),o}resizeDrawBuffers(e,t,n){let i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e.framebuffer),i.bindRenderbuffer(i.RENDERBUFFER,e.depth),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,n),i.bindRenderbuffer(i.RENDERBUFFER,null);for(let r=0;r<e.textures.length;r++)i.bindTexture(i.TEXTURE_2D,e.textures[r]),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,n,0,i.RGBA,i.FLOAT,null),i.bindTexture(i.TEXTURE_2D,null);i.bindFramebuffer(i.FRAMEBUFFER,null)}drawBuffers(e){this.gl;let t=this.getExtension("WEBGL_draw_buffers",!0),n=[];if("number"==typeof e)for(let i=0;i<e;i++)n.push(t.COLOR_ATTACHMENT0_WEBGL+i);else n=n.concat(e);t.drawBuffersWEBGL(n)}clear(e,t,n,i,r){let a=this.gl,o=e||0,s=t||0,l=n||0,u="number"==typeof i?i:1,c="number"==typeof r?r:1;a.clearColor(o,s,l,u),a.clearDepth(c),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)}};let m=(e,t,n)=>{n.map(n=>{if(void 0===e[n])throw"GLCat-Path: "+n+" is required for "+t})},h=class{constructor(e,t){let n=this;n.glCat=e,n.gl=e.gl,n.paths={},n.commonShader="",n.globalFunc=(()=>{}),n.params=t||{}}add(e){let t=this;for(let n in e){let i=e[n];m(i,"path object",["vert","frag"]),t.paths[n]=i,void 0===i.depthTest&&(i.depthTest=!0),void 0===i.depthWrite&&(i.depthWrite=!0),void 0===i.blend&&(i.blend=[t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA]),void 0===i.cull&&(i.cull=!0),i.width&&i.height&&t.setupFramebuffer(n,i.width,i.height),i.program=t.glCat.createProgram(t.commonShader+i.vert,t.commonShader+i.frag)}}render(e,t){let n=this,i=n.paths[e];if(!i)throw"GLCat-Path: The path called "+e+" is not defined!";if(t||(t={}),void 0!==t.enable&&!t.enable&&i.isInitialized)return;i.isInitialized=!0,t.width&&t.height&&n.setupFramebuffer(e,t.width,t.height),t.framebuffer=void 0!==t.target?t.target.framebuffer:i.framebuffer?i.framebuffer.framebuffer:null;let r=t.viewport?t.viewport[2]:t.width||i.width,a=t.viewport?t.viewport[3]:t.height||i.height;if(!r||!a)throw"GLCat-Path: width or height is invalid";if(t.viewport?n.gl.viewport(...t.viewport):n.gl.viewport(0,0,r,a),n.glCat.useProgram(i.program),i.cull?n.gl.enable(n.gl.CULL_FACE):n.gl.disable(n.gl.CULL_FACE),n.gl.bindFramebuffer(n.gl.FRAMEBUFFER,t.framebuffer),n.params.drawbuffers&&n.glCat.drawBuffers(i.drawbuffers?i.drawbuffers:null===t.framebuffer?[n.gl.BACK]:[n.gl.COLOR_ATTACHMENT0]),n.gl.blendFunc(...i.blend),i.clear&&n.glCat.clear(...i.clear),i.depthTest?n.gl.enable(n.gl.DEPTH_TEST):n.gl.disable(n.gl.DEPTH_TEST),i.depthWrite?n.gl.depthMask(!0):n.gl.depthMask(!1),n.glCat.uniform2fv("resolution",[r,a]),n.globalFunc(i,t),i.func&&i.func(i,t),i.swapbuffer){const e=i.framebuffer;i.framebuffer=i.swapbuffer,i.swapbuffer=e}}setupFramebuffer(e,t,n){let i=this,r=i.paths[e];if(!r)throw"GLCat-Path: The path called "+e+" is not defined!";if(r.framebuffer){if(!0===r.framebuffer)r.drawbuffers?r.framebuffer=i.glCat.createDrawBuffers(t,n,r.drawbuffers):r.float?r.framebuffer=i.glCat.createFloatFramebuffer(t,n):r.framebuffer=i.glCat.createFramebuffer(t,n),r.swapbuffer&&(r.drawbuffers?r.swapbuffer=i.glCat.createDrawBuffers(t,n,r.drawbuffers):r.float?r.swapbuffer=i.glCat.createFloatFramebuffer(t,n):r.swapbuffer=i.glCat.createFramebuffer(t,n));else{if(r.width===t&&r.height===n)return;r.drawbuffers?i.glCat.resizeDrawBuffers(r.framebuffer,t,n):r.float?i.glCat.resizeFloatFramebuffer(r.framebuffer,t,n):i.glCat.resizeFramebuffer(r.framebuffer,t,n),r.swapbuffer&&(r.drawbuffers?i.glCat.resizeDrawBuffers(r.swapbuffer,t,n):r.float?i.glCat.resizeFloatFramebuffer(r.swapbuffer,t,n):i.glCat.resizeFramebuffer(r.swapbuffer,t,n))}r.filter&&i.glCat.textureFilter(r.framebuffer.texture,r.filter),r.wrap&&i.glCat.textureWrap(r.framebuffer.texture,r.wrap),r.width=t,r.height=n}}renderOutsideOfPipeline(e,t){this.render(e,t)}begin(){}end(){}replaceProgram(e,t,n){const i=this.paths[e];if(!i)throw"GLCat-Path: The path called "+e+" is not defined!";try{const e=i.program,r=this.glCat.createProgram(this.commonShader+t,this.commonShader+n);r&&(i.program=r,this.gl.deleteProgram(e.program),this.gl.deleteShader(e.vert),this.gl.deleteShader(e.frag))}catch(e){console.error(e)}}resize(e,t,n){let i=this,r=i.paths[e];r.width=t,r.height=n,r.framebuffer&&(i.params.drawbuffers&&r.drawbuffers?r.framebuffer=i.glCat.createDrawBuffers(r.width,r.height,r.drawbuffers):r.float?i.glCat.resizeFloatFramebuffer(r.framebuffer,r.width,r.height):i.glCat.resizeFramebuffer(r.framebuffer,r.width,r.height)),"function"==typeof r.onresize&&r.onresize(r,t,n)}setGlobalFunc(e){this.globalFunc=e}fb(e){if(!this.paths[e])throw"glcat-path.fb: path called "+e+" is not defined";if(!this.paths[e].framebuffer)throw"glcat-path.fb: there is no framebuffer for the path "+e;return this.paths[e].framebuffer}};h.nullFb={framebuffer:null};var d=h,A=n(2);const p=e=>60*e/160,v=e=>e/60*160;class g{constructor(e){this.isInitialFrame=!0,this.totalFrame=0,this.canvas=e.canvas,this.multiplier=e.multiplier,this.isVR=e.isVR;const t=this.gl=e.gl,i=this.automaton=e.automaton,r=this.automaton.auto,a=this.zOffset=e.zOffset,o=this.glCat=new f(this.gl);o.getExtension("OES_texture_float",!0),o.getExtension("OES_texture_float_linear",!0),o.getExtension("EXT_frag_depth",!0),o.getExtension("ANGLE_instanced_arrays",!0),o.getExtension("WEBGL_draw_buffers",!0);const m=this.glCatPath=new d(o,{el:window.divPath,canvas:this.canvas,stretch:!0,drawbuffers:!0});m.commonShader=n(11);const h=this.vboQuad=o.createVertexbuffer(new Float32Array(l.c));this.audio=new u({glCatPath:m});this.xorshift=new c.a(4891789626782),this.textureRandomStatic=o.createTexture(),o.textureWrap(this.textureRandomStatic,t.REPEAT),this.textureRandomUpdate(this.textureRandomStatic,2048),this.textureRandomDynamic=o.createTexture(),o.textureWrap(this.textureRandomDynamic,t.REPEAT),this.mouseX=0,this.mouseY=0,this.canvas.addEventListener("mousemove",e=>{this.mouseX=e.offsetX,this.mouseY=e.offsetY});const p=[1,.4,5],v=[1,1,1],g=s.a.mat4Perspective(90,.01,20),b=s.a.mat4LookAt(p,[0,0,0],[0,1,0],0);this.matV=s.a.mat4Identity(),this.matP=s.a.mat4Identity(),this.perspNear=A.near,this.perspFar=A.far,m.setGlobalFunc(()=>{o.uniform1i("isInitialFrame",this.isInitialFrame),o.uniform1i("isVR",this.isVR),o.uniform1f("totalFrame",this.totalFrame),o.uniform1f("time",i.time),o.uniform1f("progress",i.progress),o.uniform1f("deltaTime",i.deltaTime),o.uniform3fv("cameraPos",s.a.vec3PosFromViewMatrix(this.matV)),o.uniform1f("near",this.perspNear),o.uniform1f("far",this.perspFar),o.uniform3fv("lightPos",p),o.uniform3fv("lightCol",v),o.uniformMatrix4fv("matP",this.matP),o.uniformMatrix4fv("matV",this.matV),o.uniformMatrix4fv("matPL",g),o.uniformMatrix4fv("matVL",b),o.uniformTexture("samplerRandomStatic",this.textureRandomStatic,15),o.uniformTexture("samplerRandomDynamic",this.textureRandomDynamic,14),o.uniform2fv("mouse",[this.mouseX,this.mouseY]),o.uniform2fv("zOffset",[a[0],r("dzOffset")]),o.uniform3fv("bgColor",[0,0,0])}),m.add({return:{vert:n(3),frag:n(12),blend:[t.ONE,t.ZERO],func:(e,n)=>{o.attribute("p",h,2),o.uniformTexture("sampler0",n.input,0),t.drawArrays(t.TRIANGLE_STRIP,0,4)}},inspector:{vert:n(3),frag:n(13),blend:[t.ONE,t.ZERO],clear:[0,0,0,1],func:(e,n)=>{o.attribute("p",h,2),o.uniform3fv("circleColor",[1,1,1]),o.uniformTexture("sampler0",n.input,0),t.drawArrays(t.TRIANGLE_STRIP,0,4)}},tone:{vert:n(3),frag:n(14),blend:[t.ONE,t.ZERO],clear:[0,0,0,1],func:(e,n)=>{o.attribute("p",h,2),t.drawArrays(t.TRIANGLE_STRIP,0,4)}},target:{vert:n(3),frag:n(5),blend:[t.ONE,t.ZERO],clear:[0,0,0,0],framebuffer:!0,float:!0,drawbuffers:3,depthWrite:!1,func:()=>{}},shadow:{width:A.shadowReso,height:A.shadowReso,vert:n(3),frag:n(5),blend:[t.ONE,t.ZERO],clear:[A.far,0,0,0],framebuffer:!0,float:!0,func:()=>{}}});const y={glCatPath:m,automaton:this.automaton,isVR:this.isVR};this.log=n(15).default(y),y.log=this.log,n(20).default(y),n(24).default(y),n(27).default(y),n(31).default(y),n(33).default(y),n(36).default(y),n(40).default(y),n(44).default(y),n(48).default(y),n(52).default(y),n(54).default(y),n(56).default(y),n(60).default(y),n(63).default(y)}update(e){const t=this.automaton,n=t.auto,i=e.viewport,r=i[2]*this.multiplier,a=i[3]*this.multiplier,o=e.isFirstView,s=e.isLastView;if(this.zOffset[0]+=n("dzOffset")*t.deltaTime,this.matP=e.matP,this.matV=e.matV,this.perspNear=e.perspNear,this.perspFar=e.perspFar,this.textureRandomUpdate(this.textureRandomDynamic,32),o&&this.glCatPath.begin(),o){this.glCatPath.render("patternsCompute",{enable:p(16)<t.time}),this.glCatPath.render("particlesCompute",{enable:p(16)<t.time}),this.glCatPath.render("trailsCompute",{enable:p(16)<t.time}),this.glCatPath.render("racerCompute",{enable:p(16)<t.time});for(let e=0;e<3;e++)this.glCatPath.render("logCompute",{enable:p(16)<t.time})}o&&(this.glCatPath.render("shadow"),this.glCatPath.render("box",{enable:p(16)<t.time,target:this.glCatPath.fb("shadow"),isShadow:!0,width:A.shadowReso,height:A.shadowReso}),this.glCatPath.render("raymarch",{enable:p(16)<t.time,target:this.glCatPath.fb("shadow"),isShadow:!0,width:A.shadowReso,height:A.shadowReso}),this.glCatPath.render("trailsRender",{enable:p(16)<t.time,target:this.glCatPath.fb("shadow"),isShadow:!0,width:A.shadowReso,height:A.shadowReso}),this.glCatPath.render("particlesRender",{enable:p(16)<t.time,target:this.glCatPath.fb("shadow"),isShadow:!0,width:A.shadowReso,height:A.shadowReso}),this.glCatPath.render("veryPlane",{enable:p(16)<t.time,target:this.glCatPath.fb("shadow"),isShadow:!0,width:A.shadowReso,height:A.shadowReso})),this.glCatPath.render("target",{width:r,height:a}),this.glCatPath.render("box",{enable:p(16)<t.time,target:this.glCatPath.fb("target"),width:r,height:a}),this.glCatPath.render("patternsRender",{enable:p(16)<t.time,target:this.glCatPath.fb("target"),width:r,height:a}),this.glCatPath.render("raymarch",{enable:p(16)<t.time,target:this.glCatPath.fb("target"),width:r,height:a}),this.glCatPath.render("circle",{enable:p(16)<t.time,target:this.glCatPath.fb("target"),totalFrame:this.totalFrame,width:r,height:a}),this.glCatPath.render("particlesRender",{enable:p(16)<t.time,target:this.glCatPath.fb("target"),width:r,height:a}),this.glCatPath.render("racerRender",{enable:p(16)<t.time,target:this.glCatPath.fb("target"),width:r,height:a}),this.glCatPath.render("trailsRender",{enable:p(16)<t.time,target:this.glCatPath.fb("target"),width:r,height:a}),this.glCatPath.render("veryPlane",{enable:p(16)<t.time,target:this.glCatPath.fb("target"),width:r,height:a}),this.glCatPath.render("ui",{enable:p(16)<t.time,target:this.glCatPath.fb("target"),width:r,height:a,analyserData:this.audio.getAnalyserData()}),this.glCatPath.render("logRender",{enable:p(16)<t.time,target:this.glCatPath.fb("target"),width:r,height:a}),this.glCatPath.render("render",{enable:p(16)<t.time,inputs:this.glCatPath.fb("target").textures,shadow:this.glCatPath.fb("shadow").texture,width:r,height:a}),this.glCatPath.render("distance",{enable:p(16)<t.time,input:this.glCatPath.fb("target").textures[0],width:r,height:a}),this.glCatPath.render("dof",{enable:p(16)<t.time,dry:this.glCatPath.fb("render").texture,depth:this.glCatPath.fb("distance").texture,width:r,height:a}),this.glCatPath.render("preBloom",{width:r/4,height:a/4,enable:p(16)<t.time,input:this.glCatPath.fb("dof").texture,bias:[-.9,-.9,-.9],factor:[1,1,1]}),this.glCatPath.render("bloom",{width:r/4,height:a/4,enable:p(16)<t.time}),this.glCatPath.render("postBloom",{width:r,height:a,enable:p(16)<t.time,dry:this.glCatPath.fb("dof").texture}),this.glCatPath.render("post",{width:r,height:a,enable:p(16)<t.time,input:this.glCatPath.fb("postBloom").texture}),this.isVR||this.glCatPath.render("fxaa",{width:r,height:a,enable:p(16)<t.time,input:this.glCatPath.fb("post").texture});const l=this.isVR?this.glCatPath.fb("post").texture:this.glCatPath.fb("fxaa").texture;this.glCatPath.render("glitch",{width:r,height:a,enable:p(16)<t.time,input:t.time<p(234)?l:t.time<p(234.5)?this.glCatPath.fb("render").texture:t.time<p(235.5)?l:t.time<p(236)?this.glCatPath.fb("distance").texture:t.time<p(237.5)?l:t.time<p(238)?this.glCatPath.fb("target").textures[0]:t.time<p(238.5)?l:t.time<p(239)?this.glCatPath.fb("target").textures[1]:l}),this.glCatPath.render("return",{viewport:i,enable:p(16)<t.time,target:d.nullFb,input:this.glCatPath.fb("glitch").texture}),this.glCatPath.render("tone",{viewport:i,enable:t.time<p(16),target:d.nullFb}),o&&(this.totalFrame%60==0&&(this.log.verb(`Frame: ${this.totalFrame}`),this.log.verb(`Time: ${t.time.toFixed(3)} / Beat: ${v(t.time).toFixed(2)}`)),this.doAt(p(16),()=>{this.log.drop(),this.log.info(`Rendering resolution: ${this.width}x${this.height}`),this.log.info(`Audio buffer size: ${this.audio.bufferSize}`),this.log.info("- - - - - - - - - - - - - - -"),this.log.info("   Welcome to TDF2018   "),this.log.info("You are experiencing ..."),this.log.info(""),this.log.color([1.3,2.4,.2]),this.log.print("FMS_Cat - Until"),this.log.color(),this.log.print(" (Run time: 2m30s)")}),this.doAt(p(48),()=>{this.log.info("This entire experience is made of a "),this.log.color([1.8,.1,.5]),this.log.print("64KB HTML"),this.log.info("(Incl. this cool MUSIC !!)")}),this.doAt(p(80),()=>{this.log.info("Trails activated"),this.log.info(" Do you like acid bass? ")}),this.doAt(p(144),()=>{this.log.info('Entering a section called "ITS_BEGINNING"'),this.log.info("Tips: The this.log is implemented in..."),this.log.info("29 Nov 2018 (3 days before the deadline)"),this.log.warn(`Now it's ${(new Date).toLocaleTimeString()}... End of party is approaching`)}),this.doAt(p(208),()=>{this.log.info("Rings activated")}),this.doAt(p(224),()=>{this.log.info("########################################"),this.log.info("## BE PREPARED FOR FURTHER EXPERIENCE ##"),this.log.info("########################################"),this.log.err("EXCESSIVE_EOM_RESOURCES_REUSE_DETECTED"),this.log.err("See for more details:"),this.log.err("http://fms-cat-eom.github.io/"),this.log.info("Preparing harder kickdrum... OK"),this.log.info("Preparing FM powered wobble bass... OK"),this.log.info("Initializing FTL translation sequence... OK"),this.log.info("Initializing anti-glitch calibrator... Failed"),this.log.warn("Global time might be modified in audio shader");for(let e=0;e<999;e++)this.log.warn("Random f#%ing number: "+Math.random())}),this.doAt(p(240),()=>{this.log.drop(),this.log.info("FTL translation has successfully done"),this.log.info("Particles limit increased: 266,752"),this.log.info("IFS fractals activated [Raymarcher]"),this.log.warn("Otaku wa sugu IFS fractals")}),this.doAt(p(300),()=>{this.log.info("I'm so proud of this 909Snare")}),this.doAt(p(304),()=>{this.log.info("Something weird activated"),this.log.info("Greetings, pals :")}),["0x4015","Ctrl-Alt-Test","fsqrt","gam0022","gaz","gyabo","Had2Apps","Jugem-T","notargs","Radium Software","RTX1911","soma_arc","System K","toe on net"].forEach((e,t)=>{this.doAt(p(306+2*t),()=>{this.log.info(` Hi, ${e} !!`)})}),this.doAt(p(336),()=>{this.log.info("Also I really want to shoutout to :")}),["NotITG Community (esp. Frums and Taro)","Live Coding & VJ Community","of course, TDF Community"].forEach((e,t)=>{this.doAt(p(338+2*t),()=>{this.log.info(` I love you, ${e} !!`)})}),this.doAt(p(368),()=>{this.log.info("I made this prod within 1 weeks, forgive me"),this.log.info("== Here is the end of this demo =="),this.log.info("==   Thanks all, I love you    ==")})),s&&this.glCatPath.end(),s&&(this.isInitialFrame=!1,this.totalFrame++)}textureRandomUpdate(e,t){this.glCat.setTextureFromArray(e,t,t,(()=>{let e=t*t*4,n=new Uint8Array(e);for(let t=0;t<e;t++)n[t]=Math.floor(256*this.xorshift.gen());return n})())}doAt(e,t){this.automaton.time-this.automaton.deltaTime<e&&e<this.automaton.time&&t()}}document.body.style.margin=0,document.body.style.padding=0;const b=document.createElement("canvas"),y=document.createElement("a");document.body.appendChild(y),y.innerHTML="click me!",y.onclick=(()=>{N(!1)});const w=document.createElement("a");document.body.appendChild(w),w.innerHTML="VR mode",w.onclick=(()=>{N(!0)}),b.style.position="fixed",b.style.left="0",b.style.top="0",document.body.style.width=b.style.width="100%",document.body.style.height=b.style.height="100%";let x=null;const E=new o.a({gui:window.divAutomaton,data:n(66)}),_=E.auto;E.on("play",()=>{x.audio.play()}),E.on("pause",()=>{x.audio.pause()}),E.on("seek",()=>{x.audio.setTime(E.time),T[0]=0}),E.pause(),E.addFxDefinition("sine",{name:"Sinewave",params:{amp:{name:"Amp",type:"float",default:.1},freq:{name:"Frequency",type:"float",default:5},phase:{name:"Phase",type:"float",default:0,min:0,max:1}},func(e){const t=e.v,n=e.progress*e.params.freq+e.params.phase;return t+e.params.amp*Math.sin(n*Math.PI*2)}}),E.addFxDefinition("repeat",{name:"Repeat",params:{duration:{name:"Duration",type:"float",default:1,min:0}},func(e){const t=e.params.duration;if(0===t)return e.v;const n=e.t0+(e.t-e.t0)%t;return e.getValue(n)}});let T=[0];let R=[0,0,0],P=[0,0,0],F=90,S=A.near,C=A.far,D=s.a.mat4Perspective(90,.01,A.far),M=s.a.mat4LookAt(R,P,[0,1,0],0);const I=e=>{F=90*_("camera-fov"),R=[0,0,_("camera-Radius")],R=s.a.rotateVecByQuat(R,s.a.quatAngleAxis(_("camera-rotX",{smooth:10}),[1,0,0])),R=s.a.rotateVecByQuat(R,s.a.quatAngleAxis(_("camera-rotY",{smooth:10}),[0,1,0])),e&&(R=s.a.vecAdd(R,e)),D=s.a.mat4Perspective(F,S,C),M=s.a.mat4LookAt(R,P,[0,1,0],0)};I();const L=parseFloat(location.hash.match(/[0-9.]+/))||1;function N(e){if(document.body.appendChild(b),e)B.isSupported&&B.createSession().then(e=>{const t=b.getContext("webgl",{compatibleXRDevice:e.session.device});(O=e).setup(t).then(()=>{x=new g({gl:t,canvas:b,isVR:!0,multiplier:L,automaton:E,zOffset:T}),O.onFrame=(e=>{if(window.aaaaaaaaaaa)return;const t=0===e.iView,n=e.iView===e.nView-1;t&&E.update(x.audio.getTime());const i=e.projectionMatrix;i[10]=-D[10],i[11]=-D[11],i[14]=D[14];const r=Math.tan(.25*Math.PI*_("camera-fov")),a=s.a.mat4Apply(e.viewMatrix,s.a.mat4Scale([1,1,r]),s.a.mat4Translate([0,0,-_("camera-Radius")]));C=A.far*r,x.update({isFirstView:t,isLastView:n,perspNear:S,perspFar:C,viewport:e.viewport,matP:i,matV:a})})})});else{document.body.requestFullscreen?document.body.requestFullscreen():document.body.webkitRequestFullscreen?document.body.webkitRequestFullscreen():document.body.mozRequestFullscreen&&document.body.mozRequestFullscreen();const e=b.getContext("webgl");b.width=A.resolution[0],b.height=A.resolution[1],x=new g({gl:e,canvas:b,isVR:!1,multiplier:L,automaton:E,zOffset:T});const t=()=>{window.aaaaaaaaaaa||(E.update(x.audio.getTime()),I(),x.update({isFirstView:!0,isLastView:!0,perspNear:S,perspFar:C,viewport:[0,0,A.resolution[0],A.resolution[1]],matP:D,matV:M}),requestAnimationFrame(t))};t()}y.style.display="none",w.style.display="none",E.play()}const B=new class{constructor(){this.polyfill=new i.a,navigator.xr.addEventListener("devicechange",()=>{this.checkForXRSupport()}),this.checkForXRSupport()}async checkForXRSupport(){this.device=await navigator.xr.requestDevice("immersive-vr").catch(()=>null),this.isSupported=!!this.device,this.onDeviceChanged&&this.onDeviceChanged()}async createSession(){if(!this.device)throw new Error("VRCat: There are no supported immersive-vr device");const e=await this.device.requestSession({immersive:!0}).catch(e=>{throw new Error("VRCat: Something went wrong")});return new r(e)}};let O=null;B.onDeviceChanged=(()=>{w.style.display=B.isSupported?"block":"none"}),window.addEventListener("keydown",e=>{27===e.which&&(window.aaaaaaaaaaa=!0,x&&x.audio.pause())})}]);